<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-54137818-11"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-54137818-11', {'anonymize_ip': true});
</script>
    <meta charset="utf-8">
    <link href="https://fonts.googleapis.com/css?family=Oxygen+Mono|Roboto+Slab:500,700&display=swap" rel="stylesheet">
    <meta property="og:title" content="Running Javalin on GraalVM (22MB total size) - Javalin - A lightweight Java and Kotlin web framework. Create REST APIs in Java or Kotlin easily.">
    <meta property="og:site_name" content="Javalin">
    <meta property="og:url" content="https://javalin.io">
    <meta property="og:description" content="Oracle‚Äôs GraalVM allows for ahead-of-time (AOT) compilation of JVM applications. This means, instead of running a JVM process to execute your application, th...">
    <meta property="og:image" content="https://javalin.io/img/javalin.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="liMtSlffOZROWLqoiOZdSx-luH9_Siq5-Ot6xqHZwq8">
    <title>
        Running Javalin on GraalVM (22MB total size) - Javalin - A lightweight Java and Kotlin web framework
    </title>
    <meta name="description" content="Oracle‚Äôs GraalVM allows for ahead-of-time (AOT) compilation of JVM applications. This means, instead of running a JVM process to execute your application, th...">
    <link rel="canonical" href="https://zugazagoitia.github.io/2018/09/27/javalin-graalvm-example.html">
    <link rel="shortcut icon" type="image/png" href="/img/favicon.png">
    <link rel="stylesheet" href="/css/main.css">
    <style>/* Styles that affect the length of the document */
p code,
li code {
    font-size: 90%;
    letter-spacing: -0.5px;
    border: 1px solid #ccd;
    background: #f5f5f7;
    padding: 1px 3px;
}

.multitab-code pre {
    margin-top: 0;
    border-radius: 0 0 5px 5px;
}

.multitab-code div[data-tab] {
    display: none;
}

:target {
    scroll-margin-top: 108px;
}

.anchorjs-link {
    transition: all .25s linear;
  }
  
*:hover > .anchorjs-link {
    margin-left: -1.125em !important;
 }</style>
</head>
<body>
    <a id="fork-me" href="https://github.com/javalin/javalin" target="_blank">
    <img style="position:fixed;top:0;right:0;border:0;z-index:99999" src="data:image/png;base64,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" alt="Fork me on GitHub">
</a>
    <header class="top-nav-header">
        <nav class="width-limit">
            <a id="logo" href="/" aria-label="Javalin">
                <img src="/img/logo.svg" alt="Javalin">
            </a>
            <ul>
                <li><a href="/documentation">Docs</a></li>
                <li><a href="/tutorials">Tutorials</a></li>
                <li><a href="/plugins">Plugins</a></li>
                <li><a href="/community">Community</a></li>
            </ul>
        </nav>
    </header>
    <main class="width-limit">
        <article class="tutorial" itemscope itemtype="http://schema.org/BlogPosting">
    <div class="tutorial-header">
        <h1 class="no-margin-top" itemprop="name headline">Running Javalin on GraalVM (22MB total size)</h1>
        <p class="notification">
            <time datetime="2018-09-27T00:00:00+00:00" itemprop="datePublished">Sep 27, 2018</time>
             
                ‚Ä¢ Written by <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name"><a href="https://github.com/birdayz" target="_blank">Johannes Br√ºderl</a></span></span>
            
            <span id="timeToRead">Reading time: <b>0-0 min</b></span>
             
            <br>
            <em class="github-link">
                The source code for this tutorial can be found on 
                <a href="https://github.com/tipsy/graal-javalin" target="_blank">GitHub</a>.
                Please fork/clone and look while you read.
            </em>
            
        </p>
        
            <p class="post-notice">
                This tutorial originally appeared on <a href="https://nerden.de/posts/microservice_graalvm/">https://nerden.de</a> and was republished with the authors permission.
            </p>
        
    </div>
    <div class="post-content" itemprop="articleBody">
        <p>Oracle‚Äôs GraalVM allows for ahead-of-time (AOT) compilation of JVM applications. This means, instead of running a JVM process to execute your application, the compiler builds a native binary. How does it work? On a very high level, a basic runtime (called SubstrateVM) is compiled into the binary, as well as the actual application. Sounds a little like Go, which also includes a small runtime for e.g. garbage collection. In this article, I‚Äôll show how to build a small sample restful webservice with GraalVM native compilation. The sample application is written in Java. Why would somebody even be interested in native compilation of a JVM application? On my day job at E.ON I sadly still have to work a lot with Java applications. Our tech stack is completely cloud native - we run almost everything on Kubernetes. Our applications are ‚Äútypical‚Äù 12 Factor applications. In such a dockerized environment, I think there are three major reasons why native compilation would be interesting.</p>

<ul>
  <li>Application startup time</li>
</ul>

<p>This may not be entirely Java‚Äôs fault. We‚Äôre using Spring Boot, and startup is really slow. I usually have to tune my Kubernetes readiness probe to not check earlier than 20 seconds after starting the pod. And that‚Äôs for a very small application - 500 lines of code.</p>

<ul>
  <li>Memory Footprint</li>
</ul>

<p>In my experience, you don‚Äôt want to give your Spring Boot applications less than 512MB of memory. Otherwise it can take multiple minutes to start. While Java and especially JVM overhead are to blame here, this is just as well a Framework problem. It‚Äôs no secret that Spring is very bloated and uses a lot of reflection.</p>

<ul>
  <li>Application size</li>
</ul>

<p>The size of Java application containers is another problem. It is very annoying, but not critical. The smallest JRE I can find is ~65MB large (alpine based openJDK). If you use Spring Boot, you‚Äôll have at least a ~40MB large fat jar for your application. If your application is larger, it will obviously be more. That‚Äôs a minimum of 100MB per container. Note that the JRE layer of the Docker image might be reused by multiple Docker image, so it is not really 100MB+ for each image of your app. While I think it‚Äôs certainly bearable to have 100MB+ large hello world applications in 2018, it‚Äôs just weak if I can have a 6MB Go binary.</p>

<p>GraalVM AOT compilation might improve this situation. I expect startup time to be pretty much instant without the need for a JVM, and application size to be significantly smaller. GraalVM has some serious limitations, because several features of the JVM do not play well with static compilation. A full list can be found <a href="https://github.com/oracle/graal/blob/master/substratevm/Limitations.md">here</a>. The documentation is crystal clear here: Dynamic Class Loading is and will not be supported. Instead, the compiler analyzes the code and compiles all required classes into the binary. In combination with reflection, this becomes a nightmare for the current Java ecosystem. Many libraries and frameworks use reflection to dynamically instantiate classes. GraalVM does not handle this very well, in many cases additional compiler configuration has to be provided. One of the reasons is, that a call to e.g. Class.forName() may be based on runtime information. A very simple example:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">(</span><span class="n">someVariable</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"SomeClazz"</span><span class="o">)</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Since the value of someVariable is not known at compile time, the compiler can not know whether to include ‚ÄúSomeClazz‚Äù. Not to mention that it‚Äôs just a string, and the compiler has to search for this class on the classpath at compile time. If the compiler decides to include this class, it will just do that and throw an error if the class is not found. That‚Äôs nice. However, this is only best-effort. There is no guarantee that all required classes are included at compile time - which means that classes may be missing, and runtime errors are thrown when they are being instantiated. There are many more limitations, for a full reference head over to GraalVM‚Äôs <a href="https://github.com/oracle/graal/blob/master/substratevm/Limitations.md">documentation</a>. As a proof of concept, I was looking for a rest library without excess usage of reflect. Obviously it‚Äôs not spring boot - I chose <a href="https://javalin.io">javalin.io</a>. It‚Äôs just a rest library on top of Jetty, that‚Äôs it.</p>

<h1 id="getting-started">Getting started</h1>

<p>While I recommend performing builds in Docker, it‚Äôs very helpful to install GraalVM locally. I use <a href="https://sdkman.io">sdkman</a>, it eases the management of JDKs. If you don‚Äôt have sdkman installed already:</p>

<p><code class="language-plaintext highlighter-rouge">curl -s "https://get.sdkman.io" | bash</code></p>

<p>Install GraalVM JDK:</p>

<p><code class="language-plaintext highlighter-rouge">sdk install java 1.0.0-rc-16-grl &amp;&amp; sdk use java 1.0.0-rc-16-grl</code></p>

<p>Let‚Äôs start with a very simple Hello World:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Test</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Test</span><span class="o">();</span>
        <span class="n">t</span><span class="o">.</span><span class="na">setSomeValue</span><span class="o">(</span><span class="s">"Hello World!"</span><span class="o">);</span>
        <span class="nc">Javalin</span> <span class="n">app</span> <span class="o">=</span> <span class="nc">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">().</span><span class="na">start</span><span class="o">(</span><span class="mi">7000</span><span class="o">);</span>
        <span class="n">app</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">json</span><span class="o">(</span><span class="n">t</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>In addition, we must not forget to declare the necessary dependencies. We must include Jackson, as it will be loaded at runtime (d‚Äôuh). The same case for a SLF4J binding, Javalin recommends to use slf4j-simple.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">compile</span> <span class="nl">group:</span> <span class="err">'</span><span class="n">io</span><span class="o">.</span><span class="na">javalin</span><span class="err">'</span><span class="o">,</span> <span class="nl">name:</span> <span class="err">'</span><span class="n">javalin</span><span class="err">'</span><span class="o">,</span> <span class="nl">version:</span> <span class="err">'</span><span class="mf">2.2</span><span class="o">.</span><span class="mi">0</span><span class="err">'</span>
<span class="n">compile</span> <span class="nl">group:</span> <span class="err">'</span><span class="n">com</span><span class="o">.</span><span class="na">fasterxml</span><span class="o">.</span><span class="na">jackson</span><span class="o">.</span><span class="na">core</span><span class="err">'</span><span class="o">,</span> <span class="nl">name:</span> <span class="err">'</span><span class="n">jackson</span><span class="o">-</span><span class="n">databind</span><span class="err">'</span><span class="o">,</span> <span class="nl">version:</span> <span class="err">'</span><span class="mf">2.9</span><span class="o">.</span><span class="mi">6</span><span class="err">'</span>
<span class="n">compile</span> <span class="nl">group:</span> <span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">slf4j</span><span class="err">'</span><span class="o">,</span> <span class="nl">name:</span> <span class="err">'</span><span class="n">slf4j</span><span class="o">-</span><span class="n">simple</span><span class="err">'</span><span class="o">,</span> <span class="nl">version:</span> <span class="err">'</span><span class="mf">1.7</span><span class="o">.</span><span class="mi">25</span><span class="err">'</span>
<span class="n">compile</span> <span class="nl">group:</span> <span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">graalvm</span><span class="err">'</span><span class="o">,</span> <span class="nl">name:</span> <span class="err">'</span><span class="n">graal</span><span class="o">-</span><span class="n">sdk</span><span class="err">'</span><span class="o">,</span> <span class="nl">version:</span> <span class="err">'</span><span class="mf">1.0</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="n">rc6</span><span class="err">'</span>
</code></pre></div></div>

<p>Also, we‚Äôll need to build a fat jar that includes all classes and jars of our application.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">task</span> <span class="nf">fatJar</span><span class="o">(</span><span class="nl">type:</span> <span class="nc">Jar</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">manifest</span> <span class="o">{</span>
        <span class="n">attributes</span> <span class="err">'</span><span class="nc">Implementation</span><span class="o">-</span><span class="nc">Title</span><span class="err">'</span><span class="o">:</span> <span class="err">'</span><span class="nc">Gradle</span> <span class="nc">Jar</span> <span class="nc">File</span> <span class="nc">Example</span><span class="err">'</span><span class="o">,</span>
                <span class="err">'</span><span class="nc">Implementation</span><span class="o">-</span><span class="nc">Version</span><span class="err">'</span><span class="o">:</span> <span class="n">version</span><span class="o">,</span>
                <span class="err">'</span><span class="nc">Main</span><span class="o">-</span><span class="nc">Class</span><span class="err">'</span><span class="o">:</span> <span class="err">'</span><span class="n">de</span><span class="o">.</span><span class="na">nerden</span><span class="o">.</span><span class="na">samples</span><span class="o">.</span><span class="na">graal</span><span class="o">.</span><span class="na">Main</span><span class="err">'</span>
    <span class="o">}</span>
    <span class="n">baseName</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="na">name</span> <span class="o">+</span> <span class="err">'</span><span class="o">-</span><span class="n">all</span><span class="err">'</span>
    <span class="n">from</span> <span class="o">{</span> <span class="n">configurations</span><span class="o">.</span><span class="na">compile</span><span class="o">.</span><span class="na">collect</span> <span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">isDirectory</span><span class="o">()</span> <span class="o">?</span> <span class="n">it</span> <span class="o">:</span> <span class="n">zipTree</span><span class="o">(</span><span class="n">it</span><span class="o">)</span> <span class="o">}</span> <span class="o">}</span>
    <span class="n">with</span> <span class="n">jar</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Nothing very special so far. To build the native application executable, GraalVM provides the tool <code class="language-plaintext highlighter-rouge">native-image</code>. Let‚Äôs try it out:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>j0e@thinkpad ÓÇ∞ ~/projects/graal-javalin ÓÇ∞ ÓÇ†master ‚óè ? ‚çü1 ÓÇ∞ native-image -jar ./build/libs/graal-javalin-all-1.0-SNAPSHOT.jar
Build on Server(pid: 28578, port: 34643)*
[graal-javalin-all-1.0-SNAPSHOT:28578]    classlist:   2,977.05 ms
[graal-javalin-all-1.0-SNAPSHOT:28578]        (cap):     963.06 ms
[graal-javalin-all-1.0-SNAPSHOT:28578]        setup:   1,663.57 ms
[ForkJoinPool-3-worker-3] INFO org.eclipse.jetty.util.log - Logging initialized @5682ms to org.eclipse.jetty.util.log.Slf4jLog
[graal-javalin-all-1.0-SNAPSHOT:28578]   (typeflow):  10,510.28 ms
[graal-javalin-all-1.0-SNAPSHOT:28578]    (objects):   6,598.95 ms
[graal-javalin-all-1.0-SNAPSHOT:28578]   (features):     110.60 ms
[graal-javalin-all-1.0-SNAPSHOT:28578]     analysis:  17,612.10 ms
[graal-javalin-all-1.0-SNAPSHOT:28578]     universe:     859.27 ms
error: unsupported features in 8 methods
Detailed message:
Error: Unsupported method sun.nio.ch.InheritedChannel.soType0(int) is reachable: Native method. If you intend to use the Java Native Interface (JNI), specify -H:+JNI and see also -H:JNIConfigurationFiles=&lt;path&gt; (use -H:+PrintFlags for details)
To diagnose the issue, you can add the option --report-unsupported-elements-at-runtime. The unsupported element is then reported at run time when it is accessed the first time.
...
...
</code></pre></div></div>

<p>Okay, we need the flag -H:+JNI. That one is quite easy, just add the flag to the command and this problem is solved:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code> j0e@thinkpad ÓÇ∞ ~/projects/graal-javalin ÓÇ∞ ÓÇ†master ‚óè ? ‚çü1 ÓÇ∞ native-image -jar ./build/libs/graal-javalin-all-1.0-SNAPSHOT.jar -H:+JNI
Build on Server(pid: 28578, port: 34643)
[graal-javalin-all-1.0-SNAPSHOT:28578]    classlist:     753.67 ms
[graal-javalin-all-1.0-SNAPSHOT:28578]        (cap):     528.63 ms
[graal-javalin-all-1.0-SNAPSHOT:28578]        setup:     776.76 ms
[ForkJoinPool-15-worker-0] INFO org.eclipse.jetty.util.log - Logging initialized @616692ms to org.eclipse.jetty.util.log.Slf4jLog
[graal-javalin-all-1.0-SNAPSHOT:28578]   (typeflow):   5,934.19 ms
[graal-javalin-all-1.0-SNAPSHOT:28578]    (objects):   6,646.13 ms
[graal-javalin-all-1.0-SNAPSHOT:28578]   (features):      83.06 ms
[graal-javalin-all-1.0-SNAPSHOT:28578]     analysis:  13,491.56 ms
[graal-javalin-all-1.0-SNAPSHOT:28578]     universe:     519.25 ms
[graal-javalin-all-1.0-SNAPSHOT:28578]      (parse):   2,360.81 ms
[graal-javalin-all-1.0-SNAPSHOT:28578]     (inline):   3,674.24 ms
[graal-javalin-all-1.0-SNAPSHOT:28578]    (compile):  15,925.13 ms
[graal-javalin-all-1.0-SNAPSHOT:28578]      compile:  22,729.43 ms
[graal-javalin-all-1.0-SNAPSHOT:28578]        image:   1,426.49 ms
[graal-javalin-all-1.0-SNAPSHOT:28578]        write:     280.71 ms
[graal-javalin-all-1.0-SNAPSHOT:28578]      [total]:  40,064.13 ms
</code></pre></div></div>

<p>So compilation was apparently successful. The ugliness starts when we run it:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code> j0e@thinkpad ÓÇ∞ ~/projects/graal-javalin ÓÇ∞ ÓÇ†master ‚óè ? ‚çü1 ÓÇ∞ ./graal-javalin-all-1.0-SNAPSHOT                         ÓÇ≤ ‚úî ÓÇ≤ 33695 ÓÇ≤ 00:53:54
[main] INFO io.javalin.Javalin -
 _________________________________________
|        _                  _ _           |
|       | | __ ___   ____ _| (_)_ __      |
|    _  | |/ _` \ \ / / _` | | | '_ \     |
|   | |_| | (_| |\ V / (_| | | | | | |    |
|    \___/ \__,_| \_/ \__,_|_|_|_| |_|    |
|_________________________________________|
|                                         |
|    https://javalin.io/documentation     |
|_________________________________________|
-------------------------------------------------------------------
Missing dependency 'Slf4j simple'. Add the dependency.

pom.xml:
&lt;dependency&gt;
    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
    &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;
    &lt;version&gt;1.7.25&lt;/version&gt;
&lt;/dependency&gt;

build.gradle:
compile "org.slf4j:slf4j-simple:1.7.25"
-------------------------------------------------------------------
Visit https://javalin.io/documentation#logging if you need more help
[main] INFO io.javalin.Javalin - Starting Javalin ...
[main] ERROR io.javalin.Javalin - Failed to start Javalin
java.lang.IllegalArgumentException: Class org.eclipse.jetty.servlet.ServletMapping[] is instantiated reflectively but was never registered. Register the class by using org.graalvm.nativeimage.RuntimeReflection
        at java.lang.Throwable.&lt;init&gt;(Throwable.java:265)
        at java.lang.Exception.&lt;init&gt;(Exception.java:66)
        at java.lang.RuntimeException.&lt;init&gt;(RuntimeException.java:62)
        at java.lang.IllegalArgumentException.&lt;init&gt;(IllegalArgumentException.java:52)
        at com.oracle.svm.core.genscavenge.graal.AllocationSnippets.checkDynamicHub(AllocationSnippets.java:162)
        at org.eclipse.jetty.util.ArrayUtil.addToArray(ArrayUtil.java:91)
        at org.eclipse.jetty.servlet.ServletHandler.addServletWithMapping(ServletHandler.java:907)
        at org.eclipse.jetty.servlet.ServletContextHandler.addServlet(ServletContextHandler.java:462)
        at io.javalin.core.util.JettyServerUtil.initialize(JettyServerUtil.kt:71)
        at io.javalin.Javalin.start(Javalin.java:136)
        at io.javalin.Javalin.start(Javalin.java:103)
        at de.nerden.samples.graal.Main.main(Main.java:10)
        at com.oracle.svm.core.JavaMainWrapper.run(JavaMainWrapper.java:163)
</code></pre></div></div>

<p>Reflection didn‚Äôt work. This is not a big surprise, but shows the fundamental weakness of GraalVM: it can‚Äôt guarantee that your application works, even if it compiles.</p>

<p>To fix this issue, we have to tell GraalVM that the class ServletMapping has to be included in the binary. Since it‚Äôs reflection and no ‚Äònormal‚Äô part of the code, it didn‚Äôt detect it. There are two possibilities to do this: code-based and JSON configuration-based. I tested both, I think I prefer the json approach but in the end it does not really matter. Add a file with the following contents to your project:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span>
  <span class="p">{</span>
    <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">[Lorg.eclipse.jetty.servlet.ServletMapping;</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">allDeclaredFields</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">allPublicFields</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">allDeclaredMethods</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">allPublicMethods</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">org.slf4j.impl.StaticLoggerBinder</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">allDeclaredFields</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">allPublicFields</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">allDeclaredMethods</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">allPublicMethods</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">com.fasterxml.jackson.databind.ObjectMapper</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">allDeclaredFields</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">allPublicFields</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">allDeclaredMethods</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">allPublicMethods</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">de.nerden.samples.graal.Test</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">allDeclaredFields</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">allPublicFields</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">allDeclaredMethods</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">allPublicMethods</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div>

<p>Note the special notation <code class="language-plaintext highlighter-rouge">[Lorg.eclipse.jetty.servlet.ServletMapping;</code>. This is necessary because in this case, an array of ServletMapping objects is being reflectively instantiated. In addition, i‚Äôve added slf4j and Jackson classes, so they are found at runtime. In both cases, runtime errors are thrown because reflection didn‚Äôt work. Also, we have to add our own classes to the reflection list. If we don‚Äôt do this, the following cryptic exception will be thrown when performing a request:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[qtp1024494636-165] WARN io.javalin.core.ExceptionMapper - Uncaught exception
com.fasterxml.jackson.databind.exc.InvalidDefinitionException: No serializer found for class de.nerden.samples.graal.Test and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationFeature.FAIL_ON_EMPTY_BEANS)
        at java.lang.Throwable.&lt;init&gt;(Throwable.java:265)
        at java.lang.Exception.&lt;init&gt;(Exception.java:66)
        at java.io.IOException.&lt;init&gt;(IOException.java:58)
        at com.fasterxml.jackson.core.JsonProcessingException.&lt;init&gt;(JsonProcessingException.java:33)
        at com.fasterxml.jackson.databind.JsonMappingException.&lt;init&gt;(JsonMappingException.java:237)
        at com.fasterxml.jackson.databind.exc.InvalidDefinitionException.&lt;init&gt;(InvalidDefinitionException.java:38)
        at com.fasterxml.jackson.databind.exc.InvalidDefinitionException.from(InvalidDefinitionException.java:77)
        at com.fasterxml.jackson.databind.SerializerProvider.reportBadDefinition(SerializerProvider.java:1191)
        at com.fasterxml.jackson.databind.DatabindContext.reportBadDefinition(DatabindContext.java:312)
        at com.fasterxml.jackson.databind.ser.impl.UnknownSerializer.failForEmpty(UnknownSerializer.java:71)
        at com.fasterxml.jackson.databind.ser.impl.UnknownSerializer.serialize(UnknownSerializer.java:33)
        at com.fasterxml.jackson.databind.ser.DefaultSerializerProvider._serialize(DefaultSerializerProvider.java:480)
        at com.fasterxml.jackson.databind.ser.DefaultSerializerProvider.serializeValue(DefaultSerializerProvider.java:319)
        at com.fasterxml.jackson.databind.ObjectMapper._configAndWriteValue(ObjectMapper.java:3905)
        at com.fasterxml.jackson.databind.ObjectMapper.writeValueAsString(ObjectMapper.java:3219)
        at io.javalin.json.JavalinJackson.toJson(JavalinJackson.kt:26)
        at io.javalin.json.JavalinJson$toJsonMapper$1.map(JavalinJson.kt:28)
        at io.javalin.json.JavalinJson.toJson(JavalinJson.kt:32)
        at io.javalin.Context.json(Context.kt:510)
        at de.nerden.samples.graal.Main.lambda$main$0(Main.java:11)
        at de.nerden.samples.graal.Main$$Lambda$925/1179449634.handle(Unknown Source)
        at io.javalin.security.SecurityUtil.noopAccessManager(SecurityUtil.kt:22)
        at io.javalin.Javalin$$Lambda$928/1713301975.manage(Unknown Source)
        at io.javalin.Javalin.lambda$addHandler$0(Javalin.java:485)
        at io.javalin.Javalin$$Lambda$931/1107122283.handle(Unknown Source)
        at io.javalin.core.JavalinServlet$service$2$1.invoke(JavalinServlet.kt:48)
        at io.javalin.core.JavalinServlet$service$2$1.invoke(JavalinServlet.kt:20)
        at io.javalin.core.JavalinServlet$service$1.invoke(JavalinServlet.kt:145)
        at io.javalin.core.JavalinServlet$service$2.invoke(JavalinServlet.kt:43)
        at io.javalin.core.JavalinServlet.service(JavalinServlet.kt:109)
        at io.javalin.core.util.JettyServerUtil$initialize$httpHandler$1.doHandle(JettyServerUtil.kt:59)
        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:203)
        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473)
        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564)
        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:201)
        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1242)
        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:144)
        at org.eclipse.jetty.server.handler.HandlerList.handle(HandlerList.java:61)
        at org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:174)
        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132)
        at org.eclipse.jetty.server.Server.handle(Server.java:503)
        at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:364)
        at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:260)
        at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:305)
        at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:103)
        at org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:118)
        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:765)
        at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:683)
        at java.lang.Thread.run(Thread.java:748)
        at com.oracle.svm.core.posix.thread.PosixJavaThreads.pthreadStartRoutine(PosixJavaThreads.java:238)
</code></pre></div></div>

<p>The reason is: Jackson uses reflection to marshal/unmarshal json. Once configured properly, it works.</p>

<p>You can try it out on your own! <code class="language-plaintext highlighter-rouge">docker run --net=host birdy/graal-javalin</code></p>

<p>Perform the sample call: <code class="language-plaintext highlighter-rouge">curl localhost:7000</code></p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code> j0e@thinkpad ÓÇ∞ ~/projects/graal-javalin ÓÇ∞ ÓÇ†master ? ‚çü2 ÓÇ∞ curl localhost:7000                                        ÓÇ≤ ‚úî ÓÇ≤ 33707 ÓÇ≤ 01:15:12
{"abc":"LOL"}%
</code></pre></div></div>

<p>Yay. And the startup time is instant. No JVM!</p>

<p>So, how did this turn out, looking at my 3 points of criticism?</p>

<h2 id="application-startup-time">Application startup time</h2>

<p>The application starts instantly. While Javalin is starting very quickly even on the JVM (~1-2 Seconds), this will be VERY appealing for CLI tools.</p>

<h2 id="memory-footprint">Memory Footprint</h2>

<p>Measuring memory usage of a process is not very straight-forward. There are several metrics - according so some post on <a href="https://stackoverflow.com/questions/131303/how-to-measure-actual-memory-usage-of-an-application-or-process">Stackoverflow</a> RSS is a good metric: So let‚Äôs use check this out:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /proc/7812/status
VmRSS:     18260 kB
</code></pre></div></div>

<p>18 MB, that looks quite nice. Note that I didn‚Äôt perform any load tests, these are just some manual tests with no load. With some more requests with curl it went up to 25MB. The good thing: we have the luxury that we can directly compare this to the same application, but on the JVM.</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VmRSS:    183580 kB
</code></pre></div></div>

<p>In this specific case, it‚Äôs about 1‚ÅÑ10 of memory usage.</p>

<h2 id="application-size">Application size</h2>

<p>The application‚Äôs fat jar is 5.7MB large and the smallest JRE is 57MB: <a href="https://hub.docker.com/r/library/openjdk/tags/">https://hub.docker.com/r/library/openjdk/tags/</a>. For simplicity, let‚Äôs say 60MB total. The native binary is about 22MB large:</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-rwxr-xr-x 1 j0e users  22M Sep 24 01:38 graal-javalin
</code></pre></div></div>

<p>That‚Äôs ~ 1‚ÅÑ3 the size. That‚Äôs absolutely acceptable, and almost in range of the size of Go binaries. Please note that with JDK9, sizes may be smaller. So I think the advantage here exists, but may not be very large.</p>

<p>In general, GraalVM is a cool thing. It just feels like a dirty hack. I really dislike that there may always be runtime errors that GraalVM can‚Äôt predict at compile time (correct me if I‚Äôm wrong). I‚Äôm not sure if this is the future of Java, but does it have one anyway? ;) It‚Äôs worth noting that some library/framework authors are actively investing time into supporting GraalVM. As a matter of fact, micronaut.io is now compatible: <a href="https://github.com/graemerocher/micronaut-graal-experiments">https://github.com/graemerocher/micronaut-graal-experiments</a>.</p>

<p>The full code, including a Dockerfile is available on GitHub: <a href="https://github.com/birdayz/graal-javalin">https://github.com/birdayz/graal-javalin</a>.</p>

<p>In addition, I made a Docker image you can use as base image to build a container with only the static executable, similar how it is done for Go applications.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM birdy/graalvm:latest
WORKDIR /tmp/build
ENV GRADLE_USER_HOME /tmp/build/.gradle

ADD . /tmp/build
RUN ./gradlew build fatJar
RUN native-image -jar /tmp/build/build/libs/graal-javalin-all-1.0-SNAPSHOT.jar -H:ReflectionConfigurationFiles=reflection.json -H:+JNI \
  -H:Name=graal-javalin --static --delay-class-initialization-to-runtime=io.javalin.json.JavalinJson

FROM scratch
COPY --from=0 /tmp/build/graal-javalin /
ENTRYPOINT ["/graal-javalin"]
</code></pre></div></div>

<p>This Dockerfile uses Docker multi-stage builds. There are two containers: one just used for the build, and the final output container which only contains the application.</p>

    </div>
    <h3>Thanks for reading</h3>
    If you find any errors, please <a href="https://github.com/javalin/javalin.github.io/blob/master/_posts/tutorials/community/2018-09-27-javalin-graalvm-example.md">edit this page on GitHub</a>.
    <br>
    
        The full source code for this tutorial can also be found on <a href="https://github.com/tipsy/graal-javalin">GitHub</a>.
    
</article>
<style>
    .social {
        margin: 30px 0;
        display: flex;
    }
    .social-btn {
        text-align: center;
        min-width: 240px;
        padding: 10px 16px 8px;
        font-size: 14px;
        font-family: 'Roboto Slab', sans-serif;
        font-weight: 600;
        color: #fff;
        background: #000;
        border-radius: 50px;
        box-shadow: 2px 2px red, -2px -2px cyan;
    }
    .social-btn + .social-btn {
        margin-left: 24px;
    }
    .social-btn:hover {
        background: #008ab4;
    }
    .social-btn img {
        width: 24px;
        display: inline;
        vertical-align: middle;
        margin-right: 12px;
    }
    @media (max-width: 480px) {
        .social {
            justify-content: space-between;
        }
        .social-btn {
            min-width: 0;
            width: calc(50% - 12px);
            text-align: left;
            display: flex;
            align-items: center;
        }
        .social-btn + .social-btn {
            margin-left: 0;
        }
    }
</style>
<div class="social">
    <a class="social-btn" href="https://twitter.com/intent/tweet?text=Running Javalin on GraalVM (22MB total size)&url=https://zugazagoitia.github.io/2018/09/27/javalin-graalvm-example.html&via=javalin_io&related=javalin_io"
       rel="nofollow"
       title="Share on Twitter">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAM1BMVEUAAAD///////////////////////////////////////////////////////////////+3leKCAAAAEHRSTlMA8BDQwKCAMOBwYECwUCCQ27fl2AAAAW1JREFUWMPtltuOwyAMRLG5QxL8/1+7G6lKFApMaJ5W2/NIPCPAnlL15R+xRSM7ZPMnci5yYvxrNRt3VMRtpPdBLqR9MWkhPkpI80BPUpFy2dfiUbKK9B02kjbmrCkycNAdfeCqpuOQOnrye2teRS9LrxqEjn4tQSS/io7Fxg1Kn/MWjxX7dgw30NvGNkO9CQP1O8v7oGEDq07i9Uu+YxAvs1J91GmDBtdQLVKjYz6/YINNWujiVgsMet3CqAr7yICKn3XQF4N9gizJDAsIDMSBLkIyyDzkmjqmWb0GoYUUBVKLWFUF6yk9gccDYtU7bKabWBNv9yKoDunmTcSW2Im+uwNi1cBP5+DjUSAGrzgiVcLZSBmlHjnQBv7L4AOMYEdwiAGcFgK/A5BN9/WsMCs90nsjT/SrGd0fI3UJIIIdovtlAUnWftA5KwiKakg2Y7ljfPn9tzWkUw5GsHV059UEOVpDR2wXl1l9+RP8AHA4c7ljId3mAAAAAElFTkSuQmCC">Share on Twitter
    </a>
    <a class="social-btn" href="https://facebook.com/sharer.php?u=https://zugazagoitia.github.io/2018/09/27/javalin-graalvm-example.html"
       rel="nofollow"
       title="Share on Facebook">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABABAMAAABYR2ztAAAAMFBMVEUAAAD///////////////////////////////////////////////////////////87TQQwAAAAD3RSTlMAwIDwEEDgMKBgINBwUJA4su2wAAAAy0lEQVRIx2MYJICr+T9WkOQAVTD/Pw5gDpHn/I8TXAAriMetwAqsQB63gh9gBf/xgAFT8E0QCPJxK/ixACTqj1PB5wCwKD9OBbsY8Cv4XEBAwU8GAgoECCmYABTB5QuEUI2S0n4cCn6DRBzxhORHkMh5Qgr0h7eCjw6I/BiPTcEnBgRgxKbgK5ICPkIKmGij4C+yIwn5gg2bgm9ICuIHa2SNKqCZgs9gBf2YClBTkDNuBSlgBeyYCtDKzGJcCtKhyY+lH7sCIweGwQEAY2jNUu1+zZgAAAAASUVORK5CYII=">Share on Facebook
    </a>
</div>


    </main>
    <footer>
        Javalin is a Java and Kotlin web framework, open sourced under the
        <a href="https://tldrlegal.com/license/apache-license-2.0-(apache-2.0)">Apache 2</a> license
        | <a href="/download">Download</a>
        | <a href="/about">About</a>
        | <a href="/news">News</a>
        | <a href="/about#contact">Contact</a>
        | <a href="/for-educators">For educators</a>
    </footer>
    <div id="star-begging">
    <style>
        #star-begging {
            transition: transform .25s;
            transform: scale(0);
            border-radius: 8px;
            position: fixed;
            bottom: 32px;
            right: 32px;
            padding: 20px 40px 16px 20px;
            background: #fff;
            box-shadow: 0 1px 20px rgba(0, 0, 0, 0.15);
            z-index: 9999998;
        }
        #star-begging.in {
            transform: scale(1);
        }
        #star-begging.out {
            transform: translateX(400px);
        }
        #star-begging p {
            font-size: 16px;
            margin: 0 0 15px;
        }
        #star-begging .close {
            position: absolute;
            right: 20px;
            top: 20px;
            height: 40px;
            width: 40px;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-family: arial, sans-serif;
            cursor: pointer;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 5px;
        }
    </style>
    <p>
        Like Javalin?
        <br>Star us üòä
    </p>
    <span class="close">√ó</span>
    <iframe id="starFrame" class="githubStar" title="github-stars"
            src="https://ghbtns.com/github-btn.html?user=javalin&amp;repo=javalin&amp;type=star&amp;count=true&size=large"
            frameborder="0" scrolling="0" width="150px" height="30px">
    </iframe>
    <script>
        if (localStorage.getItem("dismissed") !== "true" && document.getElementById("notification-banner") === null) {
            setTimeout(function () {
                document.querySelector("#star-begging").classList.add("in");
            }, 15000);
            document.querySelector("#star-begging .close").addEventListener("click", function () {
                document.querySelector("#star-begging").classList.add("out");
                localStorage.setItem("dismissed", "true");
            });
        }
    </script>
</div>

    <script src="/js/scripts.js"></script>
</body>
</html>
