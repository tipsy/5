<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-54137818-11"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-54137818-11', {'anonymize_ip': true});
</script>
    <meta charset="utf-8">
    <link href="https://fonts.googleapis.com/css?family=Oxygen+Mono|Roboto+Slab:500,700&display=swap" rel="stylesheet">
    <meta property="og:title" content="Archive - v1 documentation - Javalin - A lightweight Java and Kotlin web framework. Create REST APIs in Java or Kotlin easily.">
    <meta property="og:site_name" content="Javalin">
    <meta property="og:url" content="https://javalin.io">
    <meta property="og:description" content="Javalin - A lightweight Java and Kotlin web framework. Create REST APIs in Java or Kotlin easily.">
    <meta property="og:image" content="https://javalin.io/img/javalin.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="liMtSlffOZROWLqoiOZdSx-luH9_Siq5-Ot6xqHZwq8">
    <title>
        Archive - v1 documentation - Javalin - A lightweight Java and Kotlin web framework
    </title>
    <meta name="description" content="Javalin - A lightweight Java and Kotlin web framework. Create REST APIs in Java or Kotlin easily.">
    <link rel="canonical" href="5//archive/docs/v1.7.0.html">
    <link rel="shortcut icon" type="image/png" href="/img/favicon.png">
    <link rel="stylesheet" href="/css/main.css">
    <style>/* Styles that affect the length of the document */
p code,
li code {
    font-size: 90%;
    letter-spacing: -0.5px;
    border: 1px solid #ccd;
    background: #f5f5f7;
    padding: 1px 3px;
}

.multitab-code pre {
    margin-top: 0;
    border-radius: 0 0 5px 5px;
}

.multitab-code div[data-tab] {
    display: none;
}

:target {
    scroll-margin-top: 108px;
}

.anchorjs-link {
    transition: all .25s linear;
  }
  
*:hover > .anchorjs-link {
    margin-left: -1.125em !important;
 }</style>
</head>
<body>
    <a id="fork-me" href="https://github.com/javalin/javalin" target="_blank">
    <img style="position:fixed;top:0;right:0;border:0;z-index:99999" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJUAAACVCAMAAABmfEh9AAAAllBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPEhwAAAAFBgkAAAARFR8fIiwRFB4YHCUQEx0RFB4SFiERFB8QEx3s7e4eIStPUlpKTFUvMjwOEhs8P0hfYmlXWmE5PUUZHSfd3uAnKjTAwcRnanB2eH5CRU6TlZqxs7bP0NKFh4yUlpqipKiUlpujpKiipKdzB4/DAAAAFXRSTlMAAwgBDREiKBYbL5wdQBjb3ZzclY3cWcIvAAAGZ0lEQVR42u2c3W7bMAyF02bL2q5bu7WLqDhW7Si24p902/u/3EglljxXQX1jixclsIv0QvhAHvAQZLJFF8vl1dX19afn/Ub9ej+2L5ufd6v725vPn66vr66ulsvFBOGoPj/LLJHvY8kkf/j2ZTUtlqe6ed6+JCOytX/ZPCLW/aRYnur2aZeo3QisjXogrO+TYjmq1ROqZgQWlvpxaiyisljf71dP+yQfJflk8mwtfbK+/NhnmxGSx1L/nBhraZP1ySbr7sc2O4xrEIMiTpqsu6+7zWGU5PNpi0hUfaxRkl9jqR9nxZLjJJ8d5s3W/mWU5Dfq56xY4z1x3iJuxnrinFg/xnrizJLfJZeLuMboJK9mbxDyIpPjkpvD48ySz4NQLpwnzopFY2CYqfzti7ibXfLZIQQlSoBjT1sRJL8bUgmCaiyWHwOjemKXqVIWYDwWljqmJ56h6jSVfyR+YOGJlCpbvipNhXBUbgycVfKqR3UuX0JUGNE8kcZA2VEphMLyZdIYabGieeJX74mYKyNEmiYaQCuLFdMTcy8sIUSuwWT6lYpI4SUfwRM9Vk1lbLQYYO3m90TVyxa1hgqqVEmHFdkTCaLRWQVa5rrAdMla+WzNPwYeXLaUBihyVBfUUhaAVh1zDNx1yZJllpLk20IWzqjjeaJXfK5J8ghVuQYRzxNdtpoOKt0674kjeVqNdFjqBAUatLJUMT3x0GtbCFXAqymVK2GkMZA80WH9gaqFLbVSGwxWI1ZbRhSFEAGsaKsRy7GFVlgsZT8yWI1YqkKtiUrpo+sPzhPjrEYsFv4jKGiMw/JjYCxPpCCotoDSYnFYjVgqRV3eQNNhRfdEwtoSVK51A+2wiBsVbww0BAWZBC08VuTVCAkroXQl8DdFLD6eaMCmK9+bTLzxxIdonqgIqixpGJTRPdGNgYIknwG0GZT4kcW5gLBQ8g0UugRzVhaLMVCIFF5lAXq7tsHhXGCxdCNlUboJItYYSEXMlOvxJTRK9AabqOeCg+ywslbYSExyIovuiQRxnpuPAICDDY/VSId1hCKrQHVtnsVqZJ1AIdMSTJqc2zyL1YiBhBr9voLOfTisRkqoMg2mAizksEHk8TwRxU5QhdGwdZKPey6wA7PZViQurOW6i/irESEMQckGc+UjqidaAtEiVAGtEJ7KST6KJ67dDuLYdfrWyp7BamTdnqFkDRj2vMJgNbI2lDFKmW6zGtqe5OOcC7z7EFSxRbhae6r1PoviiV71BhpJh6iyPCk++oXMUmm0HwyB8bvlcC74dXJqZLLZSkD/3yDirUYkNGmaN3maJsJkwmJFXo2c+kPdApi0hDaV557K4FyATFAilM6roupafTRPlJ3eZXGCMgAVZuuo4nnifuM9UQmCkgWQY1fQSPpjrNWIz5Y6QVVlhVBaifieaLFKldZ01SeoPBVSRfXEXYclEqgt1On0oxHrwmrEUU05BjptQZNQprStZf/uIwee6F6bYwwsa0nly7UmKHHxWyOeap4x0ICmFg9WWvSX4DcpHdWUReydC2StTpe7WuZdkw+sRgYPTrcacZonKF2i2nOkCntij2omTxQERWovpNsmvfl1weC56TzR33wwS9S5ZFoqGrjK3hioHk5Yg9em9ESnLZUa6lwlNFIc7br5/3PB7c3gsUk90WurAWnNOq3cDrzvibfDxyYdAx1WDcZ0UKStwbngPvDcHOeCGk5QUGSOynviKvDaHGOgqBHKb2wGP6i5Cz43xwldpd3GJnAuWIRj+hO6MABJKvu58p4YemtiT/RYr0b3Tyte8oGX5pK8qAGg9WL3sV1cjum/NVKabjk5iMvPTbwa6e//IlBdWo14qAhU75wLkCkC1bs/qIlFFfZEBlSBMZADVcgTGVCFJM+A6o3kk5wDVWg1woAq4IkcqEKeyIAq4Ik7BlSBMZADVWgMZEAV8EQOVCFPZEAV8EQOVAFP5EAV8kQGVIHVCAeqt5LfSAZUAU/kQBX6JiUDqtBqhAFVwBM5UIU8kQHVW8krDlShcwEDqoAncqAaYqEncqAaYpEnMqD6D2v15QnHQA5Ufaz71eqJxsAFg/BY35HriXbIHMJhEdftM+6QWUSHRVw3+L+VLXhEh4VcGM8LJnHGQjCKBZcgLOKysWATiEXBjAqxiMvGglEsMfhRWS4bC3bBk+ojPuIjPiIc/wAQkAE6ZqHsywAAAABJRU5ErkJggg==" alt="Fork me on GitHub">
</a>
    <header class="top-nav-header">
        <nav class="width-limit">
            <a id="logo" href="/" aria-label="Javalin">
                <img src="/img/logo.svg" alt="Javalin">
            </a>
            <ul>
                <li><a href="/documentation">Docs</a></li>
                <li><a href="/tutorials">Tutorials</a></li>
                <li><a href="/plugins">Plugins</a></li>
                <li><a href="/community">Community</a></li>
            </ul>
        </nav>
    </header>
    <main class="width-limit has-right-menu">
                <div id="spy-nav" class="right-menu">
  <ul>
    <li><a href="#handlers">Handlers</a>
      <ul>
        <li><a href="#before-handlers">Before handlers</a></li>
        <li><a href="#endpoint-handlers">Endpoint handlers</a></li>
        <li><a href="#after-handlers">After handlers</a></li>
        <li><a href="#reverse-path-lookup">Reverse path lookup</a></li>
      </ul>
    </li>
    <li><a href="#handler-groups">Handler groups</a></li>
    <li><a href="#context">Context</a>
      <ul>
        <li><a href="#cookie-store">Cookie Store</a></li>
        <li><a href="#example">Example:</a></li>
        <li><a href="#context-extensions">Context extensions</a></li>
      </ul>
    </li>
    <li><a href="#access-manager">Access manager</a></li>
    <li><a href="#exception-mapping">Exception Mapping</a>
      <ul>
        <li><a href="#haltexception">HaltException</a></li>
      </ul>
    </li>
    <li><a href="#error-mapping">Error Mapping</a></li>
    <li><a href="#websockets">WebSockets</a>
      <ul>
        <li><a href="#wssession">WsSession</a></li>
      </ul>
    </li>
    <li><a href="#lifecycle-events">Lifecycle events</a></li>
    <li><a href="#server-setup">Server setup</a>
      <ul>
        <li><a href="#starting-and-stopping">Starting and stopping</a>
          <ul>
            <li><a href="#quick-start">Quick-start</a></li>
          </ul>
        </li>
        <li><a href="#configuration">Configuration</a></li>
        <li><a href="#custom-server">Custom server</a>
          <ul>
            <li><a href="#custom-jetty-handlers">Custom jetty handlers</a></li>
          </ul>
        </li>
        <li><a href="#sslhttp2">SSL/HTTP2</a></li>
        <li><a href="#static-files">Static Files</a>
          <ul>
            <li><a href="#caching">Caching</a></li>
          </ul>
        </li>
        <li><a href="#jetty-websockets">Jetty WebSockets</a></li>
        <li><a href="#annotated-class">Annotated class</a></li>
        <li><a href="#websocket-object">WebSocket object</a></li>
      </ul>
    </li>
    <li><a href="#faq">FAQ</a>
      <ul>
        <li><a href="#javadoc">Javadoc</a></li>
        <li><a href="#deploying">Deploying</a></li>
        <li><a href="#uploads">Uploads</a></li>
        <li><a href="#asynchronous-requests">Asynchronous requests</a></li>
        <li><a href="#configuring-the-json-mapper">Configuring the JSON mapper</a>
          <ul>
            <li><a href="#configuring-jackson">Configuring Jackson</a></li>
          </ul>
        </li>
        <li><a href="#views-and-templates">Views and Templates</a></li>
        <li><a href="#timeoutexceptions-and-closedchannelexceptions">TimeoutExceptions and ClosedChannelExceptions</a></li>
      </ul>
    </li>
  </ul>
</div>

<h1 class="no-margin-top">Documentation - Javalin 1.X</h1>

<p>This page contains documentation for an older version of Javalin.
Go to <a href="/documentation">javalin.io/documentation</a> to view documentation for the newest version.</p>

<h2 id="handlers">Handlers</h2>
<p>Javalin has a three main handler types: before-handlers, endpoint-handlers, and after-handlers.
(There are also exception-handlers and error-handlers, but weâ€™ll get to them later).
The before-, endpoint- and after-handlers require three parts:</p>

<ul>
  <li>A verb, ex: <code class="highlighter-rouge">before</code>, <code class="highlighter-rouge">get</code>, <code class="highlighter-rouge">post</code>, <code class="highlighter-rouge">put</code>, <code class="highlighter-rouge">delete</code>, <code class="highlighter-rouge">after</code></li>
  <li>A path, ex: <code class="highlighter-rouge">/</code>, <code class="highlighter-rouge">/hello-world</code></li>
  <li>A handler implementation <code class="highlighter-rouge">ctx -&gt; { ... }</code></li>
</ul>

<p>The <code class="highlighter-rouge">Handler</code> interface has a void return type, so you have to use  <code class="highlighter-rouge">ctx.result()</code> to return data to the user.</p>

<h3 id="before-handlers">Before handlers</h3>
<p>Before-handlers are matched before every request (including static files, if you enable those).</p>
<div class="comment">You might know before-handlers as filters, interceptors, or middleware from other libraries.</div>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">before</span><span class="o">(</span><span class="s">"/some-path/*"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// runs before all request to /some-path/*</span>
<span class="o">});</span>
<span class="n">app</span><span class="o">.</span><span class="na">before</span><span class="o">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// calls before("/*", handler)</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">before</span><span class="p">(</span><span class="s">"/some-path/*"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="c1">// runs before all request to /some-path/*
</span><span class="p">}</span>
<span class="n">app</span><span class="p">.</span><span class="n">before</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="c1">// calls before("/*", handler)
</span><span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h3 id="endpoint-handlers">Endpoint handlers</h3>
<p>Endpoint-handlers are matched in the order they are defined.</p>
<div class="comment">You might know endpoint-handlers as routes or middleware from other libraries.</div>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// some code</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">json</span><span class="o">(</span><span class="n">object</span><span class="o">)</span>
<span class="o">});</span>

<span class="n">app</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// some code</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">201</span><span class="o">)</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="c1">// some code
</span>    <span class="n">ctx</span><span class="p">.</span><span class="n">json</span><span class="p">(</span><span class="k">object</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="c1">// some code
</span>    <span class="n">ctx</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="m">201</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<p>Handler paths can include path-parameters. These are available via <code class="highlighter-rouge">Context.param()</code></p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/hello/:name"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="s">"Hello: "</span> <span class="o">+</span> <span class="n">ctx</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"name"</span><span class="o">));</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="k">get</span><span class="p">(</span><span class="s">"/hello/:name"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">result</span><span class="p">(</span><span class="s">"Hello: "</span> <span class="p">+</span> <span class="n">ctx</span><span class="p">.</span><span class="n">param</span><span class="p">(</span><span class="s">"name"</span><span class="p">))</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<p>Handler-paths can also include wildcard parameters (splats). These are available via <code class="highlighter-rouge">Context.splat()</code></p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/hello/*/and/*"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="s">"Hello: "</span> <span class="o">+</span> <span class="n">ctx</span><span class="o">.</span><span class="na">splat</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">+</span> <span class="s">" and "</span> <span class="o">+</span> <span class="n">ctx</span><span class="o">.</span><span class="na">splat</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="k">get</span><span class="p">(</span><span class="s">"/hello/*/and/*"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">result</span><span class="p">(</span><span class="s">"Hello: "</span> <span class="p">+</span> <span class="n">ctx</span><span class="p">.</span><span class="n">splat</span><span class="p">(</span><span class="m">0</span><span class="p">)</span> <span class="p">+</span> <span class="s">" and "</span> <span class="p">+</span> <span class="n">ctx</span><span class="p">.</span><span class="n">splat</span><span class="p">(</span><span class="m">1</span><span class="p">))</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h3 id="after-handlers">After handlers</h3>
<p>After-handlers run after every request (even if an exception occurred)</p>
<div class="comment">You might know after-handlers as filters, interceptors, or middleware from other libraries.</div>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">after</span><span class="o">(</span><span class="s">"/some-path/*"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// runs after all request to /some-path/* (excluding static files)</span>
<span class="o">});</span>

<span class="n">app</span><span class="o">.</span><span class="na">after</span><span class="o">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// run after every request (excluding static files)</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">after</span><span class="p">(</span><span class="s">"/some-path/*"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="c1">// runs after all request to /some-path/* (excluding static files)
</span><span class="p">}</span>

<span class="n">app</span><span class="p">.</span><span class="n">after</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="c1">// run after every request (excluding static files)
</span><span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h3 id="reverse-path-lookup">Reverse path lookup</h3>
<p>You can look up the path for a specific <code class="highlighter-rouge">Handler</code> by calling <code class="highlighter-rouge">app.pathFinder(handler)</code>
or <code class="highlighter-rouge">app.pathFinder(handler, handlerType)</code>. If the <code class="highlighter-rouge">Handler</code> is registered on multiple
paths, the first matching path will be returned.</p>

<h2 id="handler-groups">Handler groups</h2>
<p>You can group your endpoints by using the <code class="highlighter-rouge">routes()</code> and <code class="highlighter-rouge">path()</code> methods. <code class="highlighter-rouge">routes()</code> creates
a temporary static instance of Javalin so you can skip the <code class="highlighter-rouge">app.</code> prefix before your handlers:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">routes</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">path</span><span class="o">(</span><span class="s">"users"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">get</span><span class="o">(</span><span class="nl">UserController:</span><span class="o">:</span><span class="n">getAllUsers</span><span class="o">);</span>
        <span class="n">post</span><span class="o">(</span><span class="nl">UserController:</span><span class="o">:</span><span class="n">createUser</span><span class="o">);</span>
        <span class="n">path</span><span class="o">(</span><span class="s">":id"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">get</span><span class="o">(</span><span class="nl">UserController:</span><span class="o">:</span><span class="n">getUser</span><span class="o">);</span>
            <span class="n">patch</span><span class="o">(</span><span class="nl">UserController:</span><span class="o">:</span><span class="n">updateUser</span><span class="o">);</span>
            <span class="n">delete</span><span class="o">(</span><span class="nl">UserController:</span><span class="o">:</span><span class="n">deleteUser</span><span class="o">);</span>
        <span class="o">});</span>
    <span class="o">});</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">routes</span> <span class="p">{</span>
    <span class="n">path</span><span class="p">(</span><span class="s">"users"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">get</span><span class="p">(</span><span class="n">userController</span><span class="o">::</span><span class="n">getAllUsers</span><span class="p">);</span>
        <span class="n">post</span><span class="p">(</span><span class="n">userController</span><span class="o">::</span><span class="n">createUser</span><span class="p">);</span>
        <span class="n">path</span><span class="p">(</span><span class="s">":id"</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">get</span><span class="p">(</span><span class="n">userController</span><span class="o">::</span><span class="n">getUser</span><span class="p">);</span>
            <span class="n">patch</span><span class="p">(</span><span class="n">userController</span><span class="o">::</span><span class="n">updateUser</span><span class="p">);</span>
            <span class="n">delete</span><span class="p">(</span><span class="n">userController</span><span class="o">::</span><span class="n">deleteUser</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<p>Note that <code class="highlighter-rouge">path()</code> prefixes your paths with <code class="highlighter-rouge">/</code> (if you donâ€™t add it yourself).<br />
This means that <code class="highlighter-rouge">path("api", ...)</code> and <code class="highlighter-rouge">path("/api", ...)</code> are equivalent.</p>

<h2 id="context">Context</h2>
<p>The <code class="highlighter-rouge">Context</code> object provides you with everything you need to handle a http-request.
It contains the underlying servlet-request and servlet-response, and a bunch of getters
and setters. The getters operate mostly on the request-object, while the setters operate exclusively on
the response object.</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// request methods:</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">request</span><span class="o">();</span>                      <span class="c1">// get underlying HttpServletRequest</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">anyFormParamNull</span><span class="o">(</span><span class="s">"k1"</span><span class="o">,</span> <span class="s">"k2"</span><span class="o">);</span>   <span class="c1">// returns true if any form-param is null</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">anyQueryParamNull</span><span class="o">(</span><span class="s">"k1"</span><span class="o">,</span> <span class="s">"k2"</span><span class="o">);</span>  <span class="c1">// returns true if any query-param is null</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">body</span><span class="o">();</span>                         <span class="c1">// get the request body as string</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">bodyAsBytes</span><span class="o">();</span>                  <span class="c1">// get the request body as byte-array</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">bodyAsClass</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>             <span class="c1">// convert json body to object</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">formParam</span><span class="o">(</span><span class="s">"key"</span><span class="o">);</span>               <span class="c1">// get form param</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">formParams</span><span class="o">(</span><span class="s">"key"</span><span class="o">);</span>              <span class="c1">// get form param with multiple values</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">formParamMap</span><span class="o">();</span>                 <span class="c1">// get all form param key/values as map</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"key"</span><span class="o">);</span>                   <span class="c1">// get a path-parameter, ex "/:id" -&gt; param("id")</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">paramMap</span><span class="o">();</span>                     <span class="c1">// get all param key/values as map</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">splat</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>                       <span class="c1">// get splat by nr, ex "/*" -&gt; splat(0)</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">splats</span><span class="o">();</span>                       <span class="c1">// get array of splat-values</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">attribute</span><span class="o">(</span><span class="s">"key"</span><span class="o">,</span> <span class="s">"value"</span><span class="o">);</span>      <span class="c1">// set a request attribute</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">attribute</span><span class="o">(</span><span class="s">"key"</span><span class="o">);</span>               <span class="c1">// get a request attribute</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">attributeMap</span><span class="o">();</span>                 <span class="c1">// get all attribute key/values as map</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">basicAuthCredentials</span><span class="o">()</span>          <span class="c1">// get username and password used for basic-auth</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">contentLength</span><span class="o">();</span>                <span class="c1">// get request content length</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">contentType</span><span class="o">();</span>                  <span class="c1">// get request content type</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">cookie</span><span class="o">(</span><span class="s">"key"</span><span class="o">);</span>                  <span class="c1">// get cookie by name</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">cookieMap</span><span class="o">();</span>                    <span class="c1">// get all cookie key/values as map</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"key"</span><span class="o">);</span>                  <span class="c1">// get a header</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">headerMap</span><span class="o">();</span>                    <span class="c1">// get all header key/values as map</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">host</span><span class="o">();</span>                         <span class="c1">// get request host</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">ip</span><span class="o">();</span>                           <span class="c1">// get request up</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">isMultipart</span><span class="o">();</span>                  <span class="c1">// check if request is multipart</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">mapFormParams</span><span class="o">(</span><span class="s">"k1"</span><span class="o">,</span> <span class="s">"k2"</span><span class="o">);</span>      <span class="c1">// map form params to their values, returns null if any form param is missing</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">mapQueryParams</span><span class="o">(</span><span class="s">"k1"</span><span class="o">,</span> <span class="s">"k2"</span><span class="o">);</span>     <span class="c1">// map query params to their values, returns null if any query param is missing</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">matchedPath</span><span class="o">();</span>                  <span class="c1">// get matched path, ex "/path/:param"</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>                         <span class="c1">// pass the request to the next handler</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">path</span><span class="o">();</span>                         <span class="c1">// get request path</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">port</span><span class="o">();</span>                         <span class="c1">// get request port</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">protocol</span><span class="o">();</span>                     <span class="c1">// get request protocol</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">queryParam</span><span class="o">(</span><span class="s">"key"</span><span class="o">);</span>              <span class="c1">// get query param</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">queryParams</span><span class="o">(</span><span class="s">"key"</span><span class="o">);</span>             <span class="c1">// get query param with multiple values</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">queryParamMap</span><span class="o">();</span>                <span class="c1">// get all query param key/values as map</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">queryString</span><span class="o">();</span>                  <span class="c1">// get request query string</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">method</span><span class="o">();</span>                       <span class="c1">// get request method</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">scheme</span><span class="o">();</span>                       <span class="c1">// get request scheme</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">sessionAttribute</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">);</span> <span class="c1">// set session-attribute "foo" to "bar"</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">sessionAttribute</span><span class="o">(</span><span class="s">"foo"</span><span class="o">);</span>        <span class="c1">// get session-attribute "foo"</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">sessionAttributeMap</span><span class="o">();</span>          <span class="c1">// get all session attributes as map</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">uploadedFile</span><span class="o">(</span><span class="s">"key"</span><span class="o">);</span>            <span class="c1">// get file from multipart form</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">uploadedFiles</span><span class="o">(</span><span class="s">"key"</span><span class="o">);</span>           <span class="c1">// get files from multipart form</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">uri</span><span class="o">();</span>                          <span class="c1">// get request uri</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">url</span><span class="o">();</span>                          <span class="c1">// get request url</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">userAgent</span><span class="o">();</span>                    <span class="c1">// get request user agent</span>

<span class="c1">// response methods:</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">response</span><span class="o">();</span>                     <span class="c1">// get underlying HttpServletResponse</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="s">"result"</span><span class="o">);</span>               <span class="c1">// set result (string)</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="n">inputStream</span><span class="o">);</span>            <span class="c1">// set result (stream)</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="n">future</span><span class="o">);</span>                 <span class="c1">// set result (future)</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">resultString</span><span class="o">();</span>                 <span class="c1">// get response result (string)</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">resultStream</span><span class="o">();</span>                 <span class="c1">// get response result (stream)</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">resultFuture</span><span class="o">();</span>                 <span class="c1">// get response result (future)</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">charset</span><span class="o">(</span><span class="s">"charset"</span><span class="o">);</span>             <span class="c1">// set response character encoding</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"key"</span><span class="o">,</span> <span class="s">"value"</span><span class="o">);</span>         <span class="c1">// set response header</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">html</span><span class="o">(</span><span class="s">"body html"</span><span class="o">);</span>              <span class="c1">// set result and html content type</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">json</span><span class="o">(</span><span class="n">object</span><span class="o">);</span>                   <span class="c1">// set result with object-as-json</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">redirect</span><span class="o">(</span><span class="s">"/location"</span><span class="o">);</span>          <span class="c1">// redirect to location</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">redirect</span><span class="o">(</span><span class="s">"/location"</span><span class="o">,</span> <span class="mi">302</span><span class="o">);</span>     <span class="c1">// redirect to location with code</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">();</span>                       <span class="c1">// get response status</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">404</span><span class="o">);</span>                    <span class="c1">// set response status</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">cookie</span><span class="o">(</span><span class="s">"key"</span><span class="o">,</span> <span class="s">"value"</span><span class="o">);</span>         <span class="c1">// set cookie with key and value</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">cookie</span><span class="o">(</span><span class="s">"key"</span><span class="o">,</span> <span class="s">"value"</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>      <span class="c1">// set cookie with key, value, and maxage</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">cookie</span><span class="o">(</span><span class="n">cookieBuilder</span><span class="o">);</span>          <span class="c1">// set cookie using cookiebuilder</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">removeCookie</span><span class="o">(</span><span class="s">"key"</span><span class="o">);</span>            <span class="c1">// remove cookie by key</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">removeCookie</span><span class="o">(</span><span class="s">"/path"</span><span class="o">,</span> <span class="s">"key"</span><span class="o">);</span>   <span class="c1">// remove cookie by path and key</span>
</code></pre>
</div>

<h3 id="cookie-store">Cookie Store</h3>

<p>The <code class="highlighter-rouge">ctx.cookieStore()</code> functions provide a convenient way for sharing information between handlers, request, or even servers:</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">ctx</span><span class="o">.</span><span class="na">cookieStore</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span> <span class="c1">// store any type of value</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">cookieStore</span><span class="o">(</span><span class="n">key</span><span class="o">);</span> <span class="c1">// read any type of value</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">clearCookieStore</span><span class="o">();</span> <span class="c1">// clear the cookie-store</span>
</code></pre>
</div>
<p>The cookieStore works like this:</p>
<ol>
  <li>The first handler that matches the incoming request will populate the cookie-store-map with the data currently stored in the cookie (if any).</li>
  <li>This map can now be used as a state between handlers on the same request-cycle, pretty much in the same way as <code class="highlighter-rouge">ctx.attribute()</code></li>
  <li>At the end of the request-cycle, the cookie-store-map is serialized, base64-encoded and written to the response as a cookie.
This allows you to share the map between requests and servers (in case you are running multiple servers behind a load-balancer)</li>
</ol>

<h3 id="example">Example:</h3>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">serverOneApp</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">"/cookie-storer"</span><span class="o">)</span> <span class="o">{</span> <span class="n">ctx</span> <span class="o">-&gt;</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">cookieStore</span><span class="o">(</span><span class="s">"string"</span><span class="o">,</span> <span class="s">"Hello world!"</span><span class="o">);</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">cookieStore</span><span class="o">(</span><span class="s">"i"</span><span class="o">,</span> <span class="mi">42</span><span class="o">);</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">cookieStore</span><span class="o">(</span><span class="s">"list"</span><span class="o">,</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"One"</span><span class="o">,</span> <span class="s">"Two"</span><span class="o">,</span> <span class="s">"Three"</span><span class="o">));</span>
<span class="o">}</span>
<span class="n">serverTwoApp</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/cookie-reader"</span><span class="o">)</span> <span class="o">{</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="c1">// runs on a different server than serverOneApp</span>
    <span class="n">String</span> <span class="n">string</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">cookieStore</span><span class="o">(</span><span class="s">"string"</span><span class="o">)</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">cookieStore</span><span class="o">(</span><span class="s">"i"</span><span class="o">)</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">cookieStore</span><span class="o">(</span><span class="s">"list"</span><span class="o">)</span>
<span class="o">}</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">serverOneApp</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/cookie-storer"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">cookieStore</span><span class="p">(</span><span class="s">"string"</span><span class="p">,</span> <span class="s">"Hello world!"</span><span class="p">)</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">cookieStore</span><span class="p">(</span><span class="s">"i"</span><span class="p">,</span> <span class="m">42</span><span class="p">)</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">cookieStore</span><span class="p">(</span><span class="s">"list"</span><span class="p">,</span> <span class="n">listOf</span><span class="p">(</span><span class="s">"One"</span><span class="p">,</span> <span class="s">"Two"</span><span class="p">,</span> <span class="s">"Three"</span><span class="p">))</span>
<span class="p">}</span>
<span class="n">serverTwoApp</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"/cookie-reader"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="c1">// runs on a different server than serverOneApp
</span>    <span class="kd">val</span> <span class="py">string</span> <span class="p">=</span> <span class="n">ctx</span><span class="p">.</span><span class="n">cookieStore</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;(</span><span class="s">"string"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">i</span> <span class="p">=</span> <span class="n">ctx</span><span class="p">.</span><span class="n">cookieStore</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;(</span><span class="s">"i"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">list</span> <span class="p">=</span> <span class="n">ctx</span><span class="p">.</span><span class="n">cookieStore</span><span class="p">&lt;</span><span class="n">List</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;&gt;(</span><span class="s">"list"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<p>Since the client stores the cookie, the <code class="highlighter-rouge">get</code> request to <code class="highlighter-rouge">serverTwoApp</code>
will be able to retrieve the information that was passed in the <code class="highlighter-rouge">post</code> to <code class="highlighter-rouge">serverOneApp</code>.</p>

<p>Please note that cookies have a max-size of 4kb.</p>

<h3 id="context-extensions">Context extensions</h3>
<p>Context extensions give Java developers a way of extending the <code class="highlighter-rouge">Context</code> object.</p>

<p>One of the most popular features of Kotlin is <a href="https://kotlinlang.org/docs/reference/extensions.html">extension functions</a>.
When working with an object you donâ€™t own in Java, you often end up making <code class="highlighter-rouge">MyUtil.action(object, ...)</code>.
If you, for example, want to serialize an object and set it as the result on the <code class="highlighter-rouge">Context</code>, you might do:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">MyMapperUtil</span><span class="o">.</span><span class="na">serialize</span><span class="o">(</span><span class="n">ctx</span><span class="o">,</span> <span class="n">myMapper</span><span class="o">,</span> <span class="n">myObject</span><span class="o">));</span> <span class="c1">// three args, what happens where?</span>
</code></pre>
</div>

<p>With context extensions you can add custom extensions on the context:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">MyMapper</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">serialize</span><span class="o">(</span><span class="n">object</span><span class="o">));</span> <span class="c1">// use MyMapper to serialize object</span>
</code></pre>
</div>

<p>Context extensions have to be added before you can use them, this would typically be done in the first <code class="highlighter-rouge">before</code> filter of your app:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">before</span><span class="o">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">MyMapper</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="k">new</span> <span class="n">MyMapper</span><span class="o">(</span><span class="n">ctx</span><span class="o">,</span> <span class="n">otherDependency</span><span class="o">));</span>
</code></pre>
</div>

<h2 id="access-manager">Access manager</h2>
<p>Javalin has a functional interface <code class="highlighter-rouge">AccessManager</code>, which letâ€™s you
set per-endpoint authentication and/or authorization. Itâ€™s common to use before-handlers for this,
but per-endpoint security handlers give you much more explicit and readable code. You can implement your
access-manager however you want, but here is an example implementation:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// Set the access-manager that Javalin should use</span>
<span class="n">app</span><span class="o">.</span><span class="na">accessManager</span><span class="o">((</span><span class="n">handler</span><span class="o">,</span> <span class="n">ctx</span><span class="o">,</span> <span class="n">permittedRoles</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">MyRole</span> <span class="n">userRole</span> <span class="o">=</span> <span class="n">getUserRole</span><span class="o">(</span><span class="n">ctx</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">permittedRoles</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">userRole</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">handler</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="n">ctx</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">401</span><span class="o">).</span><span class="na">result</span><span class="o">(</span><span class="s">"Unauthorized"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">});</span>

<span class="n">Role</span> <span class="nf">getUserRole</span><span class="o">(</span><span class="n">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// determine user role based on request</span>
    <span class="c1">// typically done by inspecting headers</span>
<span class="o">}</span>

<span class="kd">enum</span> <span class="n">MyRole</span> <span class="kd">implements</span> <span class="n">Role</span> <span class="o">{</span>
    <span class="n">ANYONE</span><span class="o">,</span> <span class="n">ROLE_ONE</span><span class="o">,</span> <span class="n">ROLE_TWO</span><span class="o">,</span> <span class="n">ROLE_THREE</span><span class="o">;</span>
<span class="o">}</span>

<span class="n">app</span><span class="o">.</span><span class="na">routes</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">get</span><span class="o">(</span><span class="s">"/un-secured"</span><span class="o">,</span>   <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="s">"Hello"</span><span class="o">),</span>   <span class="n">roles</span><span class="o">(</span><span class="n">ANYONE</span><span class="o">));</span>
    <span class="n">get</span><span class="o">(</span><span class="s">"/secured"</span><span class="o">,</span>      <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="s">"Hello"</span><span class="o">),</span>   <span class="n">roles</span><span class="o">(</span><span class="n">ROLE_ONE</span><span class="o">));</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="c1">// Set the access-manager that Javalin should use
</span><span class="n">app</span><span class="p">.</span><span class="n">accessManager</span> <span class="p">{</span> <span class="n">handler</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">permittedRoles</span> <span class="p">-&gt;</span>
    <span class="kd">val</span> <span class="py">userRole</span> <span class="p">=</span> <span class="n">getUserRole</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span> <span class="c1">// determine user role based on request
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">permittedRoles</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">userRole</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">handler</span><span class="p">.</span><span class="n">handle</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">ctx</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="m">401</span><span class="p">).</span><span class="n">result</span><span class="p">(</span><span class="s">"Unauthorized"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">getUserRole</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">)</span> <span class="p">:</span> <span class="n">Role</span> <span class="p">{</span>
    <span class="c1">// determine user role based on request
</span>    <span class="c1">// typically done by inspecting headers
</span><span class="p">}</span>

<span class="k">internal</span> <span class="k">enum</span> <span class="kd">class</span> <span class="nc">MyRole</span> <span class="p">:</span> <span class="n">Role</span> <span class="p">{</span>
    <span class="n">ANYONE</span><span class="p">,</span> <span class="n">ROLE_ONE</span><span class="p">,</span> <span class="n">ROLE_TWO</span><span class="p">,</span> <span class="n">ROLE_THREE</span>
<span class="p">}</span>

<span class="n">app</span><span class="p">.</span><span class="n">routes</span> <span class="p">{</span>
    <span class="k">get</span><span class="p">(</span><span class="s">"/un-secured"</span><span class="p">,</span>   <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="n">ctx</span><span class="p">.</span><span class="n">result</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">)},</span>   <span class="n">roles</span><span class="p">(</span><span class="n">MyRole</span><span class="p">.</span><span class="n">ANYONE</span><span class="p">));</span>
    <span class="k">get</span><span class="p">(</span><span class="s">"/secured"</span><span class="p">,</span>      <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="n">ctx</span><span class="p">.</span><span class="n">result</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">)},</span>   <span class="n">roles</span><span class="p">(</span><span class="n">MyRole</span><span class="p">.</span><span class="n">ROLE_ONE</span><span class="p">));</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h2 id="exception-mapping">Exception Mapping</h2>
<p>All handlers (before, endpoint, after) can throw <code class="highlighter-rouge">Exception</code>
(and any subclass of <code class="highlighter-rouge">Exception</code>)
The <code class="highlighter-rouge">app.exception()</code> method gives you a way of handling these exceptions:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">exception</span><span class="o">(</span><span class="n">NullPointerException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// handle nullpointers here</span>
<span class="o">});</span>

<span class="n">app</span><span class="o">.</span><span class="na">exception</span><span class="o">(</span><span class="n">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// handle general exceptions here</span>
    <span class="c1">// will not trigger if more specific exception-mapper found</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">exception</span><span class="p">(</span><span class="n">NullPointerException</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span> <span class="p">{</span> <span class="n">e</span><span class="p">,</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="c1">// handle nullpointers here
</span><span class="p">}</span>

<span class="n">app</span><span class="p">.</span><span class="n">exception</span><span class="p">(</span><span class="n">Exception</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span> <span class="p">{</span> <span class="n">e</span><span class="p">,</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="c1">// handle general exceptions here
</span>    <span class="c1">// will not trigger if more specific exception-mapper found
</span><span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h3 id="haltexception">HaltException</h3>
<p>Javalin has a <code class="highlighter-rouge">HaltException</code> which is handled before other exceptions. It can be used to short-circuit the request-lifecycle.
If you throw a <code class="highlighter-rouge">HaltException</code> in a <code class="highlighter-rouge">before</code>-handler, no <code class="highlighter-rouge">endpoint</code>-handler will fire.
When throwing a <code class="highlighter-rouge">HaltException</code> you can include a status code, a message, or both:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="k">throw</span> <span class="k">new</span> <span class="n">HaltException</span><span class="o">();</span>                     <span class="c1">// (status: 200, message: "Execution halted")</span>
<span class="k">throw</span> <span class="k">new</span> <span class="nf">HaltException</span><span class="o">(</span><span class="mi">401</span><span class="o">);</span>                  <span class="c1">// (status: 401, message: "Execution halted")</span>
<span class="k">throw</span> <span class="k">new</span> <span class="nf">HaltException</span><span class="o">(</span><span class="s">"My message"</span><span class="o">);</span>         <span class="c1">// (status: 200, message: "My message")</span>
<span class="k">throw</span> <span class="k">new</span> <span class="nf">HaltException</span><span class="o">(</span><span class="mi">401</span><span class="o">,</span> <span class="s">"Unauthorized"</span><span class="o">);</span>  <span class="c1">// (status: 401, message: "Unauthorized")</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="k">throw</span> <span class="n">HaltException</span><span class="p">()</span>                          <span class="c1">// (status: 200, message: "Execution halted")
</span><span class="k">throw</span> <span class="n">HaltException</span><span class="p">(</span><span class="m">401</span><span class="p">)</span>                       <span class="c1">// (status: 401, message: "Execution halted")
</span><span class="k">throw</span> <span class="n">HaltException</span><span class="p">(</span><span class="s">"My message"</span><span class="p">)</span>              <span class="c1">// (status: 200, message: "My message")
</span><span class="k">throw</span> <span class="n">HaltException</span><span class="p">(</span><span class="m">401</span><span class="p">,</span> <span class="s">"Unauthorized"</span><span class="p">)</span>       <span class="c1">// (status: 401, message: "Unauthorized")
</span></code></pre>
    </div>
  </div>
</div>

<h2 id="error-mapping">Error Mapping</h2>
<p>Error mapping is similar to exception mapping, but it operates on HTTP status codes instead of Exceptions:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="mi">404</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="s">"Generic 404 message"</span><span class="o">)</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="m">404</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">result</span><span class="p">(</span><span class="s">"Generic 404 message"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<p>It can make sense to use them together:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">exception</span><span class="o">(</span><span class="n">FileNotFoundException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">404</span><span class="o">);</span>
<span class="o">}).</span><span class="na">error</span><span class="o">(</span><span class="mi">404</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="s">"Generic 404 message"</span><span class="o">)</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">exception</span><span class="p">(</span><span class="n">FileNotFoundException</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span> <span class="p">{</span> <span class="n">e</span><span class="p">,</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="m">404</span><span class="p">)</span>
<span class="p">}.</span><span class="n">error</span><span class="p">(</span><span class="m">404</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">result</span><span class="p">(</span><span class="s">"Generic 404 message"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h2 id="websockets">WebSockets</h2>

<p>Javalin has a very intuitive way of handling WebSockets, similar to most node frameworks:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">ws</span><span class="o">(</span><span class="s">"/websocket/:path"</span><span class="o">,</span> <span class="n">ws</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">ws</span><span class="o">.</span><span class="na">onConnect</span><span class="o">(</span><span class="n">session</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Connected"</span><span class="o">));</span>
    <span class="n">ws</span><span class="o">.</span><span class="na">onMessage</span><span class="o">((</span><span class="n">session</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Received: "</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
        <span class="n">session</span><span class="o">.</span><span class="na">getRemote</span><span class="o">().</span><span class="na">sendString</span><span class="o">(</span><span class="s">"Echo: "</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
    <span class="o">});</span>
    <span class="n">ws</span><span class="o">.</span><span class="na">onClose</span><span class="o">((</span><span class="n">session</span><span class="o">,</span> <span class="n">statusCode</span><span class="o">,</span> <span class="n">reason</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Closed"</span><span class="o">));</span>
    <span class="n">ws</span><span class="o">.</span><span class="na">onError</span><span class="o">((</span><span class="n">session</span><span class="o">,</span> <span class="n">throwable</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Errored"</span><span class="o">));</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">ws</span><span class="p">(</span><span class="s">"/websocket/:path"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ws</span> <span class="p">-&gt;</span>
    <span class="n">ws</span><span class="p">.</span><span class="n">onConnect</span> <span class="p">{</span> <span class="n">session</span> <span class="p">-&gt;</span> <span class="n">println</span><span class="p">(</span><span class="s">"Connected"</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">ws</span><span class="p">.</span><span class="n">onMessage</span> <span class="p">{</span> <span class="n">session</span><span class="p">,</span> <span class="n">message</span> <span class="p">-&gt;</span>
        <span class="n">println</span><span class="p">(</span><span class="s">"Received: "</span> <span class="p">+</span> <span class="n">message</span><span class="p">)</span>
        <span class="n">session</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">sendString</span><span class="p">(</span><span class="s">"Echo: "</span> <span class="p">+</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">ws</span><span class="p">.</span><span class="n">onClose</span> <span class="p">{</span> <span class="n">session</span><span class="p">,</span> <span class="n">statusCode</span><span class="p">,</span> <span class="n">reason</span> <span class="p">-&gt;</span> <span class="n">println</span><span class="p">(</span><span class="s">"Closed"</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">ws</span><span class="p">.</span><span class="n">onError</span> <span class="p">{</span> <span class="n">session</span><span class="p">,</span> <span class="n">throwable</span> <span class="p">-&gt;</span> <span class="n">println</span><span class="p">(</span><span class="s">"Errored"</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h3 id="wssession">WsSession</h3>
<p>The <code class="highlighter-rouge">WsSession</code> object wraps Jettyâ€™s <code class="highlighter-rouge">Session</code> and adds the following methods:</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">session</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"message"</span><span class="o">)</span> <span class="c1">// send a message to session remote (the ws client)</span>
<span class="n">session</span><span class="o">.</span><span class="na">queryString</span><span class="o">()</span> <span class="c1">// get query-string from upgrade-request</span>
<span class="n">session</span><span class="o">.</span><span class="na">queryParam</span><span class="o">(</span><span class="s">"key"</span><span class="o">)</span> <span class="c1">// get query-param from upgrade-request</span>
<span class="n">session</span><span class="o">.</span><span class="na">queryParams</span><span class="o">(</span><span class="s">"key"</span><span class="o">)</span> <span class="c1">// get query-params from upgrade-request</span>
<span class="n">session</span><span class="o">.</span><span class="na">queryParamMap</span><span class="o">()</span> <span class="c1">// get query-param-map from upgrade-request</span>
<span class="n">session</span><span class="o">.</span><span class="na">mapQueryParams</span><span class="o">(</span><span class="s">"k1"</span><span class="o">,</span> <span class="s">"k2"</span><span class="o">)</span> <span class="c1">// map query-params to values (only useful in kotlin)</span>
<span class="n">session</span><span class="o">.</span><span class="na">anyQueryParamNull</span><span class="o">(</span><span class="s">"k1"</span><span class="o">,</span> <span class="s">"k2"</span><span class="o">)</span> <span class="c1">// check if any query-param from upgrade-request is null</span>
<span class="n">session</span><span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"key"</span><span class="o">)</span> <span class="c1">// get a path-parameter, ex "/:id" -&gt; param("id")</span>
<span class="n">session</span><span class="o">.</span><span class="na">paramMap</span><span class="o">()</span> <span class="c1">// get all param key/values as map</span>
<span class="n">session</span><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"key"</span><span class="o">)</span> <span class="c1">// get a header</span>
<span class="n">session</span><span class="o">.</span><span class="na">headerMap</span><span class="o">()</span> <span class="c1">// get all header key/values as map</span>
<span class="n">session</span><span class="o">.</span><span class="na">host</span><span class="o">()</span> <span class="c1">// get request host</span>
</code></pre>
</div>

<h2 id="lifecycle-events">Lifecycle events</h2>
<p>Javalin has five lifecycle events: <code class="highlighter-rouge">SERVER_STARTING</code>, <code class="highlighter-rouge">SERVER_STARTED</code>, <code class="highlighter-rouge">SERVER_START_FAILED</code>, <code class="highlighter-rouge">SERVER_STOPPING</code> and <code class="highlighter-rouge">SERVER_STOPPED</code>.
The snippet below shows all of them in action:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span> <span class="n">app</span> <span class="o">=</span> <span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">()</span>
    <span class="o">.</span><span class="na">event</span><span class="o">(</span><span class="n">EventType</span><span class="o">.</span><span class="na">SERVER_STARTING</span><span class="o">,</span> <span class="n">e</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="o">...</span> <span class="o">})</span>
    <span class="o">.</span><span class="na">event</span><span class="o">(</span><span class="n">EventType</span><span class="o">.</span><span class="na">SERVER_STARTED</span><span class="o">,</span> <span class="n">e</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="o">...</span> <span class="o">})</span>
    <span class="o">.</span><span class="na">event</span><span class="o">(</span><span class="n">EventType</span><span class="o">.</span><span class="na">SERVER_START_FAILED</span><span class="o">,</span> <span class="n">e</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="o">...</span> <span class="o">})</span>
    <span class="o">.</span><span class="na">event</span><span class="o">(</span><span class="n">EventType</span><span class="o">.</span><span class="na">SERVER_STOPPING</span><span class="o">,</span> <span class="n">e</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="o">...</span> <span class="o">})</span>
    <span class="o">.</span><span class="na">event</span><span class="o">(</span><span class="n">EventType</span><span class="o">.</span><span class="na">SERVER_STOPPED</span><span class="o">,</span> <span class="n">e</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="o">...</span> <span class="o">});</span>

<span class="n">app</span><span class="o">.</span><span class="na">start</span><span class="o">();</span> <span class="c1">// SERVER_STARTING -&gt; (SERVER_STARTED || SERVER_START_FAILED)</span>
<span class="n">app</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span> <span class="c1">// SERVER_STOPPING -&gt; SERVER_STOPPED</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="kd">val</span> <span class="py">app</span> <span class="p">=</span> <span class="n">Javalin</span><span class="p">.</span><span class="n">create</span><span class="p">()</span>
    <span class="p">.</span><span class="n">event</span><span class="p">(</span><span class="n">EventType</span><span class="p">.</span><span class="n">SERVER_STARTING</span><span class="p">,</span> <span class="p">{</span> <span class="n">e</span> <span class="p">-&gt;</span> <span class="o">..</span><span class="p">.</span> <span class="p">})</span>
    <span class="p">.</span><span class="n">event</span><span class="p">(</span><span class="n">EventType</span><span class="p">.</span><span class="n">SERVER_STARTED</span><span class="p">,</span> <span class="p">{</span> <span class="n">e</span> <span class="p">-&gt;</span> <span class="o">..</span><span class="p">.</span> <span class="p">})</span>
    <span class="p">.</span><span class="n">event</span><span class="p">(</span><span class="n">EventType</span><span class="p">.</span><span class="n">SERVER_START_FAILED</span><span class="p">,</span> <span class="p">{</span> <span class="n">e</span> <span class="p">-&gt;</span> <span class="o">..</span><span class="p">.</span> <span class="p">})</span>
    <span class="p">.</span><span class="n">event</span><span class="p">(</span><span class="n">EventType</span><span class="p">.</span><span class="n">SERVER_STOPPING</span><span class="p">,</span> <span class="p">{</span> <span class="n">e</span> <span class="p">-&gt;</span> <span class="o">..</span><span class="p">.</span> <span class="p">})</span>
    <span class="p">.</span><span class="n">event</span><span class="p">(</span><span class="n">EventType</span><span class="p">.</span><span class="n">SERVER_STOPPED</span><span class="p">,</span> <span class="p">{</span> <span class="n">e</span> <span class="p">-&gt;</span> <span class="o">..</span><span class="p">.</span> <span class="p">});</span>

<span class="n">app</span><span class="p">.</span><span class="n">start</span><span class="p">()</span> <span class="c1">// SERVER_STARTING -&gt; (SERVER_STARTED || SERVER_START_FAILED)
</span><span class="n">app</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span> <span class="c1">// SERVER_STOPPING -&gt; SERVER_STOPPED
</span></code></pre>
    </div>
  </div>
</div>

<p>The lambda takes an <code class="highlighter-rouge">Event</code> object, which contains the type of event that happened,
and a reference to the <code class="highlighter-rouge">this</code> (the javalin object which triggered the event).</p>

<h2 id="server-setup">Server setup</h2>

<p>Javalin runs on an embedded <a href="http://eclipse.org/jetty/">Jetty</a>.
The architecture for adding other embedded servers is in place, and pull requests are welcome.</p>

<h3 id="starting-and-stopping">Starting and stopping</h3>
<p>To start and stop the server, use the appropriately named <code class="highlighter-rouge">start()</code> and <code class="highlighter-rouge">stop</code> methods.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span> <span class="n">app</span> <span class="o">=</span> <span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">()</span>
    <span class="o">.</span><span class="na">start</span><span class="o">()</span> <span class="c1">// start server (sync/blocking)</span>
    <span class="o">.</span><span class="na">stop</span><span class="o">()</span> <span class="c1">// stop server (sync/blocking)</span>
</code></pre>
</div>

<h4 id="quick-start">Quick-start</h4>
<p>If you donâ€™t need any custom configuration, you can use the <code class="highlighter-rouge">Javalin.start(port)</code> method.</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span> <span class="n">app</span> <span class="o">=</span> <span class="n">Javalin</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="mi">7000</span><span class="o">);</span>
</code></pre>
</div>
<p>This creates a new server which listens on the specified port (here, <code class="highlighter-rouge">7000</code>), and starts it.</p>

<h3 id="configuration">Configuration</h3>
<p>The following snippet shows all the configuration currently available in Javalin:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">()</span> <span class="c1">// create has to be called first</span>
    <span class="o">.</span><span class="na">contextPath</span><span class="o">(</span><span class="s">"/context-path"</span><span class="o">)</span> <span class="c1">// set a context path (default is "/")</span>
    <span class="o">.</span><span class="na">dontIgnoreTrailingSlashes</span><span class="o">()</span> <span class="c1">// treat '/test' and '/test/' as different URLs</span>
    <span class="o">.</span><span class="na">defaultContentType</span><span class="o">(</span><span class="n">string</span><span class="o">)</span> <span class="c1">// set a default content-type for responses</span>
    <span class="o">.</span><span class="na">defaultCharacterEncoding</span><span class="o">(</span><span class="n">string</span><span class="o">)</span> <span class="c1">// set a default character-encoding for responses</span>
    <span class="o">.</span><span class="na">disableStartupBanner</span><span class="o">()</span> <span class="c1">// remove the javalin startup banner from logs</span>
    <span class="o">.</span><span class="na">embeddedServer</span><span class="o">(</span> <span class="o">...</span> <span class="o">)</span> <span class="c1">// see section below</span>
    <span class="o">.</span><span class="na">enableCorsForOrigin</span><span class="o">(</span><span class="s">"origin"</span><span class="o">)</span> <span class="c1">// enables cors for the specified origin(s)</span>
    <span class="o">.</span><span class="na">enableDynamicGzip</span><span class="o">()</span> <span class="c1">// gzip response (if client accepts gzip and response is more than 1500 bytes)</span>
    <span class="o">.</span><span class="na">enableRouteOverview</span><span class="o">(</span><span class="s">"/path"</span><span class="o">)</span> <span class="c1">// render a HTML page showing all mapped routes</span>
    <span class="o">.</span><span class="na">enableStandardRequestLogging</span><span class="o">()</span> <span class="c1">// does requestLogLevel(LogLevel.STANDARD)</span>
    <span class="o">.</span><span class="na">enableStaticFiles</span><span class="o">(</span><span class="s">"/public"</span><span class="o">)</span> <span class="c1">// enable static files (opt. second param Location.CLASSPATH/Location.EXTERNAL)</span>
    <span class="o">.</span><span class="na">maxBodySizeForRequestCache</span><span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="c1">// set max body size for request cache</span>
    <span class="o">.</span><span class="na">port</span><span class="o">(</span><span class="n">port</span><span class="o">)</span> <span class="c1">// set the port</span>
    <span class="o">.</span><span class="na">start</span><span class="o">();</span> <span class="c1">// start has to be called last</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span><span class="p">.</span><span class="n">create</span><span class="p">().</span><span class="n">apply</span> <span class="p">{</span> <span class="c1">// create has to be called first
</span>    <span class="n">contextPath</span><span class="p">(</span><span class="s">"/context-path"</span><span class="p">)</span> <span class="c1">// set a context path (default is "/")
</span>    <span class="n">dontIgnoreTrailingSlashes</span><span class="p">()</span> <span class="c1">// treat '/test' and '/test/' as different URLs
</span>    <span class="n">defaultContentType</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="c1">// set a default content-type for responses
</span>    <span class="n">defaultCharacterEncoding</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="c1">// set a default character-encoding for responses
</span>    <span class="n">disableStartupBanner</span><span class="p">()</span> <span class="c1">// remove the javalin startup banner from logs
</span>    <span class="n">embeddedServer</span><span class="p">(</span> <span class="o">..</span><span class="p">.</span> <span class="p">)</span> <span class="c1">// see section below
</span>    <span class="n">enableCorsForOrigin</span><span class="p">(</span><span class="s">"origin"</span><span class="p">)</span> <span class="c1">// enables cors for the specified origin(s)
</span>    <span class="n">enableRouteOverview</span><span class="p">(</span><span class="s">"/path"</span><span class="p">)</span> <span class="c1">// render a HTML page showing all mapped routes
</span>    <span class="n">enableDynamicGzip</span><span class="p">()</span> <span class="c1">// gzip response (if client accepts gzip and response is more than 1500 bytes)
</span>    <span class="n">enableStandardRequestLogging</span><span class="p">()</span> <span class="c1">// does requestLogLevel(LogLevel.STANDARD)
</span>    <span class="n">enableStaticFiles</span><span class="p">(</span><span class="s">"/public"</span><span class="p">)</span> <span class="c1">// enable static files (opt. second param Location.CLASSPATH/Location.EXTERNAL)
</span>    <span class="n">maxBodySizeForRequestCache</span><span class="p">(</span><span class="n">long</span><span class="p">)</span> <span class="c1">// set max body size for request cache
</span>    <span class="n">port</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="c1">// set the port
</span><span class="p">}.</span><span class="n">start</span><span class="p">()</span> <span class="c1">// start has to be called last
</span></code></pre>
    </div>
  </div>
</div>

<p>Any argument to <code class="highlighter-rouge">contextPath()</code> will be normalized to the form <code class="highlighter-rouge">/path</code> (slash, path, no-slash)</p>

<h3 id="custom-server">Custom server</h3>
<p>If you need to customize the embedded server, you can call the <code class="highlighter-rouge">app.embeddedServer()</code> method:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">embeddedServer</span><span class="o">(</span><span class="k">new</span> <span class="n">EmbeddedJettyFactory</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">Server</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="o">();</span>
    <span class="c1">// do whatever you want here</span>
    <span class="k">return</span> <span class="n">server</span><span class="o">;</span>
<span class="o">}));</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">embeddedServer</span><span class="p">(</span><span class="n">EmbeddedJettyFactory</span><span class="p">({</span>
    <span class="kd">val</span> <span class="py">server</span> <span class="p">=</span> <span class="n">Server</span><span class="p">()</span>
    <span class="c1">// do whatever you want here
</span>    <span class="n">server</span>
<span class="p">}))</span>
</code></pre>
    </div>
  </div>
</div>

<h4 id="custom-jetty-handlers">Custom jetty handlers</h4>
<p>You can configure your embedded jetty-server with a handler-chain
(<a href="https://github.com/javalin/javalin/blob/master/src/test/java/io/javalin/TestCustomJetty.java#L66-L82">example</a>),
and Javalin will attach itâ€™s own handlers to the end of this chain.</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">StatisticsHandler</span> <span class="n">statisticsHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StatisticsHandler</span><span class="o">();</span>

<span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">()</span>
    <span class="o">.</span><span class="na">embeddedServer</span><span class="o">(</span><span class="k">new</span> <span class="n">EmbeddedJettyFactory</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">Server</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="o">();</span>
        <span class="n">server</span><span class="o">.</span><span class="na">setHandler</span><span class="o">(</span><span class="n">statisticsHandler</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">server</span><span class="o">;</span>
    <span class="o">}))</span>
    <span class="o">.</span><span class="na">start</span><span class="o">();</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="kd">val</span> <span class="py">statisticsHandler</span> <span class="p">=</span> <span class="n">StatisticsHandler</span><span class="p">()</span>

<span class="n">Javalin</span><span class="p">.</span><span class="n">create</span><span class="p">().</span><span class="n">apply</span> <span class="p">{</span>
    <span class="n">embeddedServer</span><span class="p">(</span><span class="n">EmbeddedJettyFactory</span><span class="p">({</span>
        <span class="n">Server</span><span class="p">(</span><span class="n">queuedThreadPool</span><span class="p">).</span><span class="n">apply</span> <span class="p">{</span>
            <span class="n">handler</span> <span class="p">=</span> <span class="n">statisticsHandler</span>
        <span class="p">}</span>
    <span class="p">}))</span>
<span class="p">}.</span><span class="n">start</span><span class="p">();</span>
</code></pre>
    </div>
  </div>
</div>

<h3 id="sslhttp2">SSL/HTTP2</h3>

<p>To configure SSL or HTTP2 you need to use a custom server (see previous section).<br />
An example of a custom server with SSL can be found in the examples,
<a href="https://github.com/javalin/javalin/blob/master/src/test/java/io/javalin/examples/HelloWorldSecure.java#L24-L32">HelloWorldSecure</a>.</p>

<p>A custom HTTP2 server is a bit more work to set up, but we have a repo with a
fully functioning example server in both Kotlin and Java: <a href="https://github.com/tipsy/javalin-http2-example">javalin-http2-example</a></p>

<h3 id="static-files">Static Files</h3>
<p>You can enabled static file serving by doing <code class="highlighter-rouge">app.enableStaticFiles("/classpath-folder")</code>, and/or
<code class="highlighter-rouge">app.enableStaticFiles("/folder", Location.EXTERNAL)</code>.
Static resource handling is done <strong>after</strong> endpoint matching,
meaning your self-defined endpoints have higher priority. The process looks like this:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>run before-handlers
run endpoint-handlers
<span class="k">if </span>no-endpoint-handler-found
    run static-file-handler
    <span class="k">if </span>static-file-found
        static-file-handler finishes response and
        sends to user <span class="o">(</span>response is commited<span class="o">)</span>
    <span class="k">else
        </span>response is 404, javalin finishes the response
        with after-handlers and error-mapping
</code></pre>
</div>
<p>If you do <code class="highlighter-rouge">app.enableStaticFiles("/classpath-folder")</code>.
Your <code class="highlighter-rouge">index.html</code> file at <code class="highlighter-rouge">/classpath-folder/index.html</code> will be available
at <code class="highlighter-rouge">http://{host}:{port}/index.html</code> and <code class="highlighter-rouge">http://{host}:{port}/</code>.</p>

<p>You can call <code class="highlighter-rouge">enableStaticFiles</code> multiple times to set up multiple handlers.</p>

<h4 id="caching">Caching</h4>
<p>Javalin serves static files with the <code class="highlighter-rouge">Cache-Control</code> header set to <code class="highlighter-rouge">max-age=0</code>. This means
that browsers will always ask if the file is still valid. If the version the browser has in cache
is the same as the version on the server, Javalin will respond with a <code class="highlighter-rouge">304 Not modified</code> status,
and no response body. This tells the browser that itâ€™s okay to keep using the cached version.
If you want to skip this check, you can put files in a dir called <code class="highlighter-rouge">immutable</code>,
and Javalin will set <code class="highlighter-rouge">max-age=31622400</code>, which means that the browser will wait
one year before checking if the file is still valid.
This should only be used for versioned library files, like <code class="highlighter-rouge">vue-2.4.2.min.js</code>, to avoid
the browser ending up with an outdated version if you change the file content.</p>

<h3 id="jetty-websockets">Jetty WebSockets</h3>

<p>Javalin supports native Jetty WebSockets, but these must be declared before starting the server.
There are two different ways of using these WebSockets:</p>

<h3 id="annotated-class">Annotated class</h3>
<p>You can pass an annotated class to the <code class="highlighter-rouge">ws()</code> function:</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">ws</span><span class="o">(</span><span class="s">"/websocket"</span><span class="o">,</span> <span class="n">WebSocketClass</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</code></pre>
</div>

<p>Annotation API can be found on <a href="http://www.eclipse.org/jetty/documentation/9.4.x/jetty-websocket-api-annotations.html">Jettyâ€™s docs page</a></p>

<h3 id="websocket-object">WebSocket object</h3>
<p>You can pass any object that fulfills Jettyâ€™s requirements (annotated/implementing <code class="highlighter-rouge">WebSocketListener</code>, etc):</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">ws</span><span class="o">(</span><span class="s">"/websocket"</span><span class="o">,</span> <span class="k">new</span> <span class="n">WebSocketObject</span><span class="o">());</span>
</code></pre>
</div>

<h2 id="faq">FAQ</h2>
<p>Frequently asked questions</p>

<h3 id="javadoc">Javadoc</h3>
<p>There is a Javadoc available at <a href="http://javadoc.io/doc/io.javalin/javalin">javadoc.io</a>.
Please contribute to the Javadoc if you can.</p>

<h3 id="deploying">Deploying</h3>
<p>To deploy Javalin, simply create a <a href="https://maven.apache.org/plugins/maven-assembly-plugin/usage.html">jar with dependencies</a>,
then launch the jar with <code class="highlighter-rouge">java -jar filename.jar</code>. Thatâ€™s it.
Javalin has an embedded server, so you donâ€™t need an application server.
There is also a tutorial on <a href="/tutorials/heroku">deploying Javalin to Heroku</a>.</p>

<h3 id="uploads">Uploads</h3>

<p>Uploaded files are easily accessible via <code class="highlighter-rouge">ctx.uploadedFiles()</code>:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">"/upload"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">uploadedFiles</span><span class="o">(</span><span class="s">"files"</span><span class="o">).</span><span class="na">forEach</span><span class="o">(</span><span class="n">file</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">FileUtils</span><span class="o">.</span><span class="na">copyInputStreamToFile</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getContent</span><span class="o">(),</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"upload/"</span> <span class="o">+</span> <span class="n">file</span><span class="o">.</span><span class="na">getName</span><span class="o">()));</span>
    <span class="o">});</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/upload"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">uploadedFiles</span><span class="p">(</span><span class="s">"files"</span><span class="p">).</span><span class="n">forEach</span> <span class="p">{</span> <span class="p">(</span><span class="n">contentType</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">extension</span><span class="p">)</span> <span class="p">-&gt;</span>
        <span class="n">content</span><span class="p">.</span><span class="n">copyTo</span><span class="p">(</span><span class="n">File</span><span class="p">(</span><span class="s">"upload/"</span> <span class="p">+</span> <span class="n">name</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<p>The corresponding HTML would be something like:</p>
<pre><code class="language-markup">&lt;form method="post" action="/upload" enctype="multipart/form-data"&gt;
    &lt;input type="file" name="files" multiple&gt;
    &lt;button&gt;Submit&lt;/button&gt;
&lt;/form&gt;
</code></pre>

<h3 id="logging">Adding a logger</h3>

<p>If youâ€™re reading this, youâ€™ve probably seen the following message while running Javalin:</p>

<div class="language-text highlighter-rouge"><pre class="highlight"><code>SLF4J: Failed to load class "org.slf4j.impl.StaticLoggerBinder".
SLF4J: Defaulting to no-operation (NOP) logger implementation
SLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.
</code></pre>
</div>

<p>This is nothing to worry about.</p>

<p>Like a lot of other Java projects, Javalin does not have a logger included,
which means that you have to add your own logger. If you donâ€™t know/care
a lot about Java loggers, the easiest way to fix this is to add the following
dependency to your project:</p>

<pre><code class="language-markup">&lt;dependency&gt;
    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
    &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;
    &lt;version&gt;1.7.36&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p>This will remove the warning from SLF4J, and enable
helpful debug messages while running Javalin.</p>

<h3 id="asynchronous-requests">Asynchronous requests</h3>
<p>Javalin 1.6.0 introduced future results. While the default threadpool (200 threads) is enough for most use cases,
sometimes slow operations should be run asynchronously. Luckily itâ€™s very easy in Javalin, just
pass a <code class="highlighter-rouge">CompletableFuture</code> to <code class="highlighter-rouge">ctx.result()</code>:</p>

<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">io.javalin.Javalin</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">Array</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">app</span> <span class="p">=</span> <span class="n">Javalin</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="m">7000</span><span class="p">)</span>
    <span class="n">app</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="n">ctx</span><span class="p">.</span><span class="n">result</span><span class="p">(</span><span class="n">getFuture</span><span class="p">())</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// hopefully your future is less pointless than this:
</span><span class="k">private</span> <span class="k">fun</span> <span class="nf">getFuture</span><span class="p">()</span> <span class="p">=</span> <span class="n">CompletableFuture</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;().</span><span class="n">apply</span> <span class="p">{</span>
    <span class="n">Executors</span><span class="p">.</span><span class="n">newSingleThreadScheduledExecutor</span><span class="p">().</span><span class="n">schedule</span><span class="p">({</span> <span class="k">this</span><span class="p">.</span><span class="n">complete</span><span class="p">(</span><span class="s">"Hello World!"</span><span class="p">)</span> <span class="p">},</span> <span class="m">1</span><span class="p">,</span> <span class="n">TimeUnit</span><span class="p">.</span><span class="n">SECONDS</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>
<div class="comment">Synonyms for ctrl+f: Async, CompletableFuture, Future, Concurrent, Concurrency</div>

<p>You can only set future results in endpoint handlers (get/post/put/etc).<br />
After-handlers, exception-handlers and error-handlers run like youâ€™d expect them to after
the future has been resolved or rejected.</p>

<h3 id="configuring-the-json-mapper">Configuring the JSON mapper</h3>

<p>The JSON mapper can be configured like this:</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GsonBuilder</span><span class="o">().</span><span class="na">create</span><span class="o">();</span>
<span class="n">JavalinJsonPlugin</span><span class="o">.</span><span class="na">setJsonToObjectMapper</span><span class="o">(</span><span class="nl">gson:</span><span class="o">:</span><span class="n">fromJson</span><span class="o">);</span>
<span class="n">JavalinJsonPlugin</span><span class="o">.</span><span class="na">setObjectToJsonMapper</span><span class="o">(</span><span class="nl">gson:</span><span class="o">:</span><span class="n">toJson</span><span class="o">);</span>
</code></pre>
</div>

<h4 id="configuring-jackson">Configuring Jackson</h4>

<p>The JSON mapper uses Jackson by default, which can be configured by calling:</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">JavalinJacksonPlugin</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span><span class="n">objectMapper</span><span class="o">)</span>
</code></pre>
</div>

<p>Note that these are global settings, and canâ€™t be configured per instance of Javalin.</p>

<h3 id="views-and-templates">Views and Templates</h3>

<p>Javalin currently supports five template engines, as well as markdown:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">ctx</span><span class="o">.</span><span class="na">renderThymeleaf</span><span class="o">(</span><span class="s">"/templateFile"</span><span class="o">,</span> <span class="n">model</span><span class="o">(</span><span class="s">"firstName"</span><span class="o">,</span> <span class="s">"John"</span><span class="o">,</span> <span class="s">"lastName"</span><span class="o">,</span> <span class="s">"Doe"</span><span class="o">))</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">renderVelocity</span><span class="o">(</span><span class="s">"/templateFile"</span><span class="o">,</span> <span class="n">model</span><span class="o">(</span><span class="s">"firstName"</span><span class="o">,</span> <span class="s">"John"</span><span class="o">,</span> <span class="s">"lastName"</span><span class="o">,</span> <span class="s">"Doe"</span><span class="o">))</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">renderFreemarker</span><span class="o">(</span><span class="s">"/templateFile"</span><span class="o">,</span> <span class="n">model</span><span class="o">(</span><span class="s">"firstName"</span><span class="o">,</span> <span class="s">"John"</span><span class="o">,</span> <span class="s">"lastName"</span><span class="o">,</span> <span class="s">"Doe"</span><span class="o">))</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">renderMustache</span><span class="o">(</span><span class="s">"/templateFile"</span><span class="o">,</span> <span class="n">model</span><span class="o">(</span><span class="s">"firstName"</span><span class="o">,</span> <span class="s">"John"</span><span class="o">,</span> <span class="s">"lastName"</span><span class="o">,</span> <span class="s">"Doe"</span><span class="o">))</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">renderJtwig</span><span class="o">(</span><span class="s">"/templateFile"</span><span class="o">,</span> <span class="n">model</span><span class="o">(</span><span class="s">"firstName"</span><span class="o">,</span> <span class="s">"John"</span><span class="o">,</span> <span class="s">"lastName"</span><span class="o">,</span> <span class="s">"Doe"</span><span class="o">))</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">renderMarkdown</span><span class="o">(</span><span class="s">"/markdownFile"</span><span class="o">)</span>
<span class="c1">// Javalin looks for templates/markdown files in src/resources</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">ctx</span><span class="p">.</span><span class="n">renderThymeleaf</span><span class="p">(</span><span class="s">"/templateFile"</span><span class="p">,</span> <span class="n">mapOf</span><span class="p">(</span><span class="s">"firstName"</span> <span class="n">to</span> <span class="s">"John"</span><span class="p">,</span> <span class="s">"lastName"</span> <span class="n">to</span> <span class="s">"Doe"</span><span class="p">))</span>
<span class="n">ctx</span><span class="p">.</span><span class="n">renderVelocity</span><span class="p">(</span><span class="s">"/templateFile"</span><span class="p">,</span> <span class="n">mapOf</span><span class="p">(</span><span class="s">"firstName"</span> <span class="n">to</span> <span class="s">"John"</span><span class="p">,</span> <span class="s">"lastName"</span> <span class="n">to</span> <span class="s">"Doe"</span><span class="p">))</span>
<span class="n">ctx</span><span class="p">.</span><span class="n">renderFreemarker</span><span class="p">(</span><span class="s">"/templateFile"</span><span class="p">,</span> <span class="n">mapOf</span><span class="p">(</span><span class="s">"firstName"</span> <span class="n">to</span> <span class="s">"John"</span><span class="p">,</span> <span class="s">"lastName"</span> <span class="n">to</span> <span class="s">"Doe"</span><span class="p">))</span>
<span class="n">ctx</span><span class="p">.</span><span class="n">renderMustache</span><span class="p">(</span><span class="s">"/templateFile"</span><span class="p">,</span> <span class="n">mapOf</span><span class="p">(</span><span class="s">"firstName"</span> <span class="n">to</span> <span class="s">"John"</span><span class="p">,</span> <span class="s">"lastName"</span> <span class="n">to</span> <span class="s">"Doe"</span><span class="p">))</span>
<span class="n">ctx</span><span class="p">.</span><span class="n">renderJtwig</span><span class="p">(</span><span class="s">"/templateFile"</span><span class="p">,</span> <span class="n">mapOf</span><span class="p">(</span><span class="s">"firstName"</span> <span class="n">to</span> <span class="s">"John"</span><span class="p">,</span> <span class="s">"lastName"</span> <span class="n">to</span> <span class="s">"Doe"</span><span class="p">))</span>
<span class="n">ctx</span><span class="p">.</span><span class="n">renderMarkdown</span><span class="p">(</span><span class="s">"/markdownFile"</span><span class="p">)</span>
<span class="c1">// Javalin looks for templates/markdown files in src/resources
</span></code></pre>
    </div>
  </div>
</div>

<p>Configure:</p>
<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">JavalinThymeleafPlugin</span><span class="p">.</span><span class="n">configure</span><span class="p">(</span><span class="n">templateEngine</span><span class="p">)</span>
<span class="n">JavalinVelocityPlugin</span><span class="p">.</span><span class="n">configure</span><span class="p">(</span><span class="n">velocityEngine</span><span class="p">)</span>
<span class="n">JavalinFreemarkerPlugin</span><span class="p">.</span><span class="n">configure</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
<span class="n">JavalinMustachePlugin</span><span class="p">.</span><span class="n">configure</span><span class="p">(</span><span class="n">mustacheFactory</span><span class="p">)</span>
<span class="n">JavalinJtwigPlugin</span><span class="p">.</span><span class="n">configure</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
<span class="n">JavalinCommonmarkPlugin</span><span class="p">.</span><span class="n">configure</span><span class="p">(</span><span class="n">htmlRenderer</span><span class="p">,</span> <span class="n">markdownParser</span><span class="p">)</span>
</code></pre>
</div>
<p>Note that these are global settings, and canâ€™t be configured per instance of Javalin.</p>

<h3 id="timeoutexceptions-and-closedchannelexceptions">TimeoutExceptions and ClosedChannelExceptions</h3>
<p>So, youâ€™re seeing <code class="highlighter-rouge">TimeoutExceptions</code> and <code class="highlighter-rouge">ClosedChannelExceptions</code> in your DEBUG logs?
There is nothing to worry about, typically a browser will keep the HTTP connection open until the
server terminates it. When this happens is decided by the serverâ€™s <code class="highlighter-rouge">idleTimeout</code> setting,
which is 30 seconds by default in Jetty/Javalin. This is not a bug.</p>

        <script src="/js/anchor.min.js"></script>
        <script>
            anchors.options.placement = 'left';
            anchors.add();
        </script>

    </main>
    <footer>
        Javalin is a Java and Kotlin web framework, open sourced under the
        <a href="https://tldrlegal.com/license/apache-license-2.0-(apache-2.0)">Apache 2</a> license
        | <a href="/download">Download</a>
        | <a href="/about">About</a>
        | <a href="/news">News</a>
        | <a href="/about#contact">Contact</a>
        | <a href="/for-educators">For educators</a>
    </footer>
    <div id="star-begging">
    <style>
        #star-begging {
            transition: transform .25s;
            transform: scale(0);
            border-radius: 8px;
            position: fixed;
            bottom: 32px;
            right: 32px;
            padding: 20px 40px 16px 20px;
            background: #fff;
            box-shadow: 0 1px 20px rgba(0, 0, 0, 0.15);
            z-index: 9999998;
        }
        #star-begging.in {
            transform: scale(1);
        }
        #star-begging.out {
            transform: translateX(400px);
        }
        #star-begging p {
            font-size: 16px;
            margin: 0 0 15px;
        }
        #star-begging .close {
            position: absolute;
            right: 20px;
            top: 20px;
            height: 40px;
            width: 40px;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-family: arial, sans-serif;
            cursor: pointer;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 5px;
        }
    </style>
    <p>
        Like Javalin?
        <br>Star us ðŸ˜Š
    </p>
    <span class="close">Ã—</span>
    <iframe id="starFrame" class="githubStar" title="github-stars"
            src="https://ghbtns.com/github-btn.html?user=javalin&amp;repo=javalin&amp;type=star&amp;count=true&size=large"
            frameborder="0" scrolling="0" width="150px" height="30px">
    </iframe>
    <script>
        if (localStorage.getItem("dismissed") !== "true" && document.getElementById("notification-banner") === null) {
            setTimeout(function () {
                document.querySelector("#star-begging").classList.add("in");
            }, 15000);
            document.querySelector("#star-begging .close").addEventListener("click", function () {
                document.querySelector("#star-begging").classList.add("out");
                localStorage.setItem("dismissed", "true");
            });
        }
    </script>
</div>

    <script src="/js/scripts.js"></script>
</body>
</html>
