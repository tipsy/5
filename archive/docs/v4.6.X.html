<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-54137818-11"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-54137818-11', {'anonymize_ip': true});
</script>
    <meta charset="utf-8">
    <link href="https://fonts.googleapis.com/css?family=Oxygen+Mono|Roboto+Slab:500,700&display=swap" rel="stylesheet">
    <meta property="og:title" content="Archive - v4 Documentation - Javalin - A lightweight Java and Kotlin web framework. Create REST APIs in Java or Kotlin easily.">
    <meta property="og:site_name" content="Javalin">
    <meta property="og:url" content="https://javalin.io">
    <meta property="og:description" content="Javalin - A lightweight Java and Kotlin web framework. Create REST APIs in Java or Kotlin easily.">
    <meta property="og:image" content="https://javalin.io/img/javalin.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="liMtSlffOZROWLqoiOZdSx-luH9_Siq5-Ot6xqHZwq8">
    <title>
        Archive - v4 Documentation - Javalin - A lightweight Java and Kotlin web framework
    </title>
    <meta name="description" content="Javalin - A lightweight Java and Kotlin web framework. Create REST APIs in Java or Kotlin easily.">
    <link rel="canonical" href="5//archive/docs/v4.6.X.html">
    <link rel="shortcut icon" type="image/png" href="/img/favicon.png">
    <link rel="stylesheet" href="/css/main.css">
    <style>/* Styles that affect the length of the document */
p code,
li code {
    font-size: 90%;
    letter-spacing: -0.5px;
    border: 1px solid #ccd;
    background: #f5f5f7;
    padding: 1px 3px;
}

.multitab-code pre {
    margin-top: 0;
    border-radius: 0 0 5px 5px;
}

.multitab-code div[data-tab] {
    display: none;
}

:target {
    scroll-margin-top: 108px;
}

.anchorjs-link {
    transition: all .25s linear;
  }
  
*:hover > .anchorjs-link {
    margin-left: -1.125em !important;
 }</style>
</head>
<body>
    <a id="fork-me" href="https://github.com/javalin/javalin" target="_blank">
    <img style="position:fixed;top:0;right:0;border:0;z-index:99999" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJUAAACVCAMAAABmfEh9AAAAllBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPEhwAAAAFBgkAAAARFR8fIiwRFB4YHCUQEx0RFB4SFiERFB8QEx3s7e4eIStPUlpKTFUvMjwOEhs8P0hfYmlXWmE5PUUZHSfd3uAnKjTAwcRnanB2eH5CRU6TlZqxs7bP0NKFh4yUlpqipKiUlpujpKiipKdzB4/DAAAAFXRSTlMAAwgBDREiKBYbL5wdQBjb3ZzclY3cWcIvAAAGZ0lEQVR42u2c3W7bMAyF02bL2q5bu7WLqDhW7Si24p902/u/3EglljxXQX1jixclsIv0QvhAHvAQZLJFF8vl1dX19afn/Ub9ej+2L5ufd6v725vPn66vr66ulsvFBOGoPj/LLJHvY8kkf/j2ZTUtlqe6ed6+JCOytX/ZPCLW/aRYnur2aZeo3QisjXogrO+TYjmq1ROqZgQWlvpxaiyisljf71dP+yQfJflk8mwtfbK+/NhnmxGSx1L/nBhraZP1ySbr7sc2O4xrEIMiTpqsu6+7zWGU5PNpi0hUfaxRkl9jqR9nxZLjJJ8d5s3W/mWU5Dfq56xY4z1x3iJuxnrinFg/xnrizJLfJZeLuMboJK9mbxDyIpPjkpvD48ySz4NQLpwnzopFY2CYqfzti7ibXfLZIQQlSoBjT1sRJL8bUgmCaiyWHwOjemKXqVIWYDwWljqmJ56h6jSVfyR+YOGJlCpbvipNhXBUbgycVfKqR3UuX0JUGNE8kcZA2VEphMLyZdIYabGieeJX74mYKyNEmiYaQCuLFdMTcy8sIUSuwWT6lYpI4SUfwRM9Vk1lbLQYYO3m90TVyxa1hgqqVEmHFdkTCaLRWQVa5rrAdMla+WzNPwYeXLaUBihyVBfUUhaAVh1zDNx1yZJllpLk20IWzqjjeaJXfK5J8ghVuQYRzxNdtpoOKt0674kjeVqNdFjqBAUatLJUMT3x0GtbCFXAqymVK2GkMZA80WH9gaqFLbVSGwxWI1ZbRhSFEAGsaKsRy7GFVlgsZT8yWI1YqkKtiUrpo+sPzhPjrEYsFv4jKGiMw/JjYCxPpCCotoDSYnFYjVgqRV3eQNNhRfdEwtoSVK51A+2wiBsVbww0BAWZBC08VuTVCAkroXQl8DdFLD6eaMCmK9+bTLzxxIdonqgIqixpGJTRPdGNgYIknwG0GZT4kcW5gLBQ8g0UugRzVhaLMVCIFF5lAXq7tsHhXGCxdCNlUboJItYYSEXMlOvxJTRK9AabqOeCg+ywslbYSExyIovuiQRxnpuPAICDDY/VSId1hCKrQHVtnsVqZJ1AIdMSTJqc2zyL1YiBhBr9voLOfTisRkqoMg2mAizksEHk8TwRxU5QhdGwdZKPey6wA7PZViQurOW6i/irESEMQckGc+UjqidaAtEiVAGtEJ7KST6KJ67dDuLYdfrWyp7BamTdnqFkDRj2vMJgNbI2lDFKmW6zGtqe5OOcC7z7EFSxRbhae6r1PoviiV71BhpJh6iyPCk++oXMUmm0HwyB8bvlcC74dXJqZLLZSkD/3yDirUYkNGmaN3maJsJkwmJFXo2c+kPdApi0hDaV557K4FyATFAilM6roupafTRPlJ3eZXGCMgAVZuuo4nnifuM9UQmCkgWQY1fQSPpjrNWIz5Y6QVVlhVBaifieaLFKldZ01SeoPBVSRfXEXYclEqgt1On0oxHrwmrEUU05BjptQZNQprStZf/uIwee6F6bYwwsa0nly7UmKHHxWyOeap4x0ICmFg9WWvSX4DcpHdWUReydC2StTpe7WuZdkw+sRgYPTrcacZonKF2i2nOkCntij2omTxQERWovpNsmvfl1weC56TzR33wwS9S5ZFoqGrjK3hioHk5Yg9em9ESnLZUa6lwlNFIc7br5/3PB7c3gsUk90WurAWnNOq3cDrzvibfDxyYdAx1WDcZ0UKStwbngPvDcHOeCGk5QUGSOynviKvDaHGOgqBHKb2wGP6i5Cz43xwldpd3GJnAuWIRj+hO6MABJKvu58p4YemtiT/RYr0b3Tyte8oGX5pK8qAGg9WL3sV1cjum/NVKabjk5iMvPTbwa6e//IlBdWo14qAhU75wLkCkC1bs/qIlFFfZEBlSBMZADVcgTGVCFJM+A6o3kk5wDVWg1woAq4IkcqEKeyIAq4Ik7BlSBMZADVWgMZEAV8EQOVCFPZEAV8EQOVAFP5EAV8kQGVIHVCAeqt5LfSAZUAU/kQBX6JiUDqtBqhAFVwBM5UIU8kQHVW8krDlShcwEDqoAncqAaYqEncqAaYpEnMqD6D2v15QnHQA5Ufaz71eqJxsAFg/BY35HriXbIHMJhEdftM+6QWUSHRVw3+L+VLXhEh4VcGM8LJnHGQjCKBZcgLOKysWATiEXBjAqxiMvGglEsMfhRWS4bC3bBk+ojPuIjPiIc/wAQkAE6ZqHsywAAAABJRU5ErkJggg==" alt="Fork me on GitHub">
</a>
    <header class="top-nav-header">
        <nav class="width-limit">
            <a id="logo" href="/" aria-label="Javalin">
                <img src="/img/logo.svg" alt="Javalin">
            </a>
            <ul>
                <li><a href="/documentation">Docs</a></li>
                <li><a href="/tutorials">Tutorials</a></li>
                <li><a href="/plugins">Plugins</a></li>
                <li><a href="/community">Community</a></li>
            </ul>
        </nav>
    </header>
    <main class="width-limit has-right-menu">
                <script>
    const notificationId = "javalin-5-released";
    const hasBeenDismissed = localStorage.getItem(notificationId + "-dismissed") === "true";
    const pageLoadCount = parseInt(localStorage.getItem(notificationId + "-count") || 0);
    localStorage.setItem(notificationId + "-count", (pageLoadCount + 1).toString());
    if (!hasBeenDismissed && pageLoadCount >= 0) {
        document.write(`
            <div id="notification-banner">
                <h1>Javalin 5 is out!</h1>
                Javalin 5 stable is finally here!
                Read more in the <a href="/news/javalin-5.0.0-stable.html">release post</a>.
            </div>
        `);
        if (pageLoadCount >= 0) {
            document.querySelector("#notification-banner").insertAdjacentHTML("beforeend", `<span class="close">×</span>`);
            document.querySelector("#notification-banner .close").addEventListener("click", () => {
                document.querySelector("#notification-banner").style.display = "none";
                localStorage.setItem(notificationId + "-dismissed", "true");
            });
        }
    }
</script>

<style>
    #notification-banner {
        line-height: 1.5;
        position: fixed;
        bottom: 32px;
        right: 32px;
        width: 360px;
        z-index: 9999999;
        background: linear-gradient(20deg, #29292d 30%, #008cbb);
        color: white;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.25);
        font-size: 16px;
        border-radius: 8px;
        padding: 24px;
    }

    #notification-banner h1 {
        line-height: 1;
        margin: 0 0 20px 0;
        font-family: 'Encode Sans', sans-serif;
        font-weight: 400;
        font-size: 22px;
        text-decoration: underline;
    }

    #notification-banner a {
        font-weight: 700;
        border: 1px solid white;
        padding: 1px 3px;
        background: white;
        color: #333;
        border-radius: 3px;
        margin: 0 2px;
    }

    #notification-banner .close {
        position: absolute;
        right: 14px;
        top: 14px;
        height: 40px;
        width: 40px;
        line-height: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        font-family: arial, sans-serif;
        cursor: pointer;
        background: rgba(0, 0, 0, 0.15);
        border-radius: 5px;
    }

    @media (max-width: 480px) {
        #notification-banner {
            border-radius: 0;
            width: 100%;
            right: 0;
            bottom: 0;
            font-size: 14px;
        }
    }
</style>

<div id="spy-nav" class="right-menu">
  <ul>
    <li><a href="#getting-started">Getting Started</a></li>
    <li><a href="#handlers">HTTP Handlers</a>
      <ul>
        <li><a href="#before-handlers">Before</a></li>
        <li><a href="#endpoint-handlers">Endpoint</a></li>
        <li><a href="#after-handlers">After</a></li>
        <li><a href="#context">Context (ctx)</a></li>
      </ul>
    </li>
    <li><a href="#websockets">WebSockets</a>
      <ul>
        <li><a href="#wsbefore">Before</a></li>
        <li><a href="#wsendpoint">Endpoint</a></li>
        <li><a href="#wsafter">After</a></li>
        <li><a href="#wscontext">Context (ctx)</a></li>
      </ul>
    </li>
    <li><a href="#handler-groups">Handler groups</a></li>
    <li><a href="#validation">Validation</a></li>
    <li><a href="#access-manager">Access manager</a></li>
    <li><a href="#default-responses">Default responses</a></li>
    <li><a href="#exception-mapping">Exception Mapping</a></li>
    <li><a href="#error-mapping">Error Mapping</a></li>
    <li><a href="#server-sent-events">Server-sent Events</a></li>
    <li><a href="#configuration">Configuration</a>
      <ul>
        <li><a href="#static-files">Static Files</a></li>
        <li><a href="#single-page-mode">Single page mode</a></li>
        <li><a href="#logging">Logging</a></li>
        <li><a href="#server-setup">Server setup</a></li>
      </ul>
    </li>
    <li><a href="#lifecycle-events">Lifecycle events</a></li>
    <li><a href="#plugins">Plugins</a></li>
    <li><a href="#different-javalin-modules">Modules</a></li>
    <li><a href="#faq">FAQ</a></li>
  </ul>
</div>

<h1 class="no-margin-top">Documentation</h1>

<p>The documentation is for the latest version of Javalin, currently <code class="highlighter-rouge">5.0.1</code>.
Javalin follows <a href="http://semver.org/">semantic versioning</a>, meaning there are no breaking
changes unless the major (leftmost) digit changes, for example <code class="highlighter-rouge">4.X.X</code> to <code class="highlighter-rouge">5.X.X</code>.</p>

<div class="star-us">
    <div>
        <span id="starUsLong">If you want to support Javalin, consider sponsoring or starring:</span>
        <span id="starUsShort">Support Javalin?</span>
    </div>
    <a class="sponsor-button" href="https://github.com/sponsors/tipsy">
    <svg width="24" height="24" viewBox="0 0 24 24">
        <path d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z" />
    </svg>
    Sponsor Javalin
</a>
<style>
    .sponsor-button {
        margin: 0 12px;
        display: flex;
        align-items: center;
        color: rgba(0, 0, 0, 0.7);
        background: #ffe8e8;
        border: 1px solid #ffb5b5;
        border-radius: 30px;
        padding: 4px 12px;
        font-weight: 500;
        font-family: 'Roboto Slab', sans-serif;
        transition: all .15s ease-in-out;
    }

    .sponsor-button:hover {
        color: rgba(0, 0, 0, 0.8);
        background: #ffe0e0;
    }

    .sponsor-button svg {
        transition: all .15s ease-in-out;
        margin-right: 8px;
    }

    .sponsor-button svg path {
        fill: #ff6363;
    }

    .sponsor-button:hover svg {
        transform: scale(1.15);
    }
</style>

    <iframe id="starFrame" class="githubStar" src="https://ghbtns.com/github-btn.html?user=javalin&amp;repo=javalin&amp;type=star&amp;count=true&amp;size=large" frameborder="0" scrolling="0" width="150px" height="35px">
    </iframe>
</div>
<style>
    .star-us {
        display: flex;
        align-items: center;
        padding: 24px;
        margin: 40px 0;
        font-family: 'Roboto Slab', sans-serif;
        font-weight: 500;
        background: white;
        border-radius: 24px;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
        border-bottom: 2px solid #ff6363;
    }

    #starUsShort {
        font-size: 15px;
        letter-spacing: -0.5px;
        font-weight: bold;
        display: none;
    }

    @media (max-width: 700px) {
        #starUsLong {
            display: none;
        }

        #starUsShort {
            display: block;
        }
    }

    @media (max-width: 480px) {
        .star-us {
            flex-direction: column;
        }
        .star-us * + * {
            margin-top: 12px;
        }
        .star-us #starUsShort {
            font-size: 20px;
        }
    }
</style>

<h2 id="getting-started">Getting started</h2>

<p>Add the dependency:</p>
<div class="multitab-code dependencies" data-tab="1">
<ul>
    <li data-tab="1">Maven</li>
    <li data-tab="2">Gradle</li>
    <li data-tab="3">SBT</li>
    <li data-tab="4">Grape</li>
    <li data-tab="5">Leiningen</li>
    <li data-tab="6">Buildr</li>
    <li data-tab="7">Ivy</li>
</ul>

<div data-tab="1">
    <pre><code class="language-markup">&lt;dependency&gt;
    &lt;groupId&gt;io.javalin&lt;/groupId&gt;
    &lt;artifactId&gt;javalin&lt;/artifactId&gt;
    &lt;version&gt;5.0.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
    <p>Not familiar with Maven? Read our <a href="/tutorials/maven-setup">Maven tutorial</a>.</p>
  </div>

<div data-tab="2">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">implementation</span><span class="o">(</span><span class="s">"io.javalin:javalin:5.0.1"</span><span class="o">)</span>
</code></pre>
    </div>
    <p>Not familiar with Gradle? Read our <a href="/tutorials/gradle-setup">Gradle tutorial</a>.</p>
  </div>

<div data-tab="3">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">"io.javalin"</span> <span class="o">%</span> <span class="s">"javalin"</span> <span class="o">%</span> <span class="s">"5.0.1"</span>
</code></pre>
    </div>
  </div>

<div data-tab="4">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Grab</span><span class="o">(</span><span class="n">group</span><span class="o">=</span><span class="err">'</span><span class="n">io</span><span class="o">.</span><span class="na">javalin</span><span class="err">'</span><span class="o">,</span> <span class="n">module</span><span class="o">=</span><span class="err">'</span><span class="n">javalin</span><span class="err">'</span><span class="o">,</span> <span class="n">version</span><span class="o">=</span><span class="err">'</span><span class="mf">5.0</span><span class="o">.</span><span class="mi">1</span><span class="err">'</span><span class="o">)</span>
</code></pre>
    </div>
  </div>

<div data-tab="5">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="o">[</span><span class="n">io</span><span class="o">.</span><span class="na">javalin</span><span class="o">/</span><span class="n">javalin</span> <span class="s">"5.0.1"</span><span class="o">]</span>
</code></pre>
    </div>
  </div>

<div data-tab="6">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="err">'</span><span class="n">io</span><span class="o">.</span><span class="na">javalin</span><span class="o">:</span><span class="nl">javalin:jar:</span><span class="mf">5.0</span><span class="o">.</span><span class="mi">1</span><span class="err">'</span>
</code></pre>
    </div>
  </div>

<div data-tab="7">
    <pre><code class="language-markup">&lt;dependency org="io.javalin" name="javalin" rev="5.0.1" /&gt;
</code></pre>
  </div>
</div>

<div class="bundle-hint">
  <p>If you want Javalin with testing tools, Jackson and Logback,
you can use the artifact id <code class="highlighter-rouge">javalin-bundle</code> instead of <code class="highlighter-rouge">javalin</code>.</p>
</div>
<style>
.bundle-hint p {
    margin-top: 8px;
    font-size: 14px;
}
</style>

<p>Start coding:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">io.javalin.Javalin</span><span class="o">;</span>

<span class="n">THIS</span> <span class="n">STILL</span><span class="o">,</span> <span class="n">STILL</span><span class="o">,</span> <span class="n">STILL</span><span class="o">,</span> <span class="n">STILL</span> <span class="n">DOES</span> <span class="n">NOT</span> <span class="n">COMPILE</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorld</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">var</span> <span class="n">app</span> <span class="o">=</span> <span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="cm">/*config*/</span><span class="o">)</span>
            <span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="s">"Hello World"</span><span class="o">))</span>
            <span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="mi">7070</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">io.javalin.Javalin</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">app</span> <span class="p">=</span> <span class="n">Javalin</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="cm">/*config*/</span><span class="p">)</span>
        <span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="n">ctx</span><span class="p">.</span><span class="n">result</span><span class="p">(</span><span class="s">"Hello World"</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="m">7070</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h2 id="handlers">Handlers</h2>
<p>Javalin has three main handler types: before-handlers, endpoint-handlers, and after-handlers.
(There are also exception-handlers and error-handlers, but we’ll get to them later).
The before-, endpoint- and after-handlers require three parts:</p>

<ul>
  <li>A verb, one of: <code class="highlighter-rouge">before</code>, <code class="highlighter-rouge">get</code>, <code class="highlighter-rouge">post</code>, <code class="highlighter-rouge">put</code>, <code class="highlighter-rouge">patch</code>, <code class="highlighter-rouge">delete</code>, <code class="highlighter-rouge">after</code> <small>(… <code class="highlighter-rouge">head</code>, <code class="highlighter-rouge">options</code>, <code class="highlighter-rouge">trace</code>, <code class="highlighter-rouge">connect</code>)</small></li>
  <li>A path, ex: <code class="highlighter-rouge">/</code>, <code class="highlighter-rouge">/hello-world</code>, <code class="highlighter-rouge">/hello/{name}</code></li>
  <li>A handler implementation, ex <code class="highlighter-rouge">ctx -&gt; { ... }</code>, <code class="highlighter-rouge">MyClass implements Handler</code>, etc</li>
</ul>

<p>The <code class="highlighter-rouge">Handler</code> interface has a void return type. You use a method like <code class="highlighter-rouge">ctx.result(result)</code>,
<code class="highlighter-rouge">ctx.json(obj)</code>, or <code class="highlighter-rouge">ctx.future(future)</code> to set the response which will be returned to the user.</p>

<p>You can learn about how Javalin handles concurrency in <a href="#concurrency">FAQ - Concurrency</a>.</p>

<h3 id="before-handlers">Before handlers</h3>
<p>Before-handlers are matched before every request (including static files).</p>
<div class="comment">You might know before-handlers as filters, interceptors, or middleware from other libraries.</div>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">before</span><span class="o">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// runs before all requests</span>
<span class="o">});</span>
<span class="n">app</span><span class="o">.</span><span class="na">before</span><span class="o">(</span><span class="s">"/path/*"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// runs before request to /path/*</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">before</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="c1">// runs before all requests
</span><span class="p">}</span>
<span class="n">app</span><span class="p">.</span><span class="n">before</span><span class="p">(</span><span class="s">"/path/*"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="c1">// runs before request to /path/*
</span><span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h3 id="endpoint-handlers">Endpoint handlers</h3>
<p>Endpoint handlers are the main handler type, and defines your API. You can add a GET handler to
server data to a client, or a POST handler to receive some data.
Common methods are supported directly on the <code class="highlighter-rouge">Javalin</code> class (<small>GET, POST, PUT, PATCH, DELETE, HEAD, OPTIONS</small>),
uncommon operations (<small>TRACE, CONNECT</small>) are supported via <code class="highlighter-rouge">Javalin#addHandler</code>.</p>

<p>Endpoint-handlers are matched in the order they are defined.</p>

<div class="comment">You might know endpoint-handlers as routes or middleware from other libraries.</div>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/output"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// some code</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">json</span><span class="o">(</span><span class="n">object</span><span class="o">);</span>
<span class="o">});</span>

<span class="n">app</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">"/input"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// some code</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">201</span><span class="o">);</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"/output"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="c1">// some code
</span>    <span class="n">ctx</span><span class="p">.</span><span class="n">json</span><span class="p">(</span><span class="k">object</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/input"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="c1">// some code
</span>    <span class="n">ctx</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="m">201</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<p>Handler paths can include path-parameters. These are available via <code class="highlighter-rouge">ctx.pathParam("key")</code>:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/hello/{name}"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="c1">// the {} syntax does not allow slashes ('/') as part of the parameter</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="s">"Hello: "</span> <span class="o">+</span> <span class="n">ctx</span><span class="o">.</span><span class="na">pathParam</span><span class="o">(</span><span class="s">"name"</span><span class="o">));</span>
<span class="o">});</span>
<span class="n">app</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/hello/&lt;name&gt;"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="c1">// the &lt;&gt; syntax allows slashes ('/') as part of the parameter</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="s">"Hello: "</span> <span class="o">+</span> <span class="n">ctx</span><span class="o">.</span><span class="na">pathParam</span><span class="o">(</span><span class="s">"name"</span><span class="o">));</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"/hello/{name}"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="c1">// the {} syntax does not allow slashes ('/') as part of the parameter
</span>    <span class="n">ctx</span><span class="p">.</span><span class="n">result</span><span class="p">(</span><span class="s">"Hello: "</span> <span class="p">+</span> <span class="n">ctx</span><span class="p">.</span><span class="n">pathParam</span><span class="p">(</span><span class="s">"name"</span><span class="p">))</span>
<span class="p">}</span>
<span class="n">app</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"/hello/&lt;name&gt;"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="c1">// the &lt;&gt; syntax allows slashes ('/') as part of the parameter
</span>    <span class="n">ctx</span><span class="p">.</span><span class="n">result</span><span class="p">(</span><span class="s">"Hello: "</span> <span class="p">+</span> <span class="n">ctx</span><span class="p">.</span><span class="n">pathParam</span><span class="p">(</span><span class="s">"name"</span><span class="p">))</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<p>Handler paths can also include wildcard parameters:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/path/*"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="c1">// will match anything starting with /path/</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="s">"You are here because "</span> <span class="o">+</span> <span class="n">ctx</span><span class="o">.</span><span class="na">path</span><span class="o">()</span> <span class="o">+</span> <span class="s">" matches "</span> <span class="o">+</span> <span class="n">ctx</span><span class="o">.</span><span class="na">matchedPath</span><span class="o">());</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"/path/*"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="c1">// will match anything starting with /path/
</span>    <span class="n">ctx</span><span class="p">.</span><span class="n">result</span><span class="p">(</span><span class="s">"You are here because "</span> <span class="p">+</span> <span class="n">ctx</span><span class="p">.</span><span class="n">path</span><span class="p">()</span> <span class="p">+</span> <span class="s">" matches "</span> <span class="p">+</span> <span class="n">ctx</span><span class="p">.</span><span class="n">matchedPath</span><span class="p">())</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<p>However, you cannot extract the value of a wildcard.
Use a slash accepting path-parameter (<code class="highlighter-rouge">&lt;param-name&gt;</code>) if you need this behavior.</p>

<h3 id="after-handlers">After handlers</h3>
<p>After-handlers run after every request (even if an exception occurred)</p>
<div class="comment">You might know after-handlers as filters, interceptors, or middleware from other libraries.</div>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">after</span><span class="o">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// run after all requests</span>
<span class="o">});</span>
<span class="n">app</span><span class="o">.</span><span class="na">after</span><span class="o">(</span><span class="s">"/path/*"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// runs after request to /path/*</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">after</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="c1">// run after all requests
</span><span class="p">}</span>
<span class="n">app</span><span class="p">.</span><span class="n">after</span><span class="p">(</span><span class="s">"/path/*"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="c1">// runs after request to /path/*
</span><span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h3 id="context">Context</h3>
<p>The <code class="highlighter-rouge">Context</code> object provides you with everything you need to handle a http-request.
It contains the underlying servlet-request and servlet-response, and a bunch of getters
and setters.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// Request methods</span>
<span class="n">body</span><span class="o">()</span>                                  <span class="c1">// request body as string</span>
<span class="n">bodyAsBytes</span><span class="o">()</span>                           <span class="c1">// request body as array of bytes</span>
<span class="n">bodyAsInputStream</span><span class="o">()</span>                     <span class="c1">// request body as input stream</span>
<span class="n">bodyAsClass</span><span class="o">(</span><span class="n">clazz</span><span class="o">)</span>                      <span class="c1">// request body as specified class (deserialized from JSON)</span>
<span class="n">bodyStreamAsClass</span><span class="o">(</span><span class="n">clazz</span><span class="o">)</span>                <span class="c1">// request body as specified class (memory optimized version of above)</span>
<span class="n">bodyValidator</span><span class="o">(</span><span class="n">clazz</span><span class="o">)</span>                    <span class="c1">// request body as validator typed as specified class</span>
<span class="n">uploadedFile</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span>                    <span class="c1">// uploaded file by name</span>
<span class="n">uploadedFiles</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span>                   <span class="c1">// all uploaded files by name</span>
<span class="n">uploadedFiles</span><span class="o">()</span>                         <span class="c1">// all uploaded files as list</span>
<span class="n">formParam</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span>                       <span class="c1">// form parameter by name, as string</span>
<span class="n">formParamAsClass</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">clazz</span><span class="o">)</span>         <span class="c1">// form parameter by name, as validator typed as specified class</span>
<span class="n">formParams</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span>                      <span class="c1">// list of form parameters by name</span>
<span class="n">formParamMap</span><span class="o">()</span>                          <span class="c1">// map of all form parameters</span>
<span class="n">pathParam</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span>                       <span class="c1">// path parameter by name as string</span>
<span class="n">pathParamAsClass</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">clazz</span><span class="o">)</span>         <span class="c1">// path parameter as validator typed as specified class</span>
<span class="n">pathParamMap</span><span class="o">()</span>                          <span class="c1">// map of all path parameters</span>
<span class="n">basicAuthCredentialsExist</span><span class="o">()</span>             <span class="c1">// true if request has basic auth credentials</span>
<span class="n">basicAuthCredentials</span><span class="o">()</span>                  <span class="c1">// basic auth credentials (if set)</span>
<span class="n">attribute</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span>                <span class="c1">// set an attribute on the request</span>
<span class="n">attribute</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span>                       <span class="c1">// get an attribute on the request</span>
<span class="n">attributeMap</span><span class="o">()</span>                          <span class="c1">// map of all attributes on the request</span>
<span class="n">contentLength</span><span class="o">()</span>                         <span class="c1">// content length of the request body</span>
<span class="n">contentType</span><span class="o">()</span>                           <span class="c1">// request content type</span>
<span class="n">cookie</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span>                          <span class="c1">// request cookie by name</span>
<span class="n">cookieMap</span><span class="o">()</span>                             <span class="c1">// map of all request cookies</span>
<span class="n">header</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span>                          <span class="c1">// request header by name (can be used with Header.HEADERNAME)</span>
<span class="n">headerAsClass</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">clazz</span><span class="o">)</span>            <span class="c1">// request header by name, as validator typed as specified class</span>
<span class="n">headerMap</span><span class="o">()</span>                             <span class="c1">// map of all request headers</span>
<span class="n">host</span><span class="o">()</span>                                  <span class="c1">// host as string</span>
<span class="n">ip</span><span class="o">()</span>                                    <span class="c1">// ip as string</span>
<span class="n">isMultipart</span><span class="o">()</span>                           <span class="c1">// true if the request is multipart</span>
<span class="n">isMultipartFormData</span><span class="o">()</span>                   <span class="c1">// true if the request is multipart/formdata</span>
<span class="n">method</span><span class="o">()</span>                                <span class="c1">// request methods (GET, POST, etc)</span>
<span class="n">path</span><span class="o">()</span>                                  <span class="c1">// request path</span>
<span class="n">port</span><span class="o">()</span>                                  <span class="c1">// request port</span>
<span class="n">protocol</span><span class="o">()</span>                              <span class="c1">// request protocol</span>
<span class="n">queryParam</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span>                      <span class="c1">// query param by name as string</span>
<span class="n">queryParamAsClass</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">clazz</span><span class="o">)</span>        <span class="c1">// query param parameter by name, as validator typed as specified class</span>
<span class="n">queryParams</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span>                      <span class="c1">// list of query parameters by name</span>
<span class="n">queryParamMap</span><span class="o">()</span>                         <span class="c1">// map of all query parameters</span>
<span class="n">queryString</span><span class="o">()</span>                           <span class="c1">// full query string</span>
<span class="n">scheme</span><span class="o">()</span>                                <span class="c1">// request scheme</span>
<span class="n">sessionAttribute</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span>         <span class="c1">// set a session attribute</span>
<span class="n">sessionAttribute</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span>                <span class="c1">// get a session attribute</span>
<span class="n">consumeSessionAttribute</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span>         <span class="c1">// get a session attribute, and set value to null</span>
<span class="n">cachedSessionAttribute</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span>   <span class="c1">// set a session attribute, and cache the value as a request attribute</span>
<span class="n">cachedSessionAttribute</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span>          <span class="c1">// get a session attribute, and cache the value as a request attribute</span>
<span class="n">cachedSessionAttributeOrCompute</span><span class="o">(...)</span>    <span class="c1">// same as above, but compute and set if value is absent</span>
<span class="n">sessionAttributeMap</span><span class="o">()</span>                   <span class="c1">// map of all session attributes</span>
<span class="n">url</span><span class="o">()</span>                                   <span class="c1">// request url</span>
<span class="n">fullUrl</span><span class="o">()</span>                               <span class="c1">// request url + query string</span>
<span class="n">contextPath</span><span class="o">()</span>                           <span class="c1">// request context path</span>
<span class="n">userAgent</span><span class="o">()</span>                             <span class="c1">// request user agent</span>

<span class="c1">// Response methods</span>
<span class="n">result</span><span class="o">(</span><span class="s">"result"</span><span class="o">)</span>                        <span class="c1">// set result stream to specified string (overwrites any previously set result)</span>
<span class="n">result</span><span class="o">(</span><span class="n">byteArray</span><span class="o">)</span>                       <span class="c1">// set result stream to specified byte array (overwrites any previously set result)</span>
<span class="n">result</span><span class="o">(</span><span class="n">inputStream</span><span class="o">)</span>                     <span class="c1">// set result stream to specified input stream (overwrites any previously set result)</span>
<span class="n">seekableStream</span><span class="o">(</span><span class="n">inputStream</span><span class="o">,</span> <span class="s">"type"</span><span class="o">)</span>     <span class="c1">// write content immediately as seekable stream (useful for audio and video)</span>
<span class="n">resultStream</span><span class="o">()</span>                          <span class="c1">// get current result stream</span>
<span class="n">resultString</span><span class="o">()</span>                          <span class="c1">// get current result stream as string (if possible), and reset result stream</span>
<span class="n">future</span><span class="o">(</span><span class="n">future</span><span class="o">,</span> <span class="n">callback</span><span class="o">)</span>                <span class="c1">// set the result to be a future, see async section (overwrites any previously set result)</span>
<span class="n">resultFuture</span><span class="o">()</span>                          <span class="c1">// get current result future</span>
<span class="n">contentType</span><span class="o">(</span><span class="s">"type"</span><span class="o">)</span>                     <span class="c1">// set the response content type</span>
<span class="n">header</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"value"</span><span class="o">)</span>                 <span class="c1">// set response header by name (can be used with Header.HEADERNAME)</span>
<span class="n">redirect</span><span class="o">(</span><span class="s">"/path"</span><span class="o">,</span> <span class="n">code</span><span class="o">)</span>                 <span class="c1">// redirect to the given path with the given status code</span>
<span class="n">status</span><span class="o">(</span><span class="n">code</span><span class="o">)</span>                            <span class="c1">// set the response status code</span>
<span class="n">status</span><span class="o">()</span>                                <span class="c1">// get the response status code</span>
<span class="n">cookie</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"value"</span><span class="o">,</span> <span class="n">maxAge</span><span class="o">)</span>         <span class="c1">// set response cookie by name, with value and max-age (optional).</span>
<span class="n">cookie</span><span class="o">(</span><span class="n">cookie</span><span class="o">)</span>                          <span class="c1">// set cookie using javalin Cookie class</span>
<span class="n">removeCookie</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"/path"</span><span class="o">)</span>           <span class="c1">// removes cookie by name and path (optional)</span>
<span class="n">json</span><span class="o">(</span><span class="n">obj</span><span class="o">)</span>                               <span class="c1">// calls result(jsonString), and also sets content type to json</span>
<span class="n">jsonStream</span><span class="o">(</span><span class="n">obj</span><span class="o">)</span>                         <span class="c1">// calls result(jsonStream), and also sets content type to json</span>
<span class="n">html</span><span class="o">(</span><span class="s">"html"</span><span class="o">)</span>                            <span class="c1">// calls result(string), and also sets content type to html</span>
<span class="n">render</span><span class="o">(</span><span class="s">"/template.tmpl"</span><span class="o">,</span> <span class="n">model</span><span class="o">)</span>         <span class="c1">// calls html(renderedTemplate)</span>

<span class="c1">// Other methods</span>
<span class="n">handlerType</span><span class="o">()</span>                           <span class="c1">// handler type of the current handler (BEFORE, AFTER, GET, etc)</span>
<span class="n">appAttribute</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span>                    <span class="c1">// get an attribute on the Javalin instance. see app attributes section below</span>
<span class="n">matchedPath</span><span class="o">()</span>                           <span class="c1">// get the path that was used to match this request (ex, "/hello/{name}")</span>
<span class="n">endpointHandlerPath</span><span class="o">()</span>                   <span class="c1">// get the path of the endpoint handler that was used to match this request</span>
<span class="n">cookieStore</span>                             <span class="c1">// see cookie store section below</span>
</code></pre>
</div>

<h4 id="app-attributes">App Attributes</h4>

<p>App Attributes can be registered on the Javalin instance, then accessed through the <code class="highlighter-rouge">appAttribute(...)</code> method in <code class="highlighter-rouge">Context</code>:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">attribute</span><span class="o">(</span><span class="s">"myValue"</span><span class="o">,</span> <span class="s">"foo"</span><span class="o">);</span>

<span class="n">app</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/attribute"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">myValue</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">attribute</span><span class="o">(</span><span class="s">"myValue"</span><span class="o">);</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="n">myValue</span><span class="o">);</span> <span class="c1">// -&gt; foo</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">attribute</span><span class="p">(</span><span class="s">"myValue"</span><span class="p">,</span> <span class="s">"foo"</span><span class="p">)</span>

<span class="n">app</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"/attribute"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="kd">val</span> <span class="py">myValue</span><span class="p">:</span> <span class="n">String</span> <span class="p">=</span> <span class="n">ctx</span><span class="p">.</span><span class="n">appAttribute</span><span class="p">(</span><span class="s">"myValue"</span><span class="p">)</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">result</span><span class="p">(</span><span class="n">myValue</span><span class="p">)</span> <span class="c1">// -&gt; foo
</span><span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h4 id="contextresolvers">ContextResolvers</h4>
<p>Some of the methods in <code class="highlighter-rouge">Context</code> can be configured through the <code class="highlighter-rouge">ContextResolvers</code> configuration class:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">config</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">config</span><span class="o">.</span><span class="na">contextResolvers</span><span class="o">(</span><span class="n">resolvers</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">resolvers</span><span class="o">.</span><span class="na">ip</span> <span class="o">=</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="s">"custom ip"</span><span class="o">;</span>     <span class="c1">// called by Context#ip()</span>
        <span class="n">resolvers</span><span class="o">.</span><span class="na">host</span> <span class="o">=</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="s">"custom host"</span><span class="o">;</span> <span class="c1">// called by Context#host()</span>
        <span class="n">resolvers</span><span class="o">.</span><span class="na">scheme</span> <span class="o">=</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="s">"custom scheme"</span><span class="o">;</span> <span class="c1">// called by Context#scheme()</span>
        <span class="n">resolvers</span><span class="o">.</span><span class="na">url</span> <span class="o">=</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="s">"custom url"</span><span class="o">;</span> <span class="c1">// called by Context#url()</span>
        <span class="n">resolvers</span><span class="o">.</span><span class="na">fullUrl</span> <span class="o">=</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="s">"custom fullUrl"</span><span class="o">;</span> <span class="c1">// called by Context#fullUrl()</span>
    <span class="o">});</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span><span class="p">.</span><span class="n">create</span> <span class="p">{</span> <span class="n">config</span> <span class="p">-&gt;</span>
    <span class="n">config</span><span class="p">.</span><span class="n">contextResolvers</span> <span class="p">{</span> <span class="n">resolvers</span> <span class="p">-&gt;</span>
        <span class="n">resolvers</span><span class="p">.</span><span class="n">ip</span> <span class="p">=</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="s">"custom ip"</span> <span class="p">}</span>     <span class="c1">// called by Context#ip()
</span>        <span class="n">resolvers</span><span class="p">.</span><span class="n">host</span> <span class="p">=</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="s">"custom host"</span> <span class="p">}</span> <span class="c1">// called by Context#host()
</span>        <span class="n">resolvers</span><span class="p">.</span><span class="n">scheme</span> <span class="p">=</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="s">"custom scheme"</span> <span class="p">}</span> <span class="c1">// called by Context#scheme()
</span>        <span class="n">resolvers</span><span class="p">.</span><span class="n">url</span> <span class="p">=</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="s">"custom url"</span> <span class="p">}</span> <span class="c1">// called by Context#url()
</span>        <span class="n">resolvers</span><span class="p">.</span><span class="n">fullUrl</span> <span class="p">{</span> <span class="p">=</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="s">"custom fullUrl"</span> <span class="p">}</span> <span class="c1">// called by Context#fullUrl()
</span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h4 id="cookie-store">Cookie Store</h4>

<p>The <code class="highlighter-rouge">ctx.cookieStore()</code> functions provide a convenient way for sharing information between handlers, request, or even servers:</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">ctx</span><span class="o">.</span><span class="na">cookieStore</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span> <span class="c1">// store any type of value</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">cookieStore</span><span class="o">(</span><span class="n">key</span><span class="o">);</span> <span class="c1">// read any type of value</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">clearCookieStore</span><span class="o">();</span> <span class="c1">// clear the cookie-store</span>
</code></pre>
</div>
<p>The cookieStore works like this:</p>
<ol>
  <li>The first handler that matches the incoming request will populate the cookie-store-map with the data currently stored in the cookie (if any).</li>
  <li>This map can now be used as a state between handlers on the same request-cycle, pretty much in the same way as <code class="highlighter-rouge">ctx.attribute()</code></li>
  <li>At the end of the request-cycle, the cookie-store-map is serialized, base64-encoded and written to the response as a cookie.
This allows you to share the map between requests and servers (in case you are running multiple servers behind a load-balancer)</li>
</ol>

<h5 id="example">Example:</h5>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">serverOneApp</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">"/cookie-storer"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">cookieStore</span><span class="o">(</span><span class="s">"string"</span><span class="o">,</span> <span class="s">"Hello world!"</span><span class="o">);</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">cookieStore</span><span class="o">(</span><span class="s">"i"</span><span class="o">,</span> <span class="mi">42</span><span class="o">);</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">cookieStore</span><span class="o">(</span><span class="s">"list"</span><span class="o">,</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"One"</span><span class="o">,</span> <span class="s">"Two"</span><span class="o">,</span> <span class="s">"Three"</span><span class="o">));</span>
<span class="o">});</span>
<span class="n">serverTwoApp</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/cookie-reader"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="c1">// runs on a different server than serverOneApp</span>
    <span class="n">String</span> <span class="n">string</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">cookieStore</span><span class="o">(</span><span class="s">"string"</span><span class="o">)</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">cookieStore</span><span class="o">(</span><span class="s">"i"</span><span class="o">)</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">cookieStore</span><span class="o">(</span><span class="s">"list"</span><span class="o">)</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">serverOneApp</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/cookie-storer"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">cookieStore</span><span class="p">(</span><span class="s">"string"</span><span class="p">,</span> <span class="s">"Hello world!"</span><span class="p">)</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">cookieStore</span><span class="p">(</span><span class="s">"i"</span><span class="p">,</span> <span class="m">42</span><span class="p">)</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">cookieStore</span><span class="p">(</span><span class="s">"list"</span><span class="p">,</span> <span class="n">listOf</span><span class="p">(</span><span class="s">"One"</span><span class="p">,</span> <span class="s">"Two"</span><span class="p">,</span> <span class="s">"Three"</span><span class="p">))</span>
<span class="p">}</span>
<span class="n">serverTwoApp</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"/cookie-reader"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="c1">// runs on a different server than serverOneApp
</span>    <span class="kd">val</span> <span class="py">string</span> <span class="p">=</span> <span class="n">ctx</span><span class="p">.</span><span class="n">cookieStore</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;(</span><span class="s">"string"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">i</span> <span class="p">=</span> <span class="n">ctx</span><span class="p">.</span><span class="n">cookieStore</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;(</span><span class="s">"i"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">list</span> <span class="p">=</span> <span class="n">ctx</span><span class="p">.</span><span class="n">cookieStore</span><span class="p">&lt;</span><span class="n">List</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;&gt;(</span><span class="s">"list"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<p>Since the client stores the cookie, the <code class="highlighter-rouge">get</code> request to <code class="highlighter-rouge">serverTwoApp</code>
will be able to retrieve the information that was passed in the <code class="highlighter-rouge">post</code> to <code class="highlighter-rouge">serverOneApp</code>.</p>

<p>Please note that cookies have a max-size of 4kb.</p>

<h2 id="websockets">WebSockets</h2>

<p>Javalin has a very intuitive way of handling WebSockets. You declare an endpoint
with a path and configure the different event handlers in a lambda:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">ws</span><span class="o">(</span><span class="s">"/websocket/{path}"</span><span class="o">,</span> <span class="n">ws</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">ws</span><span class="o">.</span><span class="na">onConnect</span><span class="o">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Connected"</span><span class="o">));</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">ws</span><span class="p">(</span><span class="s">"/websocket/{path}"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ws</span> <span class="p">-&gt;</span>
    <span class="n">ws</span><span class="p">.</span><span class="n">onConnect</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="n">println</span><span class="p">(</span><span class="s">"Connected"</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<p>There are a total of five events supported:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">ws</span><span class="o">.</span><span class="na">onConnect</span><span class="o">(</span><span class="n">WsConnectContext</span><span class="o">)</span>
<span class="n">ws</span><span class="o">.</span><span class="na">onError</span><span class="o">(</span><span class="n">WsErrorContext</span><span class="o">)</span>
<span class="n">ws</span><span class="o">.</span><span class="na">onClose</span><span class="o">(</span><span class="n">WsCloseContext</span><span class="o">)</span>
<span class="n">ws</span><span class="o">.</span><span class="na">onMessage</span><span class="o">(</span><span class="n">WsMessageContext</span><span class="o">)</span>
<span class="n">ws</span><span class="o">.</span><span class="na">onBinaryMessage</span><span class="o">(</span><span class="n">WsBinaryMessageContext</span><span class="o">)</span>
</code></pre>
</div>

<p>The different flavors of <code class="highlighter-rouge">WsContext</code> expose different things, for example,
<code class="highlighter-rouge">WsMessageContext</code> has the method <code class="highlighter-rouge">.message()</code> which gives you the message that the client sent.
The differences between the different contexts is small, and a full overview can be seen in the <a href="#wscontext">WsContext</a> section.</p>

<p>You can learn about how Javalin handles WebSocket concurrency in <a href="#concurrency">FAQ - Concurrency</a>.</p>

<h3 id="wsbefore">WsBefore</h3>
<p>The <code class="highlighter-rouge">app.wsBefore</code> adds a handler that runs before a WebSocket handler.
You can have as many before-handlers as you want per WebSocket endpoint, and all events are supported.</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">wsBefore</span><span class="o">(</span><span class="n">ws</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// runs before all WebSocket requests</span>
<span class="o">});</span>
<span class="n">app</span><span class="o">.</span><span class="na">wsBefore</span><span class="o">(</span><span class="s">"/path/*"</span><span class="o">,</span> <span class="n">ws</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// runs before websocket requests to /path/*</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">wsBefore</span> <span class="p">{</span> <span class="n">ws</span> <span class="p">-&gt;</span>
    <span class="c1">// runs before all WebSocket requests
</span><span class="p">}</span>
<span class="n">app</span><span class="p">.</span><span class="n">wsBefore</span><span class="p">(</span><span class="s">"/path/*"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ws</span> <span class="p">-&gt;</span>
    <span class="c1">// runs before websocket requests to /path/*
</span><span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h3 id="wsendpoint">WsEndpoint</h3>
<p>A WebSocket endpoint is declared with <code class="highlighter-rouge">app.ws(path, handler)</code>. WebSocket handlers require unique paths.</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">ws</span><span class="o">(</span><span class="s">"/websocket/{path}"</span><span class="o">,</span> <span class="n">ws</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">ws</span><span class="o">.</span><span class="na">onConnect</span><span class="o">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Connected"</span><span class="o">));</span>
    <span class="n">ws</span><span class="o">.</span><span class="na">onMessage</span><span class="o">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">messageAsClass</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> <span class="c1">// convert from json</span>
        <span class="n">ctx</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">user</span><span class="o">);</span> <span class="c1">// convert to json and send back</span>
    <span class="o">});</span>
    <span class="n">ws</span><span class="o">.</span><span class="na">onBinaryMessage</span><span class="o">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Message"</span><span class="o">))</span>
    <span class="n">ws</span><span class="o">.</span><span class="na">onClose</span><span class="o">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Closed"</span><span class="o">));</span>
    <span class="n">ws</span><span class="o">.</span><span class="na">onError</span><span class="o">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Errored"</span><span class="o">));</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">ws</span><span class="p">(</span><span class="s">"/websocket/{path}"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ws</span> <span class="p">-&gt;</span>
    <span class="n">ws</span><span class="p">.</span><span class="n">onConnect</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="n">println</span><span class="p">(</span><span class="s">"Connected"</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">ws</span><span class="p">.</span><span class="n">onMessage</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
        <span class="kd">val</span> <span class="py">user</span> <span class="p">=</span> <span class="n">ctx</span><span class="p">.</span><span class="n">messageAsClass</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;();</span> <span class="c1">// convert from json
</span>        <span class="n">ctx</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">user</span><span class="p">);</span> <span class="c1">// convert to json and send back
</span>    <span class="p">}</span>
    <span class="n">ws</span><span class="p">.</span><span class="n">onBinaryMessage</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="n">println</span><span class="p">(</span><span class="s">"Message"</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">ws</span><span class="p">.</span><span class="n">onClose</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="n">println</span><span class="p">(</span><span class="s">"Closed"</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">ws</span><span class="p">.</span><span class="n">onError</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="n">println</span><span class="p">(</span><span class="s">"Errored"</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h3 id="wsafter">WsAfter</h3>
<p>The <code class="highlighter-rouge">app.wsAfter</code> adds a handler that runs after a WebSocket handler.
You can have as many after-handlers as you want per WebSocket endpoint, and all events are supported.</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">wsAfter</span><span class="o">(</span><span class="n">ws</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// runs after all WebSocket requests</span>
<span class="o">});</span>
<span class="n">app</span><span class="o">.</span><span class="na">wsAfter</span><span class="o">(</span><span class="s">"/path/*"</span><span class="o">,</span> <span class="n">ws</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// runs after websocket requests to /path/*</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">wsAfter</span> <span class="p">{</span> <span class="n">ws</span> <span class="p">-&gt;</span>
    <span class="c1">// runs after all WebSocket requests
</span><span class="p">}</span>
<span class="n">app</span><span class="p">.</span><span class="n">wsAfter</span><span class="p">(</span><span class="s">"/path/*"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ws</span> <span class="p">-&gt;</span>
    <span class="c1">// runs after websocket requests to /path/*
</span><span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h2 id="wscontext">WsContext</h2>
<p>The <code class="highlighter-rouge">WsContext</code> object provides you with everything you need to handle a websocket-request.
It contains the underlying websocket session and servlet-request, and convenience methods for sending
messages to the client.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// Session methods</span>
<span class="n">send</span><span class="o">(</span><span class="n">obj</span><span class="o">)</span>                               <span class="c1">// serialize object to json string and send it to client</span>
<span class="n">send</span><span class="o">(</span><span class="s">"message"</span><span class="o">)</span>                         <span class="c1">// send string to client</span>
<span class="n">send</span><span class="o">(</span><span class="n">byteBuffer</span><span class="o">)</span>                        <span class="c1">// send bytes to client</span>

<span class="c1">// Upgrade Context methods (getters)</span>
<span class="n">matchedPath</span><span class="o">()</span>                           <span class="c1">// get the path that was used to match this request (ex, "/hello/{name}")</span>
<span class="n">host</span><span class="o">()</span>                                  <span class="c1">// host as string</span>

<span class="n">queryParam</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span>                      <span class="c1">// query param by name as string</span>
<span class="n">queryParamAsClass</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">clazz</span><span class="o">)</span>        <span class="c1">// query param parameter by name, as validator typed as specified class</span>
<span class="n">queryParams</span><span class="o">(</span><span class="s">"name)                      // list of query parameters by name
queryParamMap()                         // map of all query parameters
queryString()                           // full query string

pathParam("</span><span class="n">name</span><span class="s">")                       // path parameter by name as string
pathParamAsClass("</span><span class="n">name</span><span class="s">", clazz)         // path parameter as validator typed as specified class
pathParamMap()                          // map of all path parameters

header("</span><span class="n">name</span><span class="s">")                          // request header by name (can be used with Header.HEADERNAME)
headerAsClass("</span><span class="n">name</span><span class="s">", clazz)            // request header by name, as validator typed as specified class
headerMap()                             // map of all request headers

cookie("</span><span class="n">name</span><span class="s">")                          // request cookie by name
cookieMap()                             // map of all request cookies

attribute("</span><span class="n">name</span><span class="s">", value)                // set an attribute on the request
attribute("</span><span class="n">name</span><span class="s">")                       // get an attribute on the request
attributeMap()                          // map of all attributes on the request

sessionAttribute("</span><span class="n">name</span><span class="err">"</span><span class="o">)</span>                <span class="c1">// get a session attribute</span>
<span class="n">sessionAttributeMap</span><span class="o">()</span>                   <span class="c1">// map of all session attributes</span>
</code></pre>
</div>

<h3 id="wsmessagecontext">WsMessageContext</h3>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">message</span><span class="o">()</span>                               <span class="c1">// receive a string message from the client</span>
<span class="n">messageAsClass</span><span class="o">(</span><span class="n">clazz</span><span class="o">)</span>                   <span class="c1">// deserialize message from client</span>
</code></pre>
</div>

<h3 id="wsbinarymessagecontext">WsBinaryMessageContext</h3>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="o">()</span>                                  <span class="c1">// receive a byte array of data from the client</span>
<span class="n">offset</span><span class="o">()</span>                                <span class="c1">// the offset of the data</span>
<span class="n">length</span><span class="o">()</span>                                <span class="c1">// the length of the data</span>
</code></pre>
</div>

<h3 id="wsclosecontext">WsCloseContext</h3>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">status</span><span class="o">()</span>                                <span class="c1">// the int status for why connection was closed</span>
<span class="n">reason</span><span class="o">()</span>                                <span class="c1">// the string reason for why connection was closed</span>
</code></pre>
</div>

<h3 id="wserrorcontext">WsErrorContext</h3>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">error</span><span class="o">()</span>                                 <span class="c1">// the throwable error that occurred</span>
</code></pre>
</div>

<h3 id="wsconnectcontext">WsConnectContext</h3>
<p>The <code class="highlighter-rouge">WsConnectContext</code> class doesn’t add anything to the base <code class="highlighter-rouge">WsContext</code></p>

<h2 id="handler-groups">Handler groups</h2>
<p>You can group your endpoints by using the <code class="highlighter-rouge">routes()</code> and <code class="highlighter-rouge">path()</code> methods. <code class="highlighter-rouge">routes()</code> creates
a temporary static instance of Javalin so you can skip the <code class="highlighter-rouge">app.</code> prefix before your handlers.
This is equivalent to calling <code class="highlighter-rouge">ApiBuilder.get(app, ...)</code>, which translates
to <code class="highlighter-rouge">app.get(...)</code>. It is <strong>not</strong> a global singleton that holds any information, so
you can use this safely in multiple locations and from multiple threads.</p>

<p>You can import all the HTTP methods with <code class="highlighter-rouge">import static io.javalin.apibuilder.ApiBuilder.*</code>.</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">routes</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">path</span><span class="o">(</span><span class="s">"users"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">get</span><span class="o">(</span><span class="nl">UserController:</span><span class="o">:</span><span class="n">getAllUsers</span><span class="o">);</span>
        <span class="n">post</span><span class="o">(</span><span class="nl">UserController:</span><span class="o">:</span><span class="n">createUser</span><span class="o">);</span>
        <span class="n">path</span><span class="o">(</span><span class="s">"{id}"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">get</span><span class="o">(</span><span class="nl">UserController:</span><span class="o">:</span><span class="n">getUser</span><span class="o">);</span>
            <span class="n">patch</span><span class="o">(</span><span class="nl">UserController:</span><span class="o">:</span><span class="n">updateUser</span><span class="o">);</span>
            <span class="n">delete</span><span class="o">(</span><span class="nl">UserController:</span><span class="o">:</span><span class="n">deleteUser</span><span class="o">);</span>
        <span class="o">});</span>
        <span class="n">ws</span><span class="o">(</span><span class="s">"events"</span><span class="o">,</span> <span class="nl">UserController:</span><span class="o">:</span><span class="n">webSocketEvents</span><span class="o">);</span>
    <span class="o">});</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">routes</span> <span class="p">{</span>
    <span class="n">path</span><span class="p">(</span><span class="s">"users"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">get</span><span class="p">(</span><span class="n">UserController</span><span class="o">::</span><span class="n">getAllUsers</span><span class="p">)</span>
        <span class="n">post</span><span class="p">(</span><span class="n">UserController</span><span class="o">::</span><span class="n">createUser</span><span class="p">)</span>
        <span class="n">path</span><span class="p">(</span><span class="s">"{id}"</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">get</span><span class="p">(</span><span class="n">UserController</span><span class="o">::</span><span class="n">getUser</span><span class="p">)</span>
            <span class="n">patch</span><span class="p">(</span><span class="n">UserController</span><span class="o">::</span><span class="n">updateUser</span><span class="p">)</span>
            <span class="n">delete</span><span class="p">(</span><span class="n">UserController</span><span class="o">::</span><span class="n">deleteUser</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">ws</span><span class="p">(</span><span class="s">"events"</span><span class="p">,</span> <span class="n">UserController</span><span class="o">::</span><span class="n">webSocketEvents</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<p>Note that <code class="highlighter-rouge">path()</code> prefixes your paths with <code class="highlighter-rouge">/</code> (if you don’t add it yourself).<br />
This means that <code class="highlighter-rouge">path("api", ...)</code> and <code class="highlighter-rouge">path("/api", ...)</code> are equivalent.</p>

<h3 id="crudhandler">CrudHandler</h3>
<p>The <code class="highlighter-rouge">CrudHandler</code> is an interface that can be used within a <code class="highlighter-rouge">routes()</code> call:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">routes</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">crud</span><span class="o">(</span><span class="s">"users/{user-id}"</span><span class="o">,</span> <span class="k">new</span> <span class="n">UserController</span><span class="o">());</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">routes</span> <span class="p">{</span>
    <span class="n">crud</span><span class="p">(</span><span class="s">"users/{user-id}"</span><span class="p">,</span> <span class="n">UserController</span><span class="p">())</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<p>It implements the five most common crud operations:</p>
<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">CrudHandler</span> <span class="p">{</span>
    <span class="n">getAll</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
    <span class="n">getOne</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">resourceId</span><span class="p">)</span>
    <span class="n">create</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
    <span class="n">update</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">resourceId</span><span class="p">)</span>
    <span class="n">delete</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">resourceId</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="validation">Validation</h2>
<p>You can use Javalin’s <code class="highlighter-rouge">Validator</code> class for query, form, and path parameters, as well as
headers and the request body:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">ctx</span><span class="o">.</span><span class="na">queryParamAsClass</span><span class="o">(</span><span class="s">"paramName"</span><span class="o">,</span> <span class="n">MyClass</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>   <span class="c1">// creates a Validator&lt;MyClass&gt; for the value of queryParam("paramName")</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">formParamAsClass</span><span class="o">(</span><span class="s">"paramName"</span><span class="o">,</span> <span class="n">MyClass</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>    <span class="c1">// creates a Validator&lt;MyClass&gt; for the value of formParam("paramName")</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">pathParamAsClass</span><span class="o">(</span><span class="s">"paramName"</span><span class="o">,</span> <span class="n">MyClass</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>    <span class="c1">// creates a Validator&lt;MyClass&gt; for the value of pathParam("paramName")</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">headerAsClass</span><span class="o">(</span><span class="s">"headerName"</span><span class="o">,</span> <span class="n">MyClass</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>      <span class="c1">// creates a Validator&lt;MyClass&gt; for the value of header("paramName")</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">bodyValidator</span><span class="o">(</span><span class="n">MyClass</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>                    <span class="c1">// creates a Validator&lt;MyClass&gt; for the value of body()</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">ctx</span><span class="p">.</span><span class="n">queryParamAsClass</span><span class="p">&lt;</span><span class="n">MyClass</span><span class="p">&gt;(</span><span class="s">"paramName"</span><span class="p">)</span>         <span class="c1">// creates a Validator&lt;MyClass&gt; for the value of queryParam("paramName")
</span><span class="n">ctx</span><span class="p">.</span><span class="n">formParamAsClass</span><span class="p">&lt;</span><span class="n">MyClass</span><span class="p">&gt;(</span><span class="s">"paramName"</span><span class="p">)</span>          <span class="c1">// creates a Validator&lt;MyClass&gt; for the value of formParam("paramName")
</span><span class="n">ctx</span><span class="p">.</span><span class="n">pathParamAsClass</span><span class="p">&lt;</span><span class="n">MyClass</span><span class="p">&gt;(</span><span class="s">"paramName"</span><span class="p">)</span>          <span class="c1">// creates a Validator&lt;MyClass&gt; for the value of pathParam("paramName")
</span><span class="n">ctx</span><span class="p">.</span><span class="n">headerAsClass</span><span class="p">&lt;</span><span class="n">MyClass</span><span class="p">&gt;(</span><span class="s">"headerName"</span><span class="p">)</span>            <span class="c1">// creates a Validator&lt;MyClass&gt; for the value of header("paramName")
</span><span class="n">ctx</span><span class="p">.</span><span class="n">bodyValidator</span><span class="p">&lt;</span><span class="n">MyClass</span><span class="p">&gt;()</span>                        <span class="c1">// creates a Validator&lt;MyClass&gt; for the value of body()
</span></code></pre>
    </div>
  </div>
</div>

<p>You can also create your own validator manually through
<code class="highlighter-rouge">Validator.create(clazz, value, fieldName)</code>.</p>

<h3 id="validator-api">Validator API</h3>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">allowNullable</span><span class="o">()</span>                     <span class="c1">// turn the Validator into a NullableValidator (must be called first)</span>
<span class="n">check</span><span class="o">(</span><span class="n">predicate</span><span class="o">,</span> <span class="s">"error"</span><span class="o">)</span>           <span class="c1">// add a check with a ValidationError("error") to the Validator</span>
<span class="n">check</span><span class="o">(</span><span class="n">predicate</span><span class="o">,</span> <span class="n">validationError</span><span class="o">)</span>   <span class="c1">// add a check with a ValidationError to the Validator (can have args for localization)</span>
<span class="n">get</span><span class="o">()</span>                               <span class="c1">// return the validated value as the specified type, or throw ValidationException</span>
<span class="n">getOrThrow</span><span class="o">(</span><span class="n">exceptionFunction</span><span class="o">)</span>       <span class="c1">// return the validated value as the specified type, or throw custom exception</span>
<span class="n">getOrDefault</span><span class="o">()</span>                      <span class="c1">// return default-value if value is null, else call get()</span>
<span class="n">errors</span><span class="o">()</span>                            <span class="c1">// get all the errors of the Validator (as map("fieldName", List&lt;ValidationError&gt;))</span>
</code></pre>
</div>

<h3 id="validation-examples">Validation examples</h3>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// VALIDATE A SINGLE QUERY PARAMETER WITH A DEFAULT VALUE /////////////////////////////////////////////</span>
<span class="n">Integer</span> <span class="n">myValue</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">queryParamAsClass</span><span class="o">(</span><span class="s">"value"</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">getOrDefault</span><span class="o">(</span><span class="mi">788</span><span class="o">)</span> <span class="c1">// validate value</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="c1">// return validated value to the client</span>
<span class="c1">// GET ?value=a would yield HTTP 400 - {"my-qp":[{"message":"TYPE_CONVERSION_FAILED","args":{},"value":"a"}]}</span>
<span class="c1">// GET ?value=1 would yield HTTP 200 - 1 (the validated value)</span>
<span class="c1">// GET ?        would yield HTTP 200 - 788 (the default value)</span>


<span class="c1">// VALIDATE TWO DEPENDENT QUERY PARAMETERS ////////////////////////////////////////////////////////////</span>
<span class="n">Instant</span> <span class="n">fromDate</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">queryParamAsClass</span><span class="o">(</span><span class="s">"from"</span><span class="o">,</span> <span class="n">Instant</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>
<span class="n">Instant</span> <span class="n">toDate</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">queryParamAsClass</span><span class="o">(</span><span class="s">"to"</span><span class="o">,</span> <span class="n">Instant</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="o">.</span><span class="na">check</span><span class="o">(</span><span class="n">it</span> <span class="o">-&gt;</span> <span class="n">it</span><span class="o">.</span><span class="na">isAfter</span><span class="o">(</span><span class="n">fromDate</span><span class="o">),</span> <span class="s">"'to' has to be after 'from'"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">get</span><span class="o">();</span>


<span class="c1">// VALIDATE A JSON BODY ///////////////////////////////////////////////////////////////////////////////</span>
<span class="n">MyObject</span> <span class="n">myObject</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">bodyValidator</span><span class="o">(</span><span class="n">MyObject</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="o">.</span><span class="na">check</span><span class="o">(</span><span class="n">obj</span> <span class="o">-&gt;</span> <span class="n">obj</span><span class="o">.</span><span class="na">myObjectProperty</span> <span class="o">==</span> <span class="n">someValue</span><span class="o">,</span> <span class="s">"THINGS_MUST_BE_EQUAL"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">get</span><span class="o">();</span>

<span class="c1">// VALIDATE WITH CUSTOM VALIDATIONERROR ///////////////////////////////////////////////////////////////</span>
<span class="n">ctx</span><span class="o">.</span><span class="na">queryParamAsClass</span><span class="o">(</span><span class="s">"param"</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="o">.</span><span class="na">check</span><span class="o">({</span> <span class="n">it</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="o">},</span> <span class="k">new</span> <span class="n">ValidationError</span><span class="o">(</span><span class="s">"OVER_LIMIT"</span><span class="o">,</span> <span class="n">Map</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"limit"</span><span class="o">,</span> <span class="mi">5</span><span class="o">)))</span>
    <span class="o">.</span><span class="na">get</span><span class="o">();</span>
<span class="c1">// GET ?param=10 would yield HTTP 400 - {"param":[{"message":"OVER_LIMIT","args":{"limit":5},"value":10}]}</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="c1">// VALIDATE A SINGLE QUERY PARAMETER WITH A DEFAULT VALUE /////////////////////////////////////////////
</span><span class="kd">val</span> <span class="py">myValue</span> <span class="p">=</span> <span class="n">ctx</span><span class="p">.</span><span class="n">queryParamAsClass</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;(</span><span class="s">"value"</span><span class="p">).</span><span class="n">getOrDefault</span><span class="p">(</span><span class="m">788</span><span class="p">)</span> <span class="c1">// validate value
</span><span class="n">ctx</span><span class="p">.</span><span class="n">result</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="c1">// return validated value to the client
// GET ?value=a would yield HTTP 400 - {"my-qp":[{"message":"TYPE_CONVERSION_FAILED","args":{},"value":"a"}]}
// GET ?value=1 would yield HTTP 200 - 1 (the validated value)
// GET ?        would yield HTTP 200 - 788 (the default value)
</span>

<span class="c1">// VALIDATE TWO DEPENDENT QUERY PARAMETERS ////////////////////////////////////////////////////////////
</span><span class="kd">val</span> <span class="py">fromDate</span> <span class="p">=</span> <span class="n">ctx</span><span class="p">.</span><span class="n">queryParamAsClass</span><span class="p">&lt;</span><span class="n">Instant</span><span class="p">&gt;(</span><span class="s">"from"</span><span class="p">).</span><span class="k">get</span><span class="p">()</span>
<span class="kd">val</span> <span class="py">toDate</span> <span class="p">=</span> <span class="n">ctx</span><span class="p">.</span><span class="n">queryParamAsClass</span><span class="p">&lt;</span><span class="n">Instant</span><span class="p">&gt;(</span><span class="s">"to"</span><span class="p">)</span>
    <span class="p">.</span><span class="n">check</span><span class="p">({</span> <span class="n">it</span><span class="p">.</span><span class="n">isAfter</span><span class="p">(</span><span class="n">fromDate</span><span class="p">)</span> <span class="p">},</span> <span class="s">"'to' has to be after 'from'"</span><span class="p">)</span>
    <span class="p">.</span><span class="k">get</span><span class="p">()</span>


<span class="c1">// VALIDATE A JSON BODY ///////////////////////////////////////////////////////////////////////////////
</span><span class="kd">val</span> <span class="py">myObject</span> <span class="p">=</span> <span class="n">ctx</span><span class="p">.</span><span class="n">bodyValidator</span><span class="p">&lt;</span><span class="n">MyObject</span><span class="p">&gt;()</span>
    <span class="p">.</span><span class="n">check</span><span class="p">({</span> <span class="n">it</span><span class="p">.</span><span class="n">myObjectProperty</span> <span class="p">==</span> <span class="n">someValue</span> <span class="p">},</span> <span class="s">"THINGS_MUST_BE_EQUAL"</span><span class="p">)</span>
    <span class="p">.</span><span class="k">get</span><span class="p">()</span>

<span class="c1">// VALIDATE WITH CUSTOM VALIDATIONERROR ///////////////////////////////////////////////////////////////
</span><span class="n">ctx</span><span class="p">.</span><span class="n">queryParamAsClass</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;(</span><span class="s">"param"</span><span class="p">)</span>
    <span class="p">.</span><span class="n">check</span><span class="p">({</span> <span class="n">it</span> <span class="p">&gt;</span> <span class="m">5</span> <span class="p">},</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s">"OVER_LIMIT"</span><span class="p">,</span> <span class="n">args</span> <span class="p">=</span> <span class="n">mapOf</span><span class="p">(</span><span class="s">"limit"</span> <span class="n">to</span> <span class="m">5</span><span class="p">)))</span>
    <span class="p">.</span><span class="k">get</span><span class="p">()</span>
<span class="c1">// GET ?param=10 would yield HTTP 400 - {"param":[{"message":"OVER_LIMIT","args":{"limit":5},"value":10}]}
</span></code></pre>
    </div>
  </div>
</div>

<h3 id="collecting-multiple-errors">Collecting multiple errors</h3>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Validator</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">ageValidator</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">queryParamAsClass</span><span class="o">(</span><span class="s">"age"</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="o">.</span><span class="na">check</span><span class="o">(</span><span class="n">n</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="n">n</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"-"</span><span class="o">),</span> <span class="s">"ILLEGAL_CHARACTER"</span><span class="o">)</span>

<span class="c1">// Empty map if no errors, otherwise a map with the key "age" and failed check messages in the list.</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">ageValidator</span><span class="o">.</span><span class="na">errors</span><span class="o">();</span>

<span class="c1">// Merges all errors from all validators in the list. Empty map if no errors exist.</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">manyErrors</span> <span class="o">=</span> <span class="n">JavalinValidation</span><span class="o">.</span><span class="na">collectErrors</span><span class="o">(</span><span class="n">ageValidator</span><span class="o">,</span> <span class="n">otherValidator</span><span class="o">,</span> <span class="o">...)</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="kd">val</span> <span class="py">ageValidator</span> <span class="p">=</span> <span class="n">ctx</span><span class="p">.</span><span class="n">queryParamAsClass</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;(</span><span class="s">"age"</span><span class="p">)</span>
    <span class="p">.</span><span class="n">check</span><span class="p">({</span> <span class="p">!</span><span class="n">it</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">"-"</span><span class="p">)</span> <span class="p">},</span> <span class="s">"ILLEGAL_CHARACTER"</span><span class="p">)</span>

<span class="c1">// Empty map if no errors, otherwise a map with the key "age" and failed check messages in the list.
</span><span class="kd">val</span> <span class="py">errors</span> <span class="p">=</span> <span class="n">ageValidator</span><span class="p">.</span><span class="n">errors</span><span class="p">()</span>

<span class="c1">// Merges all errors from all validators in the list. Empty map if no errors exist.
</span><span class="kd">val</span> <span class="py">manyErrors</span> <span class="p">=</span> <span class="n">listOf</span><span class="p">(</span><span class="n">ageValidator</span><span class="p">,</span> <span class="n">otherValidator</span><span class="p">,</span> <span class="o">..</span><span class="p">.)</span>
</code></pre>
    </div>
  </div>
</div>

<h3 id="validationexception">ValidationException</h3>
<p>When a <code class="highlighter-rouge">Validator</code> throws, it is mapped by:</p>

<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">exception</span><span class="p">(</span><span class="n">ValidationException</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span> <span class="p">{</span> <span class="n">e</span><span class="p">,</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">json</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">errors</span><span class="p">).</span><span class="n">status</span><span class="p">(</span><span class="m">400</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>

<p>You can override this by doing:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">exception</span><span class="o">(</span><span class="n">ValidationException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// your code</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">exception</span><span class="p">(</span><span class="n">ValidationException</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span> <span class="p">{</span> <span class="n">e</span><span class="p">,</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="c1">// your code
</span><span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h3 id="custom-converters">Custom converters</h3>
<p>If you need to validate a non-included class, you have to register a custom converter:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">JavalinValidation</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">Instant</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">v</span> <span class="o">-&gt;</span> <span class="n">Instant</span><span class="o">.</span><span class="na">ofEpochMilli</span><span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">toLong</span><span class="o">());</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">JavalinValidation</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="n">Instant</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span> <span class="p">{</span> <span class="n">Instant</span><span class="p">.</span><span class="n">ofEpochMilli</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">toLong</span><span class="p">())</span> <span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h2 id="access-manager">Access manager</h2>
<p>Javalin has a functional interface <code class="highlighter-rouge">AccessManager</code>, which let’s you
set per-endpoint authentication and/or authorization. It’s also common to use
before-handlers for this, but enforcing per-endpoint roles give you much more
explicit and readable code. You can implement your access-manager however you want.
Below is an example implementation:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// Set the access-manager that Javalin should use</span>
<span class="n">config</span><span class="o">.</span><span class="na">accessManager</span><span class="o">((</span><span class="n">handler</span><span class="o">,</span> <span class="n">ctx</span><span class="o">,</span> <span class="n">routeRoles</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">MyRole</span> <span class="n">userRole</span> <span class="o">=</span> <span class="n">getUserRole</span><span class="o">(</span><span class="n">ctx</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">routeRoles</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">userRole</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">handler</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="n">ctx</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">401</span><span class="o">).</span><span class="na">result</span><span class="o">(</span><span class="s">"Unauthorized"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">});</span>

<span class="n">Role</span> <span class="nf">getUserRole</span><span class="o">(</span><span class="n">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// determine user role based on request.</span>
    <span class="c1">// typically done by inspecting headers, cookies, or user session</span>
<span class="o">}</span>

<span class="kd">enum</span> <span class="n">Role</span> <span class="kd">implements</span> <span class="n">RouteRole</span> <span class="o">{</span>
    <span class="n">ANYONE</span><span class="o">,</span> <span class="n">ROLE_ONE</span><span class="o">,</span> <span class="n">ROLE_TWO</span><span class="o">,</span> <span class="n">ROLE_THREE</span><span class="o">;</span>
<span class="o">}</span>

<span class="n">app</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/un-secured"</span><span class="o">,</span>   <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="s">"Hello"</span><span class="o">),</span>   <span class="n">Role</span><span class="o">.</span><span class="na">ANYONE</span><span class="o">);</span>
<span class="n">app</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/secured"</span><span class="o">,</span>      <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="s">"Hello"</span><span class="o">),</span>   <span class="n">Role</span><span class="o">.</span><span class="na">ROLE_ONE</span><span class="o">);</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="c1">// Set the access-manager that Javalin should use
</span><span class="n">config</span><span class="p">.</span><span class="n">accessManager</span> <span class="p">{</span> <span class="n">handler</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">routeRoles</span> <span class="p">-&gt;</span>
    <span class="kd">val</span> <span class="py">userRole</span> <span class="p">=</span> <span class="n">getUserRole</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span> <span class="c1">// determine user role based on request
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">routeRoles</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">userRole</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">handler</span><span class="p">.</span><span class="n">handle</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">ctx</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="m">401</span><span class="p">).</span><span class="n">result</span><span class="p">(</span><span class="s">"Unauthorized"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">getUserRole</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">)</span> <span class="p">:</span> <span class="n">Role</span> <span class="p">{</span>
    <span class="c1">// determine user role based on request.
</span>    <span class="c1">// typically done by inspecting headers, cookies, or user session
</span><span class="p">}</span>

<span class="k">enum</span> <span class="kd">class</span> <span class="nc">Role</span> <span class="p">:</span> <span class="n">RouteRole</span> <span class="p">{</span>
    <span class="n">ANYONE</span><span class="p">,</span> <span class="n">ROLE_ONE</span><span class="p">,</span> <span class="n">ROLE_TWO</span><span class="p">,</span> <span class="n">ROLE_THREE</span>
<span class="p">}</span>

<span class="n">app</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"/un-secured"</span><span class="p">,</span>   <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="n">ctx</span><span class="p">.</span><span class="n">result</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">)</span> <span class="p">},</span>   <span class="n">Role</span><span class="p">.</span><span class="n">ANYONE</span><span class="p">);</span>
<span class="n">app</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"/secured"</span><span class="p">,</span>      <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="n">ctx</span><span class="p">.</span><span class="n">result</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">)</span> <span class="p">},</span>   <span class="n">Role</span><span class="p">.</span><span class="n">ROLE_ONE</span><span class="p">);</span>
</code></pre>
    </div>
  </div>
</div>

<p>The <code class="highlighter-rouge">AccessManager</code> will also run before your WebSocket upgrade request
(if you have added roles to the endpoint), but keep in mind that WebSockets are long lived,
so it might be wise to perform a check in <code class="highlighter-rouge">wsBefore</code> too/instead.</p>

<p>If you want to perform less restricted access management,
you should consider using a <code class="highlighter-rouge">before</code> filter.</p>

<h2 id="default-responses">Default responses</h2>
<p>Javalin comes with a built in class called <code class="highlighter-rouge">HttpResponseException</code>, which can be used for default responses.
If the client accepts JSON, a JSON object is returned. Otherwise a plain text response is returned.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span> <span class="o">{</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">ForbiddenResponse</span><span class="o">(</span><span class="s">"Off limits!"</span><span class="o">)</span> <span class="o">}</span>
</code></pre>
</div>
<p>If client accepts JSON:</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="o">{</span>
    <span class="s">"title"</span><span class="o">:</span> <span class="s">"Off limits!"</span><span class="o">,</span>
    <span class="s">"status"</span><span class="o">:</span> <span class="mi">403</span><span class="o">,</span>
    <span class="s">"type"</span><span class="o">:</span> <span class="s">"https://javalin.io/documentation#forbiddenresponse"</span><span class="o">,</span>
    <span class="s">"details"</span><span class="o">:</span> <span class="o">[]</span>
<span class="o">}</span>
</code></pre>
</div>
<p>Otherwise:</p>
<div class="language-text highlighter-rouge"><pre class="highlight"><code>Forbidden
</code></pre>
</div>

<p>You can include a <code class="highlighter-rouge">Map&lt;String, String&gt;</code> of details if you wish.</p>

<h3 id="redirectresponse">RedirectResponse</h3>
<p>Returns a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/302">302 Found</a> response with the default title <code class="highlighter-rouge">Redirected</code>.</p>

<h3 id="badrequestresponse">BadRequestResponse</h3>
<p>Returns a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400">400 Bad Request</a> response with the default title <code class="highlighter-rouge">Bad request</code>.</p>

<h3 id="unauthorizedresponse">UnauthorizedResponse</h3>
<p>Returns a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401">401 Unauthorized</a> response with the default title <code class="highlighter-rouge">Unauthorized</code>.</p>

<h3 id="forbiddenresponse">ForbiddenResponse</h3>
<p>Returns a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/403">403 Forbidden</a> response with the default title <code class="highlighter-rouge">Forbidden</code>.</p>

<h3 id="notfoundresponse">NotFoundResponse</h3>
<p>Returns a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404">404 Not Found</a> response with the default title <code class="highlighter-rouge">Not found</code>.</p>

<h3 id="methodnotallowedresponse">MethodNotAllowedResponse</h3>
<p>Returns a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/405">405 Method Not Allowed</a> response with the default title <code class="highlighter-rouge">Method not allowed</code>.</p>

<h3 id="conflictresponse">ConflictResponse</h3>
<p>Returns a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/409">409 Conflict</a> response with the default title <code class="highlighter-rouge">Conflict</code>.</p>

<h3 id="goneresponse">GoneResponse</h3>
<p>Returns a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/410">410 Gone</a> response with the default title <code class="highlighter-rouge">Gone</code>.</p>

<h3 id="internalservererrorresponse">InternalServerErrorResponse</h3>
<p>Returns a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/500">500 Internal Server Error</a> response with the default title <code class="highlighter-rouge">Internal server error</code>.</p>

<h3 id="badgatewayresponse">BadGatewayResponse</h3>
<p>Returns a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/502">502 Bad Gateway</a> response with the default title <code class="highlighter-rouge">Bad gateway</code>.</p>

<h3 id="serviceunavailableresponse">ServiceUnavailableResponse</h3>
<p>Returns a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/503">503 Service Unavailable</a> response with the default title <code class="highlighter-rouge">Service unavailable</code>.</p>

<h3 id="gatewaytimeoutresponse">GatewayTimeoutResponse</h3>
<p>Returns a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/504">504 Gateway Timeout</a> response with the default title <code class="highlighter-rouge">Gateway timeout</code>.</p>

<h2 id="exception-mapping">Exception Mapping</h2>
<p>All handlers (before, endpoint, after) can throw <code class="highlighter-rouge">Exception</code>
(and any subclass of <code class="highlighter-rouge">Exception</code>)
The <code class="highlighter-rouge">app.exception()</code> method gives you a way of handling these exceptions:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">exception</span><span class="o">(</span><span class="n">NullPointerException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// handle nullpointers here</span>
<span class="o">});</span>

<span class="n">app</span><span class="o">.</span><span class="na">exception</span><span class="o">(</span><span class="n">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// handle general exceptions here</span>
    <span class="c1">// will not trigger if more specific exception-mapper found</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">exception</span><span class="p">(</span><span class="n">NullPointerException</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span> <span class="p">{</span> <span class="n">e</span><span class="p">,</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="c1">// handle nullpointers here
</span><span class="p">}</span>

<span class="n">app</span><span class="p">.</span><span class="n">exception</span><span class="p">(</span><span class="n">Exception</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span> <span class="p">{</span> <span class="n">e</span><span class="p">,</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="c1">// handle general exceptions here
</span>    <span class="c1">// will not trigger if more specific exception-mapper found
</span><span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h2 id="websocket-exception-mapping">WebSocket Exception Mapping</h2>
<p>The different WebSocket handlers throw exceptions. The <code class="highlighter-rouge">app.wsException()</code> method gives you a way of handling these exceptions:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">wsException</span><span class="o">(</span><span class="n">NullPointerException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// handle nullpointers here</span>
<span class="o">});</span>

<span class="n">app</span><span class="o">.</span><span class="na">wsException</span><span class="o">(</span><span class="n">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// handle general exceptions here</span>
    <span class="c1">// will not trigger if more specific exception-mapper found</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">wsException</span><span class="p">(</span><span class="n">NullPointerException</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span> <span class="p">{</span> <span class="n">e</span><span class="p">,</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="c1">// handle nullpointers here
</span><span class="p">}</span>

<span class="n">app</span><span class="p">.</span><span class="n">wsException</span><span class="p">(</span><span class="n">Exception</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span> <span class="p">{</span> <span class="n">e</span><span class="p">,</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="c1">// handle general exceptions here
</span>    <span class="c1">// will not trigger if more specific exception-mapper found
</span><span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h2 id="error-mapping">Error Mapping</h2>
<p>HTTP Error mapping is similar to exception mapping, but it operates on HTTP status codes instead of Exceptions:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="mi">404</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="s">"Generic 404 message"</span><span class="o">)</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="m">404</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">result</span><span class="p">(</span><span class="s">"Generic 404 message"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<p>It can make sense to use them together:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">exception</span><span class="o">(</span><span class="n">FileNotFoundException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">404</span><span class="o">);</span>
<span class="o">}).</span><span class="na">error</span><span class="o">(</span><span class="mi">404</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="s">"Generic 404 message"</span><span class="o">)</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">exception</span><span class="p">(</span><span class="n">FileNotFoundException</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span> <span class="p">{</span> <span class="n">e</span><span class="p">,</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="m">404</span><span class="p">)</span>
<span class="p">}.</span><span class="n">error</span><span class="p">(</span><span class="m">404</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">result</span><span class="p">(</span><span class="s">"Generic 404 message"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<p>You can also include the content type when declaring your error mappers:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="mi">404</span><span class="o">,</span> <span class="s">"html"</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">html</span><span class="o">(</span><span class="s">"Generic 404 message"</span><span class="o">)</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="m">404</span><span class="p">,</span> <span class="s">"html"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">html</span><span class="p">(</span><span class="s">"Generic 404 message"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<p>This can be useful if you, for example, want one set of error handlers for HTML, and one for JSON.</p>

<h2 id="server-sent-events">Server-sent Events</h2>
<p>Server-sent events (often also called event source) are very simple in Javalin.
You call <code class="highlighter-rouge">app.sse()</code>, which gives you access to the connected <code class="highlighter-rouge">SseClient</code>:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">sse</span><span class="o">(</span><span class="s">"/sse"</span><span class="o">,</span> <span class="n">client</span> <span class="o">-&gt;</span>
    <span class="n">client</span><span class="o">.</span><span class="na">sendEvent</span><span class="o">(</span><span class="s">"connected"</span><span class="o">,</span> <span class="s">"Hello, SSE"</span><span class="o">);</span>
    <span class="n">client</span><span class="o">.</span><span class="na">onClose</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Client disconnected"</span><span class="o">));</span>
    <span class="n">client</span><span class="o">.</span><span class="na">close</span><span class="o">();</span> <span class="c1">// close the client</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">sse</span><span class="p">(</span><span class="s">"/sse"</span><span class="p">)</span> <span class="p">{</span> <span class="n">client</span> <span class="p">-&gt;</span>
    <span class="n">client</span><span class="p">.</span><span class="n">sendEvent</span><span class="p">(</span><span class="s">"connected"</span><span class="p">,</span> <span class="s">"Hello, SSE"</span><span class="p">)</span>
    <span class="n">client</span><span class="p">.</span><span class="n">onClose</span> <span class="p">{</span> <span class="n">println</span><span class="p">(</span><span class="s">"Client disconnected"</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">client</span><span class="p">.</span><span class="n">close</span><span class="p">()</span> <span class="c1">// close the client
</span><span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h3 id="sseclient-api">SseClient API</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">sendEvent</span><span class="o">(</span><span class="s">"myMessage"</span><span class="o">)</span>                      <span class="c1">// calls emit("message", "myMessage", noId)</span>
<span class="n">sendEvent</span><span class="o">(</span><span class="s">"eventName"</span><span class="o">,</span> <span class="s">"myMessage"</span><span class="o">)</span>         <span class="c1">// calls emit("eventName", "myMessage", noId)</span>
<span class="n">sendEvent</span><span class="o">(</span><span class="s">"eventName"</span><span class="o">,</span> <span class="s">"myMessage"</span><span class="o">,</span> <span class="s">"id"</span><span class="o">)</span>   <span class="c1">// calls emit("eventName", "myMessage", "id")</span>
<span class="n">onClose</span><span class="o">(</span><span class="n">runnable</span><span class="o">)</span>                           <span class="c1">// callback which runs when a client closes its connection</span>
<span class="n">ctx</span>                                         <span class="c1">// the Context from when the client connected (to fetch query-params, etc)</span>
</code></pre>
</div>

<h2 id="configuration">Configuration</h2>

<p>You can pass a config object when creating a new instance of Javalin.</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">config</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">config</span><span class="o">.</span><span class="na">addStaticFiles</span><span class="o">(...)</span>
    <span class="c1">// your config here</span>
<span class="o">}).</span><span class="na">start</span><span class="o">()</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span><span class="p">.</span><span class="n">create</span> <span class="p">{</span> <span class="n">config</span> <span class="p">-&gt;</span>
    <span class="n">config</span><span class="p">.</span><span class="n">addStaticFiles</span><span class="p">(</span><span class="o">..</span><span class="p">.)</span>
    <span class="c1">// your config here
</span><span class="p">}.</span><span class="n">start</span><span class="p">()</span>
</code></pre>
    </div>
  </div>
</div>

<h3 id="available-config-options">Available config options</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// HTTP</span>
<span class="n">autogenerateEtags</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>                      <span class="c1">// generate etags for responses</span>
<span class="n">prefer405over404</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>                       <span class="c1">// return 405 instead of 404 if path is mapped to different HTTP method</span>
<span class="n">enforceSsl</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>                             <span class="c1">// redirect all http requests to https</span>
<span class="n">defaultContentType</span> <span class="o">=</span> <span class="s">"text/plain"</span><span class="o">;</span>              <span class="c1">// the default content type</span>
<span class="n">maxRequestSize</span> <span class="o">=</span> <span class="mi">1</span><span class="n">_000_000L</span><span class="o">;</span>                    <span class="c1">// either increase this or use inputstream to handle large requests</span>
<span class="n">asyncRequestTimeout</span> <span class="o">=</span> <span class="mi">0L</span><span class="o">;</span>                       <span class="c1">// timeout in milliseconds for async requests (0 means no timeout)</span>
<span class="n">addSinglePageRoot</span><span class="o">(</span><span class="s">"/path"</span><span class="o">,</span> <span class="s">"/file"</span><span class="o">)</span>             <span class="c1">// fancy 404 handler that returns the specified file for 404s on /path</span>
<span class="n">addSinglePageRoot</span><span class="o">(</span><span class="s">"/path"</span><span class="o">,</span> <span class="s">"/file"</span><span class="o">,</span> <span class="n">location</span><span class="o">)</span>   <span class="c1">// fancy 404 handler that returns the specified file for 404s on /path</span>
<span class="n">addSinglePageHandler</span><span class="o">(</span><span class="s">"/path"</span><span class="o">,</span> <span class="n">handler</span><span class="o">)</span>          <span class="c1">// fancy 404 handler that runs the specified Handler for 404s on /path</span>
<span class="n">addStaticFiles</span><span class="o">(</span><span class="s">"/directory"</span><span class="o">,</span> <span class="n">location</span><span class="o">)</span>          <span class="c1">// add static files in directory at location (Location.CLASSPATH/Location.EXTERNAL)</span>
<span class="n">addStaticFiles</span><span class="o">(</span><span class="n">staticFileConfig</span><span class="o">)</span>                <span class="c1">// add static files by StaticFileConfig, see Static Files section</span>
<span class="n">enableWebjars</span><span class="o">()</span>                                 <span class="c1">// add static files though webjars</span>
<span class="n">enableCorsForAllOrigins</span><span class="o">()</span>                       <span class="c1">// enable CORS for all origins</span>
<span class="n">enableCorsForOrigin</span><span class="o">(</span><span class="s">"origin1"</span><span class="o">,</span> <span class="s">"origin2"</span><span class="o">,</span> <span class="o">...)</span>  <span class="c1">// enable CORS the specified origins</span>
<span class="n">enableDevLogging</span><span class="o">()</span>                              <span class="c1">// enable dev logging (extensive debug logging meant for development)</span>
<span class="n">registerPlugin</span><span class="o">(</span><span class="n">myPlugin</span><span class="o">)</span>                        <span class="c1">// register a plugin</span>
<span class="n">requestLogger</span><span class="o">((</span><span class="n">ctx</span><span class="o">,</span> <span class="n">timeInMs</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{})</span>            <span class="c1">// register a request logger</span>

<span class="c1">// WebSocket</span>
<span class="n">wsFactoryConfig</span><span class="o">((</span><span class="n">factory</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{})</span>                <span class="c1">// configure the Jetty WebSocketServletFactory</span>
<span class="n">wsLogger</span><span class="o">((</span><span class="n">ws</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{})</span>                            <span class="c1">// register a WebSocket logger</span>

<span class="c1">// Server</span>
<span class="n">ignoreTrailingSlashes</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>                   <span class="c1">// treat '/path' and '/path/' as the same path</span>
<span class="n">contextPath</span> <span class="o">=</span> <span class="s">"/"</span><span class="o">;</span>                              <span class="c1">// the context path (ex '/blog' if you are hosting an app on a subpath, like 'mydomain.com/blog')</span>
<span class="n">server</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">Server</span><span class="o">())</span>                          <span class="c1">// set the Jetty Server</span>
<span class="n">sessionHandler</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">SessionHandler</span><span class="o">())</span>          <span class="c1">// set the Jetty SessionHandler</span>
<span class="n">configureServletContextHandler</span><span class="o">(</span><span class="n">handler</span> <span class="o">-&gt;</span> <span class="o">{})</span>   <span class="c1">// configure the Jetty ServletContextHandler</span>
<span class="n">jsonMapper</span><span class="o">(</span><span class="n">jsonMapper</span><span class="o">)</span>                          <span class="c1">// configure Javalin's JsonMapper</span>

<span class="c1">// Misc</span>
<span class="n">showJavalinBanner</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>                       <span class="c1">// show the glorious Javalin banner on startup</span>
</code></pre>
</div>

<h3 id="static-files">Static Files</h3>
<p>You can enable static file serving by doing <code class="highlighter-rouge">config.addStaticFiles("/directory", location)</code>.
Static resource handling is done <strong>after</strong> endpoint matching, meaning your own
GET endpoints have higher priority. The process looks like this:</p>

<pre><code class="language-txt">run before-handlers
run endpoint-handlers
if no endpoint-handler found
    run static-file-handlers
    if static-file-found
        static-file-handler sends response
    else
        response is 404
run after-handlers
</code></pre>

<h4 id="staticfileconfig">StaticFileConfig</h4>
<p>For more advanced use cases, Javalin has a <code class="highlighter-rouge">StaticFileConfig</code> class:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">config</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">config</span><span class="o">.</span><span class="na">addStaticFiles</span><span class="o">(</span><span class="n">staticFiles</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">staticFiles</span><span class="o">.</span><span class="na">hostedPath</span> <span class="o">=</span> <span class="s">"/"</span><span class="o">;</span>                   <span class="c1">// change to host files on a subpath, like '/assets'</span>
    <span class="n">staticFiles</span><span class="o">.</span><span class="na">directory</span> <span class="o">=</span> <span class="s">"/public"</span><span class="o">;</span>              <span class="c1">// the directory where your files are located</span>
    <span class="n">staticFiles</span><span class="o">.</span><span class="na">location</span> <span class="o">=</span> <span class="n">Location</span><span class="o">.</span><span class="na">CLASSPATH</span><span class="o">;</span>      <span class="c1">// Location.CLASSPATH (jar) or Location.EXTERNAL (file system)</span>
    <span class="n">staticFiles</span><span class="o">.</span><span class="na">precompress</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>                <span class="c1">// if the files should be pre-compressed and cached in memory (optimization)</span>
    <span class="n">staticFiles</span><span class="o">.</span><span class="na">aliasCheck</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>                  <span class="c1">// you can configure this to enable symlinks (= ContextHandler.ApproveAliases())</span>
    <span class="n">staticFiles</span><span class="o">.</span><span class="na">headers</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="na">of</span><span class="o">(...);</span>              <span class="c1">// headers that will be set for the files</span>
    <span class="n">staticFiles</span><span class="o">.</span><span class="na">skipFileFunction</span> <span class="o">=</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="kc">false</span><span class="o">;</span>    <span class="c1">// you can use this to skip certain files in the dir, based on the HttpServletRequest</span>
  <span class="o">});</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span><span class="p">.</span><span class="n">create</span> <span class="p">{</span> <span class="n">config</span> <span class="p">-&gt;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">addStaticFiles</span> <span class="p">{</span> <span class="n">staticFiles</span> <span class="p">-&gt;</span>
    <span class="n">staticFiles</span><span class="p">.</span><span class="n">hostedPath</span> <span class="p">=</span> <span class="s">"/"</span>                    <span class="c1">// change to host files on a subpath, like '/assets'
</span>    <span class="n">staticFiles</span><span class="p">.</span><span class="n">directory</span> <span class="p">=</span> <span class="s">"/public"</span>               <span class="c1">// the directory where your files are located
</span>    <span class="n">staticFiles</span><span class="p">.</span><span class="n">location</span> <span class="p">=</span> <span class="n">Location</span><span class="p">.</span><span class="n">CLASSPATH</span>       <span class="c1">// Location.CLASSPATH (jar) or Location.EXTERNAL (file system)
</span>    <span class="n">staticFiles</span><span class="p">.</span><span class="n">precompress</span> <span class="p">=</span> <span class="k">false</span>                 <span class="c1">// if the files should be pre-compressed and cached in memory (optimization)
</span>    <span class="n">staticFiles</span><span class="p">.</span><span class="n">aliasCheck</span> <span class="p">=</span> <span class="k">null</span>                   <span class="c1">// you can configure this to enable symlinks (= ContextHandler.ApproveAliases())
</span>    <span class="n">staticFiles</span><span class="p">.</span><span class="n">headers</span> <span class="p">=</span> <span class="n">mapOf</span><span class="p">(</span><span class="o">..</span><span class="p">.)</span>                <span class="c1">// headers that will be set for the files
</span>    <span class="n">staticFiles</span><span class="p">.</span><span class="n">skipFileFunction</span> <span class="p">=</span> <span class="p">{</span> <span class="n">req</span> <span class="p">-&gt;</span> <span class="k">false</span> <span class="p">}</span> <span class="c1">// you can use this to skip certain files in the dir, based on the HttpServletRequest
</span>  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<p>You can call <code class="highlighter-rouge">addStaticFiles</code> multiple times to set up multiple handlers.
No configuration is shared between handlers.</p>

<h4 id="webjars">WebJars</h4>
<p>WebJars can be enabled by calling <code class="highlighter-rouge">enableWebJars()</code>,
they will be available at <code class="highlighter-rouge">/webjars/name/version/file.ext</code>.
WebJars can be found on <a href="https://www.webjars.org/">https://www.webjars.org/</a>.
Everything available through NPM is also available through WebJars.</p>

<h3 id="single-page-mode">Single page mode</h3>
<p>Single page mode is similar to static file handling. It runs after endpoint matching, and after static file handling.
It’s basically a very fancy 404 mapper, which converts any 404’s into a specified page.
You can define multiple single page handlers for your application by specifying different root paths.</p>

<p>You can enabled single page mode by doing <code class="highlighter-rouge">config.addSinglePageRoot("/root", "/path/to/file.html")</code>, and/or
<code class="highlighter-rouge">config.addSinglePageRoot("/root", "/path/to/file.html", Location.EXTERNAL)</code>.</p>

<h4 id="dynamic-single-page-handler">Dynamic single page handler</h4>
<p>You can also use a <code class="highlighter-rouge">Handler</code> to serve your single page root (as opposed to a static file):</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">config</span><span class="o">.</span><span class="na">addSinglePageHandler</span><span class="o">(</span><span class="s">"/root"</span><span class="o">,</span>  <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">html</span><span class="o">(...);</span>
<span class="o">});</span>
</code></pre>
</div>

<h3 id="logging">Logging</h3>

<h4 id="adding-a-logger">Adding a logger</h4>

<p>Javalin does not have a logger included,
which means that you have to add your own logger. If you don’t know/care
a lot about Java loggers, the easiest way to fix this is to add the following
dependency to your project:</p>

<pre><code class="language-markup">&lt;dependency&gt;
    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
    &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;
    &lt;version&gt;1.7.36&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<h4 id="request-logging">Request logging</h4>
<p>You can add a HTTP request logger by calling <code class="highlighter-rouge">config.requestLogger()</code>.
The method takes a <code class="highlighter-rouge">Context</code> and the time in milliseconds it took to finish the request:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">config</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">config</span><span class="o">.</span><span class="na">requestLogger</span><span class="o">((</span><span class="n">ctx</span><span class="o">,</span> <span class="n">ms</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="c1">// log things here</span>
    <span class="o">});</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span><span class="p">.</span><span class="n">create</span> <span class="p">{</span> <span class="n">config</span> <span class="p">-&gt;</span>
    <span class="n">config</span><span class="p">.</span><span class="n">requestLogger</span> <span class="p">{</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">ms</span> <span class="p">-&gt;</span>
        <span class="c1">// log things here
</span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h4 id="websocket-logging">WebSocket logging</h4>
<p>You can add a WebSocket logger by calling <code class="highlighter-rouge">config.wsLogger()</code>. The method takes a <code class="highlighter-rouge">WsHandler</code>,
(the same interface as a normal <code class="highlighter-rouge">app.ws()</code> call), and can be used to log events of all types.
The following example just shows <code class="highlighter-rouge">onMessage</code>, but <code class="highlighter-rouge">onConnect</code>, <code class="highlighter-rouge">onError</code> and <code class="highlighter-rouge">onClose</code> are all available:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">config</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">config</span><span class="o">.</span><span class="na">wsLogger</span><span class="o">(</span><span class="n">ws</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">ws</span><span class="o">.</span><span class="na">onMessage</span><span class="o">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Received: "</span> <span class="o">+</span> <span class="n">ctx</span><span class="o">.</span><span class="na">message</span><span class="o">());</span>
        <span class="o">});</span>
    <span class="o">});</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">create</span> <span class="p">{</span> <span class="n">config</span> <span class="p">-&gt;</span>
    <span class="n">config</span><span class="p">.</span><span class="n">wsLogger</span><span class="p">(</span><span class="n">ws</span> <span class="p">-&gt;</span> <span class="p">{</span>
        <span class="n">ws</span><span class="p">.</span><span class="n">onMessage</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
            <span class="n">println</span><span class="p">(</span><span class="s">"Received: "</span> <span class="p">+</span> <span class="n">ctx</span><span class="p">.</span><span class="n">message</span><span class="p">());</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<p>The logger runs after the WebSocket handler for the endpoint.</p>

<h4 id="dev-logging">Dev logging</h4>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">config</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">config</span><span class="o">.</span><span class="na">enableDevLogging</span><span class="o">();</span> <span class="c1">// enable extensive development logging for http and websocket</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">create</span> <span class="p">{</span> <span class="n">config</span> <span class="p">-&gt;</span>
    <span class="n">config</span><span class="p">.</span><span class="n">enableDevLogging</span><span class="p">()</span> <span class="c1">// enable extensive development logging for http and websocket
</span><span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h3 id="server-setup">Server setup</h3>

<p>Javalin runs on an embedded <a href="http://eclipse.org/jetty/">Jetty</a>. To start and stop the server,
use <code class="highlighter-rouge">start()</code> and <code class="highlighter-rouge">stop</code>:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span> <span class="n">app</span> <span class="o">=</span> <span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">()</span>
    <span class="o">.</span><span class="na">start</span><span class="o">()</span> <span class="c1">// start server (sync/blocking)</span>
    <span class="o">.</span><span class="na">stop</span><span class="o">()</span> <span class="c1">// stop server (sync/blocking)</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">app.start()</code> method spawns a user thread, starts the server, and then returns.
Your program will not exit until this thread is terminated by calling <code class="highlighter-rouge">app.stop()</code>.</p>

<p>If you want to do a clean shutdown when the program is exiting, you could use:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">addShutdownHook</span><span class="o">(</span><span class="k">new</span> <span class="n">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="n">app</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
<span class="o">}));</span>

<span class="n">app</span><span class="o">.</span><span class="na">events</span><span class="o">(</span><span class="n">event</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">event</span><span class="o">.</span><span class="na">serverStopping</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="cm">/* Your code here */</span> <span class="o">});</span>
    <span class="n">event</span><span class="o">.</span><span class="na">serverStopped</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="cm">/* Your code here */</span> <span class="o">});</span>
<span class="o">});</span>
</code></pre>
</div>

<h4 id="setting-the-host">Setting the Host</h4>

<p>The <code class="highlighter-rouge">Javalin#start</code> method is overloaded to accept the Host (IP) as the first argument:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">().</span><span class="na">start</span><span class="o">(</span><span class="s">"127.0.0.1"</span><span class="o">,</span> <span class="mi">1235</span><span class="o">)</span>
</code></pre>
</div>

<h4 id="custom-server">Custom server</h4>
<p>If you need to customize the embedded server, you can call the <code class="highlighter-rouge">server()</code> method:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">config</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">config</span><span class="o">.</span><span class="na">server</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">Server</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="o">();</span> <span class="c1">// configure this however you want</span>
        <span class="k">return</span> <span class="n">server</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">create</span> <span class="p">{</span> <span class="n">config</span> <span class="p">-&gt;</span>
    <span class="n">config</span><span class="p">.</span><span class="n">server</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">server</span> <span class="p">=</span> <span class="n">Server</span><span class="p">()</span> <span class="c1">// configure this however you want
</span>        <span class="n">server</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<h4 id="custom-sessionhandler">Custom SessionHandler</h4>

<p>You can configure the <code class="highlighter-rouge">SessionHandler</code> by calling the <code class="highlighter-rouge">sessionHandler(...)</code> method.</p>

<p>If you want to persist sessions to the file system, you can use a <code class="highlighter-rouge">FileSessionDataStore</code>:</p>

<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="k">private</span> <span class="k">fun</span> <span class="nf">fileSessionHandler</span><span class="p">()</span> <span class="p">=</span> <span class="n">SessionHandler</span><span class="p">().</span><span class="n">apply</span> <span class="p">{</span>
    <span class="n">httpOnly</span> <span class="p">=</span> <span class="k">true</span>
    <span class="n">sessionCache</span> <span class="p">=</span> <span class="n">DefaultSessionCache</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="n">apply</span> <span class="p">{</span>
        <span class="n">sessionDataStore</span> <span class="p">=</span> <span class="n">FileSessionDataStore</span><span class="p">().</span><span class="n">apply</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">baseDir</span> <span class="p">=</span> <span class="n">File</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s">"java.io.tmpdir"</span><span class="p">))</span>
            <span class="n">storeDir</span> <span class="p">=</span> <span class="n">File</span><span class="p">(</span><span class="n">baseDir</span><span class="p">,</span> <span class="s">"javalin-session-store"</span><span class="p">).</span><span class="n">apply</span> <span class="p">{</span> <span class="n">mkdir</span><span class="p">()</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Read more about how to configure sessions in our
<a href="/tutorials/jetty-session-handling">session tutorial</a>.</p>

<h4 id="custom-jetty-handlers">Custom jetty handlers</h4>
<p>You can configure your embedded jetty-server with a handler-chain
(<a href="https://github.com/javalin/javalin/blob/master/javalin/src/test/java/io/javalin/TestCustomJetty.kt#L71-L87">example</a>),
and Javalin will attach it’s own handlers to the end of this chain.</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">StatisticsHandler</span> <span class="n">statisticsHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StatisticsHandler</span><span class="o">();</span>

<span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">config</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">config</span><span class="o">.</span><span class="na">server</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">Server</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="o">();</span>
        <span class="n">server</span><span class="o">.</span><span class="na">setHandler</span><span class="o">(</span><span class="n">statisticsHandler</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">server</span><span class="o">;</span>
    <span class="o">})</span>
<span class="o">}).</span><span class="na">start</span><span class="o">();</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="kd">val</span> <span class="py">statisticsHandler</span> <span class="p">=</span> <span class="n">StatisticsHandler</span><span class="p">()</span>

<span class="n">Javalin</span><span class="p">.</span><span class="n">create</span> <span class="p">{</span> <span class="n">config</span> <span class="p">-&gt;</span>
    <span class="n">config</span><span class="p">.</span><span class="n">server</span> <span class="p">{</span>
        <span class="n">Server</span><span class="p">().</span><span class="n">apply</span> <span class="p">{</span>
            <span class="n">handler</span> <span class="p">=</span> <span class="n">statisticsHandler</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}.</span><span class="n">start</span><span class="p">();</span>
</code></pre>
    </div>
  </div>
</div>

<h4 id="sslhttp2">SSL/HTTP2</h4>

<p>To configure SSL or HTTP2 you need to use a custom server (see previous section).<br />
An example of a custom server with SSL can be found in the examples,
<a href="https://github.com/javalin/javalin/blob/master/javalin/src/test/java/io/javalin/examples/HelloWorldSecure.java#L22-L30">HelloWorldSecure</a>.</p>

<p>A custom HTTP2 server is a bit more work to set up, but we have a repo with a
fully functioning example server in both Kotlin and Java: <a href="https://github.com/tipsy/javalin-http2-example">javalin-http2-example</a></p>

<h2 id="lifecycle-events">Lifecycle events</h2>
<p>Javalin has events for server start/stop, as well as for when handlers are added.
The snippet below shows all of them in action:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span> <span class="n">app</span> <span class="o">=</span> <span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">().</span><span class="na">events</span><span class="o">(</span><span class="n">event</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">event</span><span class="o">.</span><span class="na">serverStarting</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="o">...</span> <span class="o">});</span>
    <span class="n">event</span><span class="o">.</span><span class="na">serverStarted</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="o">...</span> <span class="o">});</span>
    <span class="n">event</span><span class="o">.</span><span class="na">serverStartFailed</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="o">...</span> <span class="o">});</span>
    <span class="n">event</span><span class="o">.</span><span class="na">serverStopping</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="o">...</span> <span class="o">});</span>
    <span class="n">event</span><span class="o">.</span><span class="na">serverStopped</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="o">...</span> <span class="o">});</span>
    <span class="n">event</span><span class="o">.</span><span class="na">handlerAdded</span><span class="o">(</span><span class="n">handlerMetaInfo</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="o">...</span> <span class="o">});</span>
    <span class="n">event</span><span class="o">.</span><span class="na">wsHandlerAdded</span><span class="o">(</span><span class="n">wsHandlerMetaInfo</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="o">...</span> <span class="o">});</span>
<span class="o">});</span>

<span class="n">app</span><span class="o">.</span><span class="na">start</span><span class="o">()</span> <span class="c1">// serverStarting -&gt; (serverStarted || serverStartFailed)</span>
<span class="n">app</span><span class="o">.</span><span class="na">stop</span><span class="o">()</span> <span class="c1">// serverStopping -&gt; serverStopped</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span> <span class="n">app</span> <span class="p">=</span> <span class="n">Javalin</span><span class="p">.</span><span class="n">create</span><span class="p">().</span><span class="n">events</span> <span class="p">{</span> <span class="n">event</span> <span class="p">-&gt;</span>
    <span class="n">event</span><span class="p">.</span><span class="n">serverStarting</span> <span class="p">{</span> <span class="o">..</span><span class="p">.</span> <span class="p">}</span>
    <span class="n">event</span><span class="p">.</span><span class="n">serverStarted</span> <span class="p">{</span> <span class="o">..</span><span class="p">.</span> <span class="p">}</span>
    <span class="n">event</span><span class="p">.</span><span class="n">serverStartFailed</span> <span class="p">{</span> <span class="o">..</span><span class="p">.</span> <span class="p">}</span>
    <span class="n">event</span><span class="p">.</span><span class="n">serverStopping</span> <span class="p">{</span> <span class="o">..</span><span class="p">.</span> <span class="p">}</span>
    <span class="n">event</span><span class="p">.</span><span class="n">serverStopped</span> <span class="p">{</span> <span class="o">..</span><span class="p">.</span> <span class="p">}</span>
    <span class="n">event</span><span class="p">.</span><span class="n">handlerAdded</span> <span class="p">{</span> <span class="n">handlerMetaInfo</span> <span class="p">-&gt;</span> <span class="p">}</span>
    <span class="n">event</span><span class="p">.</span><span class="n">wsHandlerAdded</span> <span class="p">{</span> <span class="n">wsHandlerMetaInfo</span> <span class="p">-&gt;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="n">app</span><span class="p">.</span><span class="n">start</span><span class="p">()</span> <span class="c1">// serverStarting -&gt; (serverStarted || serverStartFailed)
</span><span class="n">app</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span> <span class="c1">// serverStopping -&gt; serverStopped
</span></code></pre>
    </div>
  </div>
</div>

<h2 id="plugins">Plugins</h2>
<p>Javalin’s plugin system has two interfaces, <code class="highlighter-rouge">Plugin</code> and <code class="highlighter-rouge">PluginLifecycleInit</code>:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">Plugin</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">apply</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="n">Javalin</span> <span class="n">app</span><span class="o">);</span>
<span class="o">}</span>
<span class="kd">interface</span> <span class="nc">PluginLifecycleInit</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="n">Javalin</span> <span class="n">app</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
</div>

<p>When implementing <code class="highlighter-rouge">PluginLifecycleInit#init</code>, you are not allowed to add <code class="highlighter-rouge">Handler</code> instances to the app.<br />
The two interface methods are called like this during setup:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">initPlugins</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">plugin</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">plugin</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">app</span><span class="o">);</span>
    <span class="c1">// will throw exception if `init` adds Handler</span>
<span class="o">});</span>

<span class="n">plugins</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">plugin</span> <span class="o">-&gt;</span> <span class="n">plugin</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">app</span><span class="o">));</span>
</code></pre>
</div>

<p>This is mainly so each plugin has a chance to add <code class="highlighter-rouge">handlerAdded</code> listeners before other plugins
add <em>their</em> handlers, so that each plugin has a complete overview of all handlers.</p>

<h3 id="route-overview-plugin">Route overview plugin</h3>

<p>You can enable a HTML page showing all the routes of your application by registering it on the config:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">config</span> <span class="o">-&gt;</span>
    <span class="n">config</span><span class="o">.</span><span class="na">registerPlugin</span><span class="o">(</span><span class="k">new</span> <span class="n">RouteOverviewPlugin</span><span class="o">(</span><span class="n">path</span><span class="o">));</span>        <span class="c1">// show all routes on specified path</span>
    <span class="n">config</span><span class="o">.</span><span class="na">registerPlugin</span><span class="o">(</span><span class="k">new</span> <span class="n">RouteOverviewPlugin</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="n">roles</span><span class="o">));</span> <span class="c1">// show all routes on specified path (with auth)</span>
<span class="o">)</span>
</code></pre>
</div>

<h3 id="micrometer-plugin">Micrometer Plugin</h3>

<p>You can enable the Micrometer plugin by registering it on the config:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">config</span> <span class="o">-&gt;</span>
    <span class="n">config</span><span class="o">.</span><span class="na">registerPlugin</span><span class="o">(</span><span class="k">new</span> <span class="n">MicrometerPlugin</span><span class="o">());</span>
<span class="o">)</span>
</code></pre>
</div>

<p>Additional documentation for the plugin can be found <a href="/plugins/micrometer">here</a>.</p>

<h3 id="openapi-plugin">OpenAPI Plugin</h3>

<p>Javalin has an OpenAPI (Swagger) plugin. Full documentation for the plugin can be found <a href="/plugins/openapi">here</a>,
below are a few examples:</p>

<h4 id="openapi-dsl">OpenAPI DSL</h4>
<p>When using the OpenAPI DSL you define an <code class="highlighter-rouge">OpenApiDocumentation</code> object to pair with your <code class="highlighter-rouge">Handler</code>:</p>

<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="kd">val</span> <span class="py">addUserDocs</span> <span class="p">=</span> <span class="n">document</span><span class="p">()</span>
        <span class="p">.</span><span class="n">body</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;()</span>
        <span class="p">.</span><span class="n">result</span><span class="p">&lt;</span><span class="n">Unit</span><span class="p">&gt;(</span><span class="s">"400"</span><span class="p">)</span>
        <span class="p">.</span><span class="n">result</span><span class="p">&lt;</span><span class="n">Unit</span><span class="p">&gt;(</span><span class="s">"204"</span><span class="p">)</span>

<span class="k">fun</span> <span class="nf">addUserHandler</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">user</span> <span class="p">=</span> <span class="n">ctx</span><span class="p">.</span><span class="n">body</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;()</span>
    <span class="n">UserRepository</span><span class="p">.</span><span class="n">addUser</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="m">204</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>

<p>You then combine these when you add your routes:</p>

<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">post</span><span class="p">(</span><span class="s">"/users"</span><span class="p">,</span> <span class="n">documented</span><span class="p">(</span><span class="n">addUserDocs</span><span class="p">,</span> <span class="o">::</span><span class="n">addUserHandler</span><span class="p">))</span>
</code></pre>
</div>

<h4 id="openapi-annotations">OpenAPI annotations</h4>

<p>If you prefer to keep your documentation separate from your code, you can use annotations instead:</p>

<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">@OpenApi</span><span class="p">(</span>
    <span class="n">requestBody</span> <span class="p">=</span> <span class="n">OpenApiRequestBody</span><span class="p">(</span><span class="n">User</span><span class="o">::</span><span class="k">class</span><span class="p">),</span>
    <span class="n">responses</span> <span class="p">=</span> <span class="p">[</span>
        <span class="n">OpenApiResponse</span><span class="p">(</span><span class="s">"400"</span><span class="p">,</span> <span class="n">Unit</span><span class="o">::</span><span class="k">class</span><span class="p">),</span>
        <span class="n">OpenApiResponse</span><span class="p">(</span><span class="s">"201"</span><span class="p">,</span> <span class="n">Unit</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="k">fun</span> <span class="nf">createUser</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">user</span> <span class="p">=</span> <span class="n">ctx</span><span class="p">.</span><span class="n">body</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;()</span>
    <span class="n">UserRepository</span><span class="p">.</span><span class="n">createUser</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="m">201</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>

<p>If you use the annotation API you don’t need to connect the documentation and the handler manually,
you just reference your handler as normal:</p>

<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">post</span><span class="p">(</span><span class="s">"/users"</span><span class="p">,</span> <span class="o">::</span><span class="n">addUserHandler</span><span class="p">)</span>
</code></pre>
</div>

<p>Javalin will then extract the information from the annotation and build the documentation automatically.</p>

<p>To enable hosted docs you have to specify some paths in your Javalin config:</p>

<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="kd">val</span> <span class="py">app</span> <span class="p">=</span> <span class="n">Javalin</span><span class="p">.</span><span class="n">create</span> <span class="p">{</span>
    <span class="n">it</span><span class="p">.</span><span class="n">enableOpenApi</span><span class="p">(</span>
            <span class="n">OpenApiOptions</span><span class="p">(</span><span class="n">Info</span><span class="p">().</span><span class="n">version</span><span class="p">(</span><span class="s">"1.0"</span><span class="p">).</span><span class="n">description</span><span class="p">(</span><span class="s">"My Application"</span><span class="p">))</span>
                    <span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="s">"/swagger-json"</span><span class="p">)</span>
                    <span class="p">.</span><span class="n">swagger</span><span class="p">(</span><span class="n">SwaggerOptions</span><span class="p">(</span><span class="s">"/swagger"</span><span class="p">).</span><span class="n">title</span><span class="p">(</span><span class="s">"My Swagger Documentation"</span><span class="p">))</span>
                    <span class="p">.</span><span class="n">reDoc</span><span class="p">(</span><span class="n">ReDocOptions</span><span class="p">(</span><span class="s">"/redoc"</span><span class="p">).</span><span class="n">title</span><span class="p">(</span><span class="s">"My ReDoc Documentation"</span><span class="p">))</span>
    <span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Full documentation for the OpenAPI plugin can be found at <a href="/plugins/openapi">/plugins/openapi</a>.</p>

<h3 id="graphql-plugin">GraphQL plugin</h3>
<p>Javalin has an GraphQL plugin. You can see its documentation at <a href="/plugins/graphql">/plugins/graphql</a>.</p>

<h3 id="redirect-to-lowercase-path-plugin">Redirect-to-lowercase-path plugin</h3>

<p>This plugin redirects requests with uppercase/mixcase paths to lowercase paths.
For example, <code class="highlighter-rouge">/Users/John</code> redirects to <code class="highlighter-rouge">/users/John</code> (if endpoint is <code class="highlighter-rouge">/users/:userId</code>).
It does not affect the casing of path-params and query-params, only static
URL fragments (<code class="highlighter-rouge">Users</code> becomes <code class="highlighter-rouge">users</code> above, but <code class="highlighter-rouge">John</code> remains <code class="highlighter-rouge">John</code>).<br />
When using this plugin, you can only add paths with lowercase URL fragments.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">config</span> <span class="o">-&gt;</span>
    <span class="n">config</span><span class="o">.</span><span class="na">registerPlugin</span><span class="o">(</span><span class="k">new</span> <span class="n">RedirectToLowercasePathPlugin</span><span class="o">());</span>
<span class="o">)</span>
</code></pre>
</div>

<h2 id="different-javalin-modules">Different Javalin modules</h2>

<p>Javalin is a multi-module project. The current modules (for <code class="highlighter-rouge">5.0.1</code>)  are:</p>

<ul>
  <li><code class="highlighter-rouge">javalin</code> - the standard Javalin dependency, just as before</li>
  <li><code class="highlighter-rouge">javalin-bundle</code> - <code class="highlighter-rouge">javalin</code>, <code class="highlighter-rouge">javalin-openapi</code>, <code class="highlighter-rouge">jackson</code> and <code class="highlighter-rouge">logback</code></li>
  <li><code class="highlighter-rouge">javalin-openapi</code> - the OpenAPI plugin and all required dependencies</li>
  <li><code class="highlighter-rouge">javalin-testtools</code> - tools for easily writing integration tests for Javalin apps</li>
  <li><code class="highlighter-rouge">javalin-graphql</code> - the new GraphQL plugin (thanks to <a href="https://github.com/7agustibm">7agustibm</a>)</li>
  <li><code class="highlighter-rouge">javalin-without-jetty</code> - <code class="highlighter-rouge">javalin</code> with all <code class="highlighter-rouge">jetty</code> dependencies excluded
and Jetty specific methods removed (useful for running on e.g. Tomcat)</li>
</ul>

<h2 id="faq">FAQ</h2>
<p>Frequently asked questions.</p>

<h3 id="request-lifecycle">Request lifecycle</h3>
<p>The Javalin request lifecycle is pretty straightforward.
The following snippet covers every place you can hook into:</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Javalin</span><span class="err">#</span><span class="n">before</span>              <span class="c1">// runs first, can throw exception (which will skip any endpoint handlers)</span>
<span class="n">Javalin</span><span class="err">#</span><span class="n">get</span><span class="o">/</span><span class="n">post</span><span class="o">/</span><span class="n">patch</span><span class="o">/</span><span class="n">etc</span>  <span class="c1">// runs second, can throw exception</span>
<span class="n">Javalin</span><span class="err">#</span><span class="n">error</span>               <span class="c1">// runs third, can throw exception</span>
<span class="n">Javalin</span><span class="err">#</span><span class="n">after</span>               <span class="c1">// runs fourth, can throw exception</span>
<span class="n">Javalin</span><span class="err">#</span><span class="n">exception</span>           <span class="c1">// runs any time a handler throws (cannot throw exception)</span>
<span class="n">JavalinConfig</span><span class="err">#</span><span class="n">requestLogger</span> <span class="c1">// runs after response is written to client</span>
<span class="n">JavalinConfig</span><span class="err">#</span><span class="n">accessManager</span> <span class="c1">// wraps all your endpoint handlers in a lambda of your choice</span>
</code></pre>
</div>

<hr />

<h3 id="rate-limiting">Rate limiting</h3>
<p>There is a very simple rate limiter included in Javalin.
You can call it in the beginning of your endpoint <code class="highlighter-rouge">Handler</code> functions:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">NaiveRateLimit</span><span class="o">.</span><span class="na">requestPerTimeUnit</span><span class="o">(</span><span class="n">ctx</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MINUTES</span><span class="o">);</span> <span class="c1">// throws if rate limit is exceeded</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="s">"Hello, rate-limited World!"</span><span class="o">);</span>
<span class="o">});</span>

<span class="c1">// you can overwrite the key-function:</span>
<span class="n">RateLimitUti</span><span class="o">.</span><span class="na">keyFunction</span> <span class="o">=</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="c1">// uses (ip+method+endpointPath) by default</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="n">NaiveRateLimit</span><span class="p">.</span><span class="n">requestPerTimeUnit</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="n">TimeUnit</span><span class="p">.</span><span class="n">MINUTES</span><span class="p">)</span> <span class="c1">// throws if rate limit is exceeded
</span>    <span class="n">ctx</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="s">"Hello, rate-limited World!"</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// you can overwrite the key-function:
</span><span class="n">RateLimitUti</span><span class="p">.</span><span class="n">keyFunction</span> <span class="p">=</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="p">}</span> <span class="c1">// uses (ip+method+endpointPath) by default
</span></code></pre>
    </div>
  </div>
</div>

<p>Different endpoints can have different rate limits. It works as follows:</p>

<ul>
  <li>A map of maps holds counter per key.</li>
  <li>On each request the counter for that key is incremented.</li>
  <li>If the counter exceeds the number of requests specified, an exception is thrown.</li>
  <li>All counters are cleared periodically on every timeunit that you specified.</li>
</ul>

<hr />

<h3 id="android">Android</h3>
<p>To use Javalin in an Android project, you will need to:</p>

<p><em>1: Target the Android SDK 26 and higher:</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>defaultconfig {
  minSdkVersion 26
  targetSdkVersion 28
}
</code></pre>
</div>

<p><em>2: Target Java 8:</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>compileOptions {
    sourceCompatibility JavaVersion.VERSION_1_8
    targetCompatibility JavaVersion.VERSION_1_8
}
</code></pre>
</div>

<p><em>3: Insert this in your build.gradle file:</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>packagingOptions {
  exclude 'org/eclipse/jetty/http/encoding.properties'
}
</code></pre>
</div>

<p><em>4: Specify <code class="highlighter-rouge">android.enableD8=true</code> in your <code class="highlighter-rouge">gradle.properties</code> file.</em></p>

<hr />

<h3 id="concurrency">Concurrency</h3>

<p>By default, Javalin serves requests using a Jetty <code class="highlighter-rouge">QueuedThreadPool</code> with 250 threads.
Handlers are invoked in parallel on multiple threads, so all handler implementations should be thread-safe.</p>

<p>The default configuration adds a very thin abstraction layer on top of Jetty. It has similar performance to raw
Jetty, which is able to handle
<a href="https://www.techempower.com/benchmarks/#section=data-r20&amp;hw=ph&amp;test=plaintext&amp;l=zik0vz-sf&amp;p=ziimf3-zik0zj-zik0zj-zik0zj-1ekf">over a million plaintext requests per second</a>.</p>

<p>If you have <em>a lot</em> of long running requests, it might be worth looking into <a href="#asynchronous-requests">Asynchronous requests</a>,
or <a href="https://github.com/tipsy/loomylin">setting up Javalin with project Loom</a>.</p>

<p>If you’re not sure if you need async requests, you probably don’t.</p>

<h4 id="websocket-message-ordering">WebSocket Message Ordering</h4>

<p>WebSocket operates over TCP, so messages will arrive at the server in the order that they were sent
by the client. Javalin then handles the messages from a given WebSocket connection sequentially.
Therefore, the order that messages are handled is guaranteed to be the same as the order the client
sent them in.</p>

<p>However, different connections will be handled in parallel on multiple threads, so the WebSocket
event handlers should be thread-safe.</p>

<hr />

<h3 id="testing">Testing</h3>
<p>People often ask how to test Javalin apps. Since Javalin is just a library, you can
instantiate and start the server programmatically. This means testing is really up to you.
There is a tutorial at <a href="/tutorials/testing">/tutorials/testing</a> which goes through
some different types of tests (unit tests, functional/integration tests, ui/end-to-end tests).
You can read it to get some ideas for how to test your app.</p>

<hr />

<h3 id="javadoc">Javadoc</h3>
<p>There is a Javadoc available at <a href="http://javadoc.io/doc/io.javalin/javalin">javadoc.io</a>.
Please contribute to the Javadoc if you can.</p>

<hr />

<h3 id="deploying">Deploying</h3>
<p>To deploy Javalin, simply create a <a href="https://maven.apache.org/plugins/maven-assembly-plugin/usage.html">jar with dependencies</a>,
then launch the jar with <code class="highlighter-rouge">java -jar filename.jar</code>. That’s it.
Javalin has an embedded server, so you don’t need an application server.
There is also a tutorial on <a href="/tutorials/heroku">deploying Javalin to Heroku</a>.</p>

<hr />

<h3 id="other-web-servers">Other web servers</h3>
<div class="comment"><strong>Ctrl+f</strong>: "without jetty", "tomcat", "standalone", "servlet container", "war".</div>

<p>Javalin is primarily meant to be used with the embedded Jetty server, but if you want to run Javalin
on another web server (such as Tomcat), you can use the <code class="highlighter-rouge">javalin-without-jetty</code> artifact.</p>

<hr />

<h3 id="uploads">Uploads</h3>
<p>Uploaded files are easily accessible via <code class="highlighter-rouge">ctx.uploadedFiles()</code>:</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">"/upload"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">uploadedFiles</span><span class="o">(</span><span class="s">"files"</span><span class="o">).</span><span class="na">forEach</span><span class="o">(</span><span class="n">uploadedFile</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">FileUtil</span><span class="o">.</span><span class="na">streamToFile</span><span class="o">(</span><span class="n">uploadedFile</span><span class="o">.</span><span class="na">getContent</span><span class="o">(),</span> <span class="s">"upload/"</span> <span class="o">+</span> <span class="n">uploadedFile</span><span class="o">.</span><span class="na">getFilename</span><span class="o">())</span>
    <span class="o">});</span>
<span class="o">});</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/upload"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">uploadedFiles</span><span class="p">(</span><span class="s">"files"</span><span class="p">).</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">uploadedFile</span> <span class="p">-&gt;</span>
        <span class="n">FileUtil</span><span class="p">.</span><span class="n">streamToFile</span><span class="p">(</span><span class="n">uploadedFile</span><span class="p">.</span><span class="n">content</span><span class="p">,</span> <span class="s">"upload/${uploadedFile.filename}"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
    </div>
  </div>
</div>

<p>The corresponding HTML might look something like this:</p>
<pre><code class="language-markup">&lt;form method="post" action="/upload" enctype="multipart/form-data"&gt;
    &lt;input type="file" name="files" multiple&gt;
    &lt;button&gt;Submit&lt;/button&gt;
&lt;/form&gt;
</code></pre>

<hr />

<h3 id="asynchronous-requests">Asynchronous requests</h3>
<p>While the default ThreadPool (200 threads) is enough for most use cases,
sometimes slow operations should be run asynchronously. Luckily it’s very easy in Javalin, just
pass a <code class="highlighter-rouge">CompletableFuture</code> to <code class="highlighter-rouge">ctx.future()</code>:</p>

<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">io.javalin.Javalin</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">app</span> <span class="p">=</span> <span class="n">Javalin</span><span class="p">.</span><span class="n">create</span><span class="p">().</span><span class="n">start</span><span class="p">(</span><span class="m">7000</span><span class="p">)</span>
    <span class="n">app</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span> <span class="p">-&gt;</span> <span class="n">ctx</span><span class="p">.</span><span class="n">future</span><span class="p">(</span><span class="n">getFuture</span><span class="p">())</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// hopefully your future is less pointless than this:
</span><span class="k">private</span> <span class="k">fun</span> <span class="nf">getFuture</span><span class="p">()</span> <span class="p">=</span> <span class="n">CompletableFuture</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;().</span><span class="n">apply</span> <span class="p">{</span>
    <span class="n">Executors</span><span class="p">.</span><span class="n">newSingleThreadScheduledExecutor</span><span class="p">().</span><span class="n">schedule</span><span class="p">({</span> <span class="k">this</span><span class="p">.</span><span class="n">complete</span><span class="p">(</span><span class="s">"Hello World!"</span><span class="p">)</span> <span class="p">},</span> <span class="m">1</span><span class="p">,</span> <span class="n">TimeUnit</span><span class="p">.</span><span class="n">SECONDS</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>
<div class="comment">Synonyms for ctrl+f: Async, CompletableFuture, Future, Concurrent, Concurrency</div>

<p>You can only set future results in endpoint handlers (get/post/put/etc).<br />
After-handlers, exception-handlers and error-handlers run like you’d expect them to after
the future has been resolved or rejected.</p>

<h4 id="async-callbacks">Async callbacks</h4>
<p>The <code class="highlighter-rouge">ctx.future()</code> method’s full signature is this:</p>

<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">@JvmOverloads</span>
<span class="k">fun</span> <span class="nf">future</span><span class="p">(</span><span class="n">future</span><span class="p">:</span> <span class="n">CompletableFuture</span><span class="p">&lt;*&gt;,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">Consumer</span><span class="p">&lt;</span><span class="n">Any</span><span class="p">?&gt;?</span> <span class="p">=</span> <span class="k">null</span><span class="p">):</span> <span class="n">Context</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">handlerType</span><span class="p">.</span><span class="n">isHttpMethod</span><span class="p">()</span> <span class="p">||</span> <span class="n">inExceptionHandler</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="n">IllegalStateException</span><span class="p">(</span><span class="s">"You can only set CompletableFuture results in endpoint handlers."</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">resultStream</span> <span class="p">=</span> <span class="k">null</span>
    <span class="n">resultFuture</span> <span class="p">=</span> <span class="n">future</span>
    <span class="n">futureConsumer</span> <span class="p">=</span> <span class="n">callback</span> <span class="o">?:</span> <span class="n">Consumer</span> <span class="p">{</span> <span class="n">result</span> <span class="p">-&gt;</span>
        <span class="k">when</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">is</span> <span class="n">InputStream</span> <span class="p">-&gt;</span> <span class="n">result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="k">is</span> <span class="n">String</span> <span class="p">-&gt;</span> <span class="n">result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="k">is</span> <span class="n">Any</span> <span class="p">-&gt;</span> <span class="n">json</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span>
<span class="p">}</span>
</code></pre>
</div>
<p>The default behavior is to set the result of the future using <code class="highlighter-rouge">ctx.result()</code> if it’s an <code class="highlighter-rouge">InputStream</code>
or a <code class="highlighter-rouge">String</code>, but to use <code class="highlighter-rouge">ctx.json()</code> if it’s any other Object.</p>

<p>You can provide your own callback to replace the default behavior:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">ctx</span><span class="o">.</span><span class="na">future</span><span class="o">(</span><span class="n">myFuture</span><span class="o">,</span> <span class="n">result</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">result</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="na">json</span><span class="o">(</span><span class="n">result</span><span class="o">)</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">404</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre>
</div>

<hr />

<h3 id="configuring-the-json-mapper">Configuring the JSON mapper</h3>

<p>To configure the JsonMapper, you need to pass an object which implements the <code class="highlighter-rouge">JsonMapper</code> interface
to <code class="highlighter-rouge">config.jsonMapper()</code>.</p>

<p>The <code class="highlighter-rouge">JsonMapper</code> interface has four optional methods:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">String</span> <span class="nf">toJsonString</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// basic method for mapping to json</span>
<span class="n">InputStream</span> <span class="nf">toJsonStream</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// memory efficient method for mapping to json</span>
<span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">fromJsonString</span><span class="o">(</span><span class="n">String</span> <span class="n">json</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">targetClass</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// basic method for mapping from json</span>
<span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">fromJsonStream</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">json</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">targetClass</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// memory efficient method for mapping from json</span>
</code></pre>
</div>

<h4 id="gson-example">GSON example</h4>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GsonBuilder</span><span class="o">().</span><span class="na">create</span><span class="o">();</span>
<span class="n">JsonMapper</span> <span class="n">gsonMapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JsonMapper</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toJsonString</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">fromJsonString</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="n">String</span> <span class="n">json</span><span class="o">,</span> <span class="nd">@NotNull</span> <span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">targetClass</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">gson</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">json</span><span class="o">,</span> <span class="n">targetClass</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">};</span>
<span class="n">Javalin</span> <span class="n">app</span> <span class="o">=</span> <span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">config</span> <span class="o">-&gt;</span> <span class="n">config</span><span class="o">.</span><span class="na">jsonMapper</span><span class="o">(</span><span class="n">gsonMapper</span><span class="o">)).</span><span class="na">start</span><span class="o">(</span><span class="mi">7070</span><span class="o">);</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="kd">val</span> <span class="py">gson</span> <span class="p">=</span> <span class="n">GsonBuilder</span><span class="p">().</span><span class="n">create</span><span class="p">()</span>

<span class="kd">val</span> <span class="py">gsonMapper</span> <span class="p">=</span> <span class="kd">object</span> <span class="err">: </span><span class="nc">JsonMapper</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="err">&lt;</span><span class="nf">T</span><span class="p">&gt;</span> <span class="n">fromJsonString</span><span class="p">(</span><span class="n">json</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">targetClass</span><span class="p">:</span> <span class="n">Class</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;):</span> <span class="n">T</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">gson</span><span class="p">.</span><span class="n">fromJson</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">targetClass</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toJsonString</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span> <span class="n">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">gson</span><span class="p">.</span><span class="n">toJson</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">val</span> <span class="py">app</span> <span class="p">=</span> <span class="n">Javalin</span><span class="p">.</span><span class="n">create</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">jsonMapper</span><span class="p">(</span><span class="n">gsonMapper</span><span class="p">)</span> <span class="p">}.</span><span class="n">start</span><span class="p">(</span><span class="m">7070</span><span class="p">)</span>
</code></pre>
    </div>
  </div>
</div>

<hr />

<h3 id="adding-other-servlets-and-filters-to-javalin">Adding other Servlets and Filters to Javalin</h3>
<p>Javalin is designed to work with other <code class="highlighter-rouge">Servlet</code> and <code class="highlighter-rouge">Filter</code> instances running on the Jetty Server.
Filters are pretty straighforward to add, since they don’t finish the request. If you need to add a serlvet
there’s an example in the repo:
<a href="https://github.com/javalin/javalin/blob/master/javalin/src/test/java/io/javalin/examples/HelloWorldServlet.java#L21-L29">/src/test/java/io/javalin/examples/HelloWorldServlet.java#L21-L29</a></p>

<hr />

<h3 id="views-and-templates">Views and Templates</h3>
<p>Javalin looks for templates/markdown files in <code class="highlighter-rouge">src/resources</code>,
and uses the correct rendering engine based on the extension of your template.
Javalin currently supports six template engines (see below), as well as markdown.
You can also register your own rendering engine.</p>

<div class="multitab-code" data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">ctx</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="s">"/templateFile.ext"</span><span class="o">,</span> <span class="n">model</span><span class="o">(</span><span class="s">"firstName"</span><span class="o">,</span> <span class="s">"John"</span><span class="o">,</span> <span class="s">"lastName"</span><span class="o">,</span> <span class="s">"Doe"</span><span class="o">))</span>
</code></pre>
    </div>
  </div>
<div data-tab="2">
    <div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">ctx</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="s">"/templateFile.ext"</span><span class="p">,</span> <span class="n">mapOf</span><span class="p">(</span><span class="s">"firstName"</span> <span class="n">to</span> <span class="s">"John"</span><span class="p">,</span> <span class="s">"lastName"</span> <span class="n">to</span> <span class="s">"Doe"</span><span class="p">))</span>
</code></pre>
    </div>
  </div>
</div>

<p>Register:</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">JavalinRenderer</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">JavalinPebble</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">,</span> <span class="s">".peb"</span><span class="o">,</span> <span class="s">".pebble"</span><span class="o">);</span>

<span class="n">JavalinRenderer</span><span class="o">.</span><span class="na">register</span><span class="o">((</span><span class="n">filePath</span><span class="o">,</span> <span class="n">model</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">MyRenderer</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="n">filePath</span><span class="o">,</span> <span class="n">model</span><span class="o">);</span>
<span class="o">},</span> <span class="s">".ext"</span><span class="o">);</span>
</code></pre>
</div>

<p>Configure:</p>
<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">JavalinThymeleaf</span><span class="p">.</span><span class="n">configure</span><span class="p">(</span><span class="n">templateEngine</span><span class="p">)</span>
<span class="n">JavalinVelocity</span><span class="p">.</span><span class="n">configure</span><span class="p">(</span><span class="n">velocityEngine</span><span class="p">)</span>
<span class="n">JavalinFreemarker</span><span class="p">.</span><span class="n">configure</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
<span class="n">JavalinMustache</span><span class="p">.</span><span class="n">configure</span><span class="p">(</span><span class="n">mustacheFactory</span><span class="p">)</span>
<span class="n">JavalinJtwig</span><span class="p">.</span><span class="n">configure</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
<span class="n">JavalinPebble</span><span class="p">.</span><span class="n">configure</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
<span class="n">JavalinCommonmark</span><span class="p">.</span><span class="n">configure</span><span class="p">(</span><span class="n">htmlRenderer</span><span class="p">,</span> <span class="n">markdownParser</span><span class="p">)</span>
</code></pre>
</div>

<p>If you wish to configure a template engine (for example, to set a root directory for your template files)
please consult the documentation for that particular template engine. These kinds of settings are not handled
through Javalin.</p>

<p>If you need to configure settings beyond what’s available in <code class="highlighter-rouge">JavalinTemplateEngine.configure</code>, you
have to write your own implementation and register it using <code class="highlighter-rouge">JavalinRenderer.register</code>.</p>

<p>Note that these are global settings, and can’t be configured per instance of Javalin.</p>

<hr />

<h3 id="vue-support-javalinvue">Vue support (JavalinVue)</h3>
<p>If you don’t want to deal with NPM and frontend builds, Javalin has support for simplified Vue.js development.
This requires you to make a layout template, <code class="highlighter-rouge">src/main/resources/vue/layout.html</code>:</p>

<pre><code class="language-markup">&lt;head&gt;
    &lt;script src="/webjars/vue/2.6.10/dist/vue.min.js"&gt;&lt;/script&gt;
    @componentRegistration
&lt;/head&gt;
&lt;body&gt;
&lt;main id="main-vue" v-cloak&gt;
    @routeComponent
&lt;/main&gt;
&lt;script&gt;
    new Vue({el: "#main-vue"});
&lt;/script&gt;
&lt;/body&gt;
</code></pre>

<p>When you put <code class="highlighter-rouge">.vue</code> files in <code class="highlighter-rouge">src/main/resources/vue</code>, Javalin will scan
the folder and register the components in your <code class="highlighter-rouge">&lt;head&gt;</code> tag.</p>

<p>Javalin will also put path-parameters in the Vue instance,
which you can access like this:</p>

<pre><code class="language-markup">&lt;template id="thread-view"&gt;
    &lt;div&gt;{{ $javalin.pathParams["user"] }}&lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
    Vue.component("thread-view", {
        template: "#thread-view"
    });
&lt;/script&gt;
</code></pre>

<p>To map a path to a Vue component you use the <code class="highlighter-rouge">VueComponent</code> class:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/messages"</span><span class="o">,</span>        <span class="n">VueComponent</span><span class="o">(</span><span class="s">"inbox-view"</span><span class="o">))</span>
<span class="n">get</span><span class="o">(</span><span class="s">"/messages/{user}"</span><span class="o">,</span> <span class="n">VueComponent</span><span class="o">(</span><span class="s">"thread-view"</span><span class="o">))</span>
</code></pre>
</div>

<p>This will give you a lot of the benefits of a modern frontend architecture,
with very few of the downsides.</p>

<p>There are more extensive docs at <a href="/plugins/javalinvue">/plugins/javalinvue</a>, and there is
an in-depth tutorial at <a href="/tutorials/simple-frontends-with-javalin-and-vue">/tutorials/simple-frontends-with-javalin-and-vue</a>.</p>

<hr />

<h3 id="timeoutexceptions-and-closedchannelexceptions">TimeoutExceptions and ClosedChannelExceptions</h3>
<p>If you encounter <code class="highlighter-rouge">TimeoutExceptions</code> and <code class="highlighter-rouge">ClosedChannelExceptions</code> in your DEBUG logs,
this is nothing to worry about. Typically, a browser will keep the HTTP connection open until the
server terminates it. When this happens is decided by the server’s <code class="highlighter-rouge">idleTimeout</code> setting,
which is 30 seconds by default in Jetty/Javalin. This is not a bug.</p>

<hr />

<h3 id="minecraft">Minecraft</h3>
<div class="comment">Keywords for ctrl+f: Bukkit, Spigot, BungeeCord, Bungee Cord, WaterFall, Water Fall, Paper</div>

<p>A lot of people use Javalin for Minecraft servers, and they often have issues with Jetty and WebSockets.</p>

<p>Please consider consulting our <a href="/tutorials/javalin-and-minecraft-servers">Minecraft tutorial</a> if you’re working with Javalin and a Minecraft server.</p>

<h4 id="relocation">Relocation</h4>
<p>Use <a href="https://imperceptiblethoughts.com/shadow/configuration/relocation/">relocate</a> is not required, but it can easily conflict with other plugin dependencies.
If this is a publicly released plugin, this step is recommended to make Javalin work on a different Minecraft Server.</p>

<p>Usually jetty causes the conflict, you can add gradle script to <code class="highlighter-rouge">build.gradle</code> following after adding the <code class="highlighter-rouge">shadow-jar</code> gradle plugin:</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="n">shadowJar</span> <span class="o">{</span>
    <span class="n">relocate</span> <span class="s1">'org.eclipse.jetty'</span><span class="o">,</span> <span class="s1">'shadow.org.eclipse.jetty'</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="custom-classloader">Custom classloader</h4>
<p>If you encounter some dependency missing errors such as <code class="highlighter-rouge">java.lang.NoClassDefFoundError</code> and <code class="highlighter-rouge">java.lang.ClassNotFoundException</code>, try to solve it by:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">ClassLoader</span> <span class="n">classLoader</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getContextClassLoader</span><span class="o">();</span>
<span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">setContextClassLoader</span><span class="o">(</span><span class="n">RemoteAPI</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getClassLoader</span><span class="o">());</span>
<span class="n">Javalin</span> <span class="n">app</span> <span class="o">=</span> <span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">().</span><span class="na">start</span><span class="o">(</span><span class="n">PORT</span><span class="o">);</span>
<span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">setContextClassLoader</span><span class="o">(</span><span class="n">classLoader</span><span class="o">);</span>
</code></pre>
</div>

<p>RemoteAPI can usually use the class loader of the main class of the plugin.
On Bukkit and Spigot it is a class extends <code class="highlighter-rouge">org.bukkit.plugin.java#JavaPlugin</code>, on BungeeCord and WaterFall it is a class extends <code class="highlighter-rouge">net.md_5.bungee.api.plugin#Plugin</code>.
Get it via <code class="highlighter-rouge"><span class="p">{</span><span class="err">your</span><span class="w"> </span><span class="err">plugin's</span><span class="w"> </span><span class="err">main</span><span class="w"> </span><span class="err">class</span><span class="p">}</span><span class="err">.class.getClassLoader()</span></code> .</p>

<p>After switching the class loader, you may still receive a missing dependency error from Javalin. You only need to add the corresponding dependency as prompted in the Javalin log.</p>

<h4 id="relevant-issues">Relevant issues</h4>
<ul>
  <li><a href="https://github.com/javalin/javalin/issues/358">https://github.com/javalin/javalin/issues/358</a> (with solution)</li>
  <li><a href="https://github.com/javalin/javalin/issues/232">https://github.com/javalin/javalin/issues/232</a></li>
  <li><a href="https://github.com/javalin/javalin/issues/1462">https://github.com/javalin/javalin/issues/1462</a></li>
</ul>

<hr />

<h3 id="documentation-for-previous-versions">Documentation for previous versions</h3>
<p>Docs for 3.13.X (last 3.X version) can be found <a href="/archive/docs/v3.13.X.html">here</a>.<br />
Docs for 2.8.0 (last 2.X version) can be found <a href="/archive/docs/v2.8.0.html">here</a>.<br />
Docs for 1.7.0 (last 1.X version) can be found <a href="/archive/docs/v1.7.0.html">here</a>.</p>

        <script src="/js/anchor.min.js"></script>
        <script>
            anchors.options.placement = 'left';
            anchors.add();
        </script>

    </main>
    <footer>
        Javalin is a Java and Kotlin web framework, open sourced under the
        <a href="https://tldrlegal.com/license/apache-license-2.0-(apache-2.0)">Apache 2</a> license
        | <a href="/download">Download</a>
        | <a href="/about">About</a>
        | <a href="/news">News</a>
        | <a href="/about#contact">Contact</a>
        | <a href="/for-educators">For educators</a>
    </footer>
    <div id="star-begging">
    <style>
        #star-begging {
            transition: transform .25s;
            transform: scale(0);
            border-radius: 8px;
            position: fixed;
            bottom: 32px;
            right: 32px;
            padding: 20px 40px 16px 20px;
            background: #fff;
            box-shadow: 0 1px 20px rgba(0, 0, 0, 0.15);
            z-index: 9999998;
        }
        #star-begging.in {
            transform: scale(1);
        }
        #star-begging.out {
            transform: translateX(400px);
        }
        #star-begging p {
            font-size: 16px;
            margin: 0 0 15px;
        }
        #star-begging .close {
            position: absolute;
            right: 20px;
            top: 20px;
            height: 40px;
            width: 40px;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-family: arial, sans-serif;
            cursor: pointer;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 5px;
        }
    </style>
    <p>
        Like Javalin?
        <br>Star us 😊
    </p>
    <span class="close">×</span>
    <iframe id="starFrame" class="githubStar" title="github-stars"
            src="https://ghbtns.com/github-btn.html?user=javalin&amp;repo=javalin&amp;type=star&amp;count=true&size=large"
            frameborder="0" scrolling="0" width="150px" height="30px">
    </iframe>
    <script>
        if (localStorage.getItem("dismissed") !== "true" && document.getElementById("notification-banner") === null) {
            setTimeout(function () {
                document.querySelector("#star-begging").classList.add("in");
            }, 15000);
            document.querySelector("#star-begging .close").addEventListener("click", function () {
                document.querySelector("#star-begging").classList.add("out");
                localStorage.setItem("dismissed", "true");
            });
        }
    </script>
</div>

    <script src="/js/scripts.js"></script>
</body>
</html>
